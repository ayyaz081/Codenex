<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="/components/favicon.ico">
    <title>Codenex Solutions - Admin Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/css/shared-styles.css">
    <style>
        /* Admin-specific additional variables */
        :root {
            --warning: #fbbf24;
            --danger: #ef4444;
            --info: #06b6d4;
        }

        [data-theme="dark"] {
            --warning: #fcd34d;
            --danger: #f87171;
            --info: #22d3ee;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .admin-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            border-right: 1px solid var(--glass-border);
            box-shadow: var(--glass-shadow);
            padding: 20px;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 100;
            transition: transform 0.3s ease;
        }

        .sidebar.hidden {
            transform: translateX(-100%);
        }

        .sidebar-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--glass-border);
        }

        .sidebar-header h2 {
            color: var(--primary);
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0;
        }

        .admin-badge {
            display: inline-block;
            background: var(--success);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
            margin-top: 8px;
        }

        .nav-menu {
            list-style: none;
        }

        .nav-item {
            margin-bottom: 8px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            color: var(--text);
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .nav-link:hover,
        .nav-link.active {
            background: var(--primary);
            color: white;
            transform: translateX(4px);
        }

        .nav-link i {
            width: 20px;
            margin-right: 12px;
            font-size: 1.1rem;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 20px;
            transition: margin-left 0.3s ease;
        }

        .main-content.expanded {
            margin-left: 0;
        }

        /* Top Bar */
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 16px 24px;
            margin-bottom: 30px;
            box-shadow: var(--glass-shadow);
        }

        .mobile-toggle {
            display: none;
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1.1rem;
        }

        .admin-info {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .admin-user-link:hover {
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            transform: translateY(-1px);
            box-shadow: var(--glass-shadow);
        }

        .admin-user-link:hover .admin-avatar {
            transform: scale(1.05);
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
        }

        .admin-avatar {
            width: 40px;
            height: 40px;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            transition: all 0.3s ease;
        }
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .theme-toggle {
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            border: 1px solid var(--glass-border);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--glass-shadow);
            transition: all 0.3s ease;
            color: var(--text);
        }

        .theme-toggle:hover {
            background: var(--primary);
            color: white;
            transform: scale(1.1);
        }

        /* Dashboard Cards */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 24px;
            box-shadow: var(--glass-shadow);
            transition: transform 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card:hover {
            transform: translateY(-4px);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--primary);
        }

        .stat-card.success::before { background: var(--success); }
        .stat-card.warning::before { background: var(--warning); }
        .stat-card.danger::before { background: var(--danger); }
        .stat-card.info::before { background: var(--info); }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .stat-title {
            color: var(--text-light);
            font-size: 0.9rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: white;
        }

        .stat-icon.primary { background: var(--primary); }
        .stat-icon.success { background: var(--success); }
        .stat-icon.warning { background: var(--warning); }
        .stat-icon.danger { background: var(--danger); }
        .stat-icon.info { background: var(--info); }

        .stat-value {
            font-size: 2.4rem;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 8px;
        }

        .stat-change {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .stat-change.positive { color: var(--success); }
        .stat-change.negative { color: var(--danger); }

        /* Content Sections */
        .content-section {
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 30px;
            box-shadow: var(--glass-shadow);
            display: none;
        }

        .content-section.active {
            display: block;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--glass-border);
        }
        
        /* When section header has only buttons (no title) */
        .section-header:not(:has(.section-title)) {
            justify-content: flex-end;
        }
        
        /* Fallback for browsers without :has() support */
        .section-header-buttons-only {
            justify-content: flex-end;
        }

        .section-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--text);
            margin: 0;
        }

        .btn {
            padding: 14px 32px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s ease;
            font-size: 1rem;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(rgba(255,255,255,0.2), transparent);
            transform: rotate(30deg);
            transition: all 0.5s;
        }

        .btn:hover::before {
            transform: rotate(30deg) translate(50%, 50%);
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #16a34a;
            transform: translateY(-2px);
        }

        .btn-warning {
            background: var(--warning);
            color: #111827; /* Always dark text for warning buttons for better contrast */
        }

        .btn-warning:hover {
            background: #f59e0b;
            transform: translateY(-2px);
        }

        .btn-info {
            background: var(--info);
            color: white;
        }

        .btn-info:hover {
            background: #0891b2;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
            transform: translateY(-2px);
        }

        /* Tables */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
            background: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--glass-shadow);
            border: 1px solid var(--glass-border);
        }

        .data-table th,
        .data-table td {
            padding: 14px 16px;
            text-align: left;
            border-bottom: 1px solid var(--glass-border);
            vertical-align: middle;
        }

        .data-table th {
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            font-weight: 600;
            color: var(--text);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .data-table td {
            color: var(--text);
            background: var(--card-bg);
        }

        .data-table tr:hover td {
            background: var(--glass-bg);
        }

        .data-table tr:last-child td {
            border-bottom: none;
        }

        .table-actions {
            display: flex;
            gap: 6px;
            align-items: center;
            justify-content: flex-start;
        }

        .table-actions .btn {
            padding: 6px 10px;
            font-size: 0.8rem;
            border-radius: 6px;
            min-width: auto;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .table-actions .btn i {
            font-size: 0.8rem;
        }

        .table-cell-content {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .table-cell-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            color: var(--primary);
        }

        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .status-active { background: #dcfce7; color: #166534; }
        .status-pending { background: #fef3c7; color: #92400e; }
        .status-inactive { background: #fee2e2; color: #991b1b; }

        [data-theme="dark"] .status-active { background: #166534; color: #dcfce7; }
        [data-theme="dark"] .status-pending { background: #92400e; color: #fef3c7; }
        [data-theme="dark"] .status-inactive { background: #991b1b; color: #fee2e2; }

        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text);
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            background: var(--bg-light);
            color: var(--text);
            font-size: 0.9rem;
            transition: border-color 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        /* Charts Container */
        .chart-container {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid var(--glass-border);
        }

        .chart-placeholder {
            color: var(--text-muted);
            font-style: italic;
        }


        /* Responsive Design */
        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.visible {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .mobile-toggle {
                display: block;
            }
        }

        @media (max-width: 768px) {
            .main-content {
                padding: 16px;
            }

            .top-bar {
                padding: 12px 16px;
                flex-direction: column;
                gap: 16px;
                align-items: flex-start;
            }

            .admin-info {
                width: 100%;
                justify-content: space-between;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .section-header {
                flex-direction: column;
                gap: 16px;
                align-items: flex-start;
            }
        }

        @media (max-width: 480px) {
            .sidebar {
                width: 100%;
            }


            .stat-value {
                font-size: 2rem;
            }

            .data-table {
                font-size: 0.8rem;
            }

            .data-table th,
            .data-table td {
                padding: 8px 12px;
            }
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            animation: fadeIn 0.3s ease;
        }

        [data-theme="dark"] .modal-overlay {
            background: rgba(0, 0, 0, 0.7);
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal-content {
            background: var(--card-bg);
            backdrop-filter: var(--glass-blur);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            box-shadow: var(--glass-shadow);
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: modalSlideIn 0.3s ease;
            color: var(--text);
        }

        .modal-content.modal-large {
            max-width: 800px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 24px 24px 16px;
            border-bottom: 1px solid var(--glass-border);
            background: var(--glass-bg);
        }

        .modal-header h3 {
            margin: 0;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .modal-header h3 i {
            color: var(--primary);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--text-muted);
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: var(--danger);
            color: white;
        }

        .modal-body {
            padding: 24px;
            color: var(--text);
        }

        .modal-form {
            padding: 24px;
        }

        .modal-form .form-control {
            background: var(--bg-light);
            color: var(--text);
            border-color: var(--glass-border);
        }

        .modal-form .form-control:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(var(--primary-rgb, 59, 130, 246), 0.2);
        }
        
        .modal-form .form-label {
            color: var(--text);
        }
        
        .modal-form .form-hint {
            color: var(--text-muted);
        }

        .modal-footer {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            padding: 16px 24px 24px;
            border-top: 1px solid var(--glass-border);
            background: var(--glass-bg);
        }

        .form-hint {
            display: block;
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 4px;
        }

        .btn-secondary {
            background: var(--neutral);
            color: white;
        }

        .btn-secondary:hover {
            background: var(--neutral-light);
            transform: translateY(-2px);
        }

        .btn-view {
            background: var(--info);
            color: white;
        }

        .btn-view:hover {
            background: #0891b2;
            transform: translateY(-2px);
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        /* Form Loading State */
        .form-loading {
            position: relative;
            pointer-events: none;
        }

        .form-loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 24px;
            height: 24px;
            margin: -12px 0 0 -12px;
            border: 2px solid transparent;
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            z-index: 10;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Animation classes */
        .fade-in {
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>

    <div class="admin-container">
        <!-- Sidebar -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2>Admin Panel</h2>
                <span class="admin-badge" id="roleBadge">Administrator</span>
            </div>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="#" class="nav-link active" data-section="dashboard">
                        <i class="fas fa-chart-line"></i>
                        Dashboard
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="products">
                        <i class="fas fa-box"></i>
                        Products
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="solutions">
                        <i class="fas fa-lightbulb"></i>
                        Solutions
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="publications">
                        <i class="fas fa-file-alt"></i>
                        Publications
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="repository">
                        <i class="fas fa-code-branch"></i>
                        Repository
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="contacts">
                        <i class="fas fa-envelope"></i>
                        Contact Forms
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="comments">
                        <i class="fas fa-comments"></i>
                        Comments
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="users">
                        <i class="fas fa-users"></i>
                        User Management
                    </a>
                </li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="main-content" id="mainContent">
            <!-- Top Bar -->
            <div class="top-bar">
                <div style="display: flex; align-items: center; gap: 16px;">
                    <button class="mobile-toggle" id="mobileToggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1 id="pageTitle">Dashboard Overview</h1>
                </div>
                <div class="admin-info">
                    <a href="/Auth" class="admin-user-link" style="display: flex; align-items: center; gap: 12px; text-decoration: none; color: inherit; padding: 4px 8px; border-radius: 8px; transition: all 0.3s ease;">
                        <span>Welcome, <strong id="adminUserDisplay">Admin</strong></span>
                        <div class="admin-avatar">A</div>
                    </a>
                    <button class="theme-toggle" id="themeToggle">
                        <i class="fas fa-moon"></i>
                    </button>
                    <a href="/" id="backToWebsiteBtn" class="btn btn-secondary" style="padding: 8px 12px; font-size: 0.9rem; text-decoration: none; display: inline-flex; align-items: center; gap: 8px; transition: all 0.3s ease;" title="Go back to main website" onmouseover="this.style.backgroundColor='#5a6268'; this.style.borderColor='#545b62';" onmouseout="this.style.backgroundColor='#6c757d'; this.style.borderColor='#6c757d';">
                        <i class="fas fa-home"></i> Back to Website
                    </a>
                    <button class="btn btn-danger" style="padding: 8px 12px; font-size: 0.9rem;" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>

            <!-- Dashboard Section -->
            <div class="content-section active fade-in" id="dashboard">
                <div class="dashboard-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <span class="stat-title">Total Products</span>
                            <div class="stat-icon primary">
                                <i class="fas fa-box"></i>
                            </div>
                        </div>
                        <div class="stat-value" id="totalProducts">-</div>
                        <div class="stat-change">
                            <i class="fas fa-info-circle"></i>
                            <span>Total products in system</span>
                        </div>
                    </div>

                    <div class="stat-card success">
                        <div class="stat-header">
                            <span class="stat-title">Solutions</span>
                            <div class="stat-icon success">
                                <i class="fas fa-lightbulb"></i>
                            </div>
                        </div>
                        <div class="stat-value" id="totalSolutions">-</div>
                        <div class="stat-change">
                            <i class="fas fa-info-circle"></i>
                            <span>Available solutions</span>
                        </div>
                    </div>

                    <div class="stat-card info">
                        <div class="stat-header">
                            <span class="stat-title">Publications</span>
                            <div class="stat-icon info">
                                <i class="fas fa-file-alt"></i>
                            </div>
                        </div>
                        <div class="stat-value" id="totalPublications">-</div>
                        <div class="stat-change">
                            <i class="fas fa-info-circle"></i>
                            <span>Research publications</span>
                        </div>
                    </div>

                    <div class="stat-card warning">
                        <div class="stat-header">
                            <span class="stat-title">Repository</span>
                            <div class="stat-icon warning">
                                <i class="fas fa-code-branch"></i>
                            </div>
                        </div>
                        <div class="stat-value" id="totalRepository">-</div>
                        <div class="stat-change">
                            <i class="fas fa-info-circle"></i>
                            <span>Code repositories</span>
                        </div>
                    </div>
                </div>
                
                <div class="dashboard-grid" style="margin-top: 30px;">
                    <div class="stat-card danger">
                        <div class="stat-header">
                            <span class="stat-title">Contact Forms</span>
                            <div class="stat-icon danger">
                                <i class="fas fa-envelope"></i>
                            </div>
                        </div>
                        <div class="stat-value" id="totalContacts">-</div>
                        <div class="stat-change">
                            <i class="fas fa-exclamation-triangle"></i>
                            <span id="unreadContacts">- unread messages</span>
                        </div>
                    </div>
                    
                    <div class="stat-card" style="background: linear-gradient(135deg, var(--neutral) 0%, var(--primary) 100%);">
                        <div class="stat-header">
                            <span class="stat-title" style="color: white;">Total Downloads</span>
                            <div class="stat-icon" style="background: rgba(255,255,255,0.2); color: white;">
                                <i class="fas fa-download"></i>
                            </div>
                        </div>
                        <div class="stat-value" style="color: white;" id="totalDownloads">-</div>
                        <div class="stat-change" style="color: rgba(255,255,255,0.8);">
                            <i class="fas fa-chart-line"></i>
                            <span>Repository downloads</span>
                        </div>
                    </div>
                    
                    <div class="stat-card" style="background: linear-gradient(135deg, var(--accent) 0%, var(--warning) 100%);">
                        <div class="stat-header">
                            <span class="stat-title" style="color: white;">Avg Rating</span>
                            <div class="stat-icon" style="background: rgba(255,255,255,0.2); color: white;">
                                <i class="fas fa-star"></i>
                            </div>
                        </div>
                        <div class="stat-value" style="color: white;" id="averageRating">-</div>
                        <div class="stat-change" style="color: rgba(255,255,255,0.8);">
                            <i class="fas fa-trophy"></i>
                            <span>Publication ratings</span>
                        </div>
                    </div>
                    
                    <div class="stat-card" style="background: linear-gradient(135deg, var(--success) 0%, var(--info) 100%);">
                        <div class="stat-header">
                            <span class="stat-title" style="color: white;">Active Solutions</span>
                            <div class="stat-icon" style="background: rgba(255,255,255,0.2); color: white;">
                                <i class="fas fa-check-circle"></i>
                            </div>
                        </div>
                        <div class="stat-value" style="color: white;" id="activeSolutions">-</div>
                        <div class="stat-change" style="color: rgba(255,255,255,0.8);">
                            <i class="fas fa-rocket"></i>
                            <span>Solutions in production</span>
                        </div>
                    </div>
                </div>

                <div class="content-section active">
                    <div class="section-header">
                        <h3 class="section-title">Recent Contacts</h3>
                        <button class="btn btn-primary" onclick="switchToContacts()">
                            <i class="fas fa-envelope"></i> View All Contacts
                        </button>
                    </div>
                    <table class="data-table" id="recentContactsTable">
                        <thead>
                            <tr>
                                <th><i class="fas fa-user table-cell-icon"></i> Name</th>
                                <th><i class="fas fa-envelope table-cell-icon"></i> Email</th>
                                <th><i class="fas fa-comment table-cell-icon"></i> Subject</th>
                                <th><i class="fas fa-calendar table-cell-icon"></i> Date</th>
                                <th><i class="fas fa-check-circle table-cell-icon"></i> Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="5" style="text-align: center; padding: 20px; color: var(--text-muted);">
                                    <i class="fas fa-spinner fa-spin"></i> Loading recent contacts...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Products Management Section -->
            <div class="content-section" id="products">
                <div class="section-header section-header-buttons-only">
                    <button class="btn btn-primary" onclick="showAddProductModal()">
                        <i class="fas fa-plus"></i> Add New Product
                    </button>
                </div>
                
                <div class="form-row" style="margin-bottom: 20px;">
                    <div class="form-group">
                        <label class="form-label">Filter by Domain</label>
                        <select class="form-control" id="productDomainFilter">
                            <option value="">All Domains</option>
                            <option value="Automation">Automation</option>
                            <option value="Digital Services">Digital Services</option>
                            <option value="Healthcare">Healthcare</option>
                            <option value="Education">Education</option>
                            <option value="Finance">Finance</option>
                            <option value="E-commerce">E-commerce</option>
                            <option value="Transportation">Transportation & Logistics</option>
                            <option value="Entertainment">Entertainment & Media</option>
                            <option value="HR">Human Resources</option>
                            <option value="Prediction">Prediction and Optimization</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Search Products</label>
                        <input type="text" class="form-control" id="productSearch" placeholder="Search by title...">
                    </div>
                </div>
                
                <table class="data-table" id="productsTable">
                    <thead>
                        <tr>
                            <th><i class="fas fa-hashtag table-cell-icon"></i> ID</th>
                            <th><i class="fas fa-box table-cell-icon"></i> Product</th>
                            <th><i class="fas fa-layer-group table-cell-icon"></i> Domain</th>
                            <th><i class="fas fa-align-left table-cell-icon"></i> Description</th>
                            <th><i class="fas fa-calendar table-cell-icon"></i> Created</th>
                            <th><i class="fas fa-cogs table-cell-icon"></i> Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Products will be loaded here -->
                    </tbody>
                </table>
            </div>

            <!-- Solutions Management Section -->
            <div class="content-section" id="solutions">
                <div class="section-header section-header-buttons-only">
                    <button class="btn btn-primary" onclick="showAddSolutionModal()">
                        <i class="fas fa-plus"></i> Add New Solution
                    </button>
                </div>
                
                <div class="form-row" style="margin-bottom: 20px;">
                    <div class="form-group">
                        <label class="form-label">Filter by Problem Area</label>
                        <select class="form-control" id="solutionAreaFilter">
                            <option value="">All Problem Areas</option>
                            <option value="Automation">Automation</option>
                            <option value="Security">Security</option>
                            <option value="Analytics">Analytics</option>
                            <option value="Integration">Integration</option>
                            <option value="Performance">Performance</option>
                            <option value="Scalability">Scalability</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Search Solutions</label>
                        <input type="text" class="form-control" id="solutionSearch" placeholder="Search by title...">
                    </div>
                </div>
                
                <table class="data-table" id="solutionsTable">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Solution</th>
                            <th>Problem Area</th>
                            <th>Status</th>
                            <th>Demo</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Solutions will be loaded here -->
                    </tbody>
                </table>
            </div>

            <!-- Publications Management Section -->
            <div class="content-section" id="publications">
                <div class="section-header section-header-buttons-only">
                    <button class="btn btn-primary" onclick="showAddPublicationModal()">
                        <i class="fas fa-plus"></i> Add New Publication
                    </button>
                </div>
                
                <div class="form-row" style="margin-bottom: 20px;">
                    <div class="form-group">
                        <label class="form-label">Filter by Domain</label>
                        <select class="form-control" id="publicationDomainFilter">
                            <option value="">All Domains</option>
                            <option value="AI">Artificial Intelligence</option>
                            <option value="ML">Machine Learning</option>
                            <option value="Cloud">Cloud Computing</option>
                            <option value="Security">Cybersecurity</option>
                            <option value="Data">Data Science</option>
                            <option value="IoT">Internet of Things</option>
                            <option value="Blockchain">Blockchain</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Search Publications</label>
                        <input type="text" class="form-control" id="publicationSearch" placeholder="Search by title, authors, keywords...">
                    </div>
                </div>
                
                <table class="data-table" id="publicationsTable">
                    <thead>
                        <tr>
                            <th><i class="fas fa-hashtag table-cell-icon"></i> ID</th>
                            <th><i class="fas fa-file-alt table-cell-icon"></i> Publication</th>
                            <th><i class="fas fa-user-edit table-cell-icon"></i> Authors</th>
                            <th><i class="fas fa-layer-group table-cell-icon"></i> Domain</th>
                            <th><i class="fas fa-star table-cell-icon"></i> Rating</th>
                            <th><i class="fas fa-calendar table-cell-icon"></i> Published</th>
                            <th><i class="fas fa-cogs table-cell-icon"></i> Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Publications will be loaded here -->
                    </tbody>
                </table>
            </div>

            <!-- Repository Management Section -->
            <div class="content-section" id="repository">
                <div class="section-header section-header-buttons-only">
                    <button class="btn btn-primary" onclick="showAddRepositoryModal()">
                        <i class="fas fa-plus"></i> Add New Repository Item
                    </button>
                </div>
                
                <div class="form-row" style="margin-bottom: 20px;">
                    <div class="form-group">
                        <label class="form-label">Filter by Category</label>
                        <select class="form-control" id="repositoryCategoryFilter">
                            <option value="">All Categories</option>
                            <option value="Web">Web Application</option>
                            <option value="Mobile">Mobile Application</option>
                            <option value="Desktop">Desktop Application</option>
                            <option value="API">API/Service</option>
                            <option value="Library">Library/Framework</option>
                            <option value="Tool">Development Tool</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Filter by Type</label>
                        <select class="form-control" id="repositoryTypeFilter">
                            <option value="">All Types</option>
                            <option value="free">Free/Open Source</option>
                            <option value="premium">Premium</option>
                        </select>
                    </div>
                </div>
                
                <table class="data-table" id="repositoryTable">
                    <thead>
                        <tr>
                            <th><i class="fas fa-hashtag table-cell-icon"></i> ID</th>
                            <th><i class="fas fa-code-branch table-cell-icon"></i> Repository</th>
                            <th><i class="fas fa-folder table-cell-icon"></i> Category</th>
                            <th><i class="fas fa-tag table-cell-icon"></i> Type</th>
                            <th><i class="fas fa-code table-cell-icon"></i> Version</th>
                            <th><i class="fas fa-download table-cell-icon"></i> Downloads</th>
                            <th><i class="fas fa-cogs table-cell-icon"></i> Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Repository items will be loaded here -->
                    </tbody>
                </table>
            </div>


            <!-- Contact Forms Management Section -->
            <div class="content-section" id="contacts">
                <div class="section-header section-header-buttons-only">
                    <div style="display: flex; gap: 12px;">
                        <button class="btn btn-warning" onclick="markAllAsRead()">
                            <i class="fas fa-check"></i> Mark All Read
                        </button>
                        <button class="btn btn-danger" onclick="deleteReadContacts()">
                            <i class="fas fa-trash"></i> Delete Read
                        </button>
                    </div>
                </div>
                
                <div class="form-row" style="margin-bottom: 20px;">
                    <div class="form-group">
                        <label class="form-label">Filter by Status</label>
                        <select class="form-control" id="contactStatusFilter">
                            <option value="">All Status</option>
                            <option value="unread">Unread</option>
                            <option value="read">Read</option>
                            <option value="replied">Replied</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Search Contacts</label>
                        <input type="text" class="form-control" id="contactSearch" placeholder="Search by name, email, subject...">
                    </div>
                </div>
                
                <table class="data-table" id="contactsTable">
                    <thead>
                        <tr>
                            <th><i class="fas fa-hashtag table-cell-icon"></i> ID</th>
                            <th><i class="fas fa-user table-cell-icon"></i> Name</th>
                            <th><i class="fas fa-envelope table-cell-icon"></i> Email</th>
                            <th><i class="fas fa-comment table-cell-icon"></i> Subject</th>
                            <th><i class="fas fa-calendar table-cell-icon"></i> Date</th>
                            <th><i class="fas fa-check-circle table-cell-icon"></i> Status</th>
                            <th><i class="fas fa-cogs table-cell-icon"></i> Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Contact forms will be loaded here -->
                    </tbody>
                </table>
            </div>


            <!-- Comments Management Section -->
            <div class="content-section" id="comments">
                <div class="section-header section-header-buttons-only">
                    <div style="display: flex; gap: 12px;">
                        <button class="btn btn-success" onclick="approveSelectedComments()">
                            <i class="fas fa-check"></i> Approve Selected
                        </button>
                        <button class="btn btn-danger" onclick="deleteSelectedComments()">
                            <i class="fas fa-trash"></i> Delete Selected
                        </button>
                    </div>
                </div>
                
                <div class="form-row" style="margin-bottom: 20px;">
                    <div class="form-group">
                        <label class="form-label">Filter by Status</label>
                        <select class="form-control" id="commentStatusFilter">
                            <option value="">All Comments</option>
                            <option value="pending">Pending Approval</option>
                            <option value="approved">Approved</option>
                            <option value="rejected">Rejected</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Filter by Publication</label>
                        <select class="form-control" id="commentPublicationFilter">
                            <option value="">All Publications</option>
                            <!-- Will be populated dynamically -->
                        </select>
                    </div>
                </div>
                
                <table class="data-table" id="commentsTable">
                    <thead>
                        <tr>
                            <th><input type="checkbox" id="selectAllComments" onchange="toggleSelectAllComments()"></th>
                            <th><i class="fas fa-hashtag table-cell-icon"></i> ID</th>
                            <th><i class="fas fa-user table-cell-icon"></i> Author</th>
                            <th><i class="fas fa-file-alt table-cell-icon"></i> Publication</th>
                            <th><i class="fas fa-comment table-cell-icon"></i> Comment</th>
                            <th><i class="fas fa-calendar table-cell-icon"></i> Date</th>
                            <th><i class="fas fa-check-circle table-cell-icon"></i> Status</th>
                            <th><i class="fas fa-cogs table-cell-icon"></i> Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Comments will be loaded here -->
                    </tbody>
                </table>
            </div>

            <!-- User Management Section -->
            <div class="content-section" id="users">
                <div class="section-header section-header-buttons-only">
                    <button class="btn btn-primary" onclick="showAddUserModal()">
                        <i class="fas fa-user-plus"></i> Add New User
                    </button>
                </div>
                
                <div class="form-row" style="margin-bottom: 20px;">
                    <div class="form-group">
                        <label class="form-label">Filter by Role</label>
                        <select class="form-control" id="userRoleFilter">
                            <option value="">All Roles</option>
                            <option value="Admin">Admin</option>
                            <option value="User">User</option>
                            <option value="Manager">Manager</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Search Users</label>
                        <input type="text" class="form-control" id="userSearch" placeholder="Search by name, email...">
                    </div>
                </div>
                
                <table class="data-table" id="usersTable">
                    <thead>
                        <tr>
                            <th><i class="fas fa-hashtag table-cell-icon"></i> ID</th>
                            <th><i class="fas fa-user table-cell-icon"></i> Name</th>
                            <th><i class="fas fa-envelope table-cell-icon"></i> Email</th>
                            <th><i class="fas fa-user-tag table-cell-icon"></i> Role</th>
                            <th><i class="fas fa-toggle-on table-cell-icon"></i> Status</th>
                            <th><i class="fas fa-clock table-cell-icon"></i> Last Login</th>
                            <th><i class="fas fa-cogs table-cell-icon"></i> Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Users will be loaded here -->
                    </tbody>
                </table>
            </div>

            <!-- Analytics Section -->
            <div class="content-section" id="analytics">
                <div class="section-header section-header-buttons-only">
                    <button class="btn btn-primary">
                        <i class="fas fa-download"></i> Export Report
                    </button>
                </div>
                
                <div class="dashboard-grid">
                    <div class="chart-container">
                        <div class="chart-placeholder">
                            <i class="fas fa-chart-line" style="font-size: 3rem; color: var(--text-muted);"></i>
                            <p>Visitors Chart<br><small>Chart integration needed</small></p>
                        </div>
                    </div>
                    <div class="chart-container">
                        <div class="chart-placeholder">
                            <i class="fas fa-chart-pie" style="font-size: 3rem; color: var(--text-muted);"></i>
                            <p>Traffic Sources<br><small>Chart integration needed</small></p>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 30px;">
                    <h4>Key Metrics</h4>
                    <div class="dashboard-grid">
                        <div class="stat-card info">
                            <div class="stat-header">
                                <span class="stat-title">Page Views</span>
                                <div class="stat-icon info">
                                    <i class="fas fa-eye"></i>
                                </div>
                            </div>
                            <div class="stat-value">12.4K</div>
                            <div class="stat-change positive">
                                <i class="fas fa-arrow-up"></i>
                                <span>+15.2% this month</span>
                            </div>
                        </div>
                        
                        <div class="stat-card success">
                            <div class="stat-header">
                                <span class="stat-title">Conversion Rate</span>
                                <div class="stat-icon success">
                                    <i class="fas fa-percentage"></i>
                                </div>
                            </div>
                            <div class="stat-value">3.2%</div>
                            <div class="stat-change positive">
                                <i class="fas fa-arrow-up"></i>
                                <span>+0.5% this month</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Section -->
            <div class="content-section" id="settings">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Site Title</label>
                        <input type="text" class="form-control" value="Codenex Solutions">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Admin Email</label>
                        <input type="email" class="form-control" value="admin@codenex.solutions">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Timezone</label>
                        <select class="form-control">
                            <option>UTC-5 (Eastern)</option>
                            <option>UTC-8 (Pacific)</option>
                            <option>UTC+0 (GMT)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Language</label>
                        <select class="form-control">
                            <option>English</option>
                            <option>Spanish</option>
                            <option>French</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Site Description</label>
                    <textarea class="form-control" rows="4">Codenex Solutions - Your trusted partner for cloud migration, cybersecurity, and data analytics.</textarea>
                </div>
                
                <button class="btn btn-success">
                    <i class="fas fa-save"></i> Save Settings
                </button>
            </div>

            <!-- Security Section -->
            <div class="content-section" id="security">
                <div class="dashboard-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <span class="stat-title">Failed Login Attempts</span>
                            <div class="stat-icon danger">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                        </div>
                        <div class="stat-value">23</div>
                        <div class="stat-change negative">
                            <i class="fas fa-arrow-up"></i>
                            <span>+8 in last 24h</span>
                        </div>
                    </div>
                    
                    <div class="stat-card success">
                        <div class="stat-header">
                            <span class="stat-title">Active Sessions</span>
                            <div class="stat-icon success">
                                <i class="fas fa-users"></i>
                            </div>
                        </div>
                        <div class="stat-value">12</div>
                        <div class="stat-change positive">
                            <i class="fas fa-arrow-down"></i>
                            <span>Normal activity</span>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 30px;">
                    <h4>Security Actions</h4>
                    <div style="display: flex; gap: 12px; flex-wrap: wrap; margin-top: 16px;">
                        <button class="btn btn-warning">
                            <i class="fas fa-key"></i> Change Admin Password
                        </button>
                        <button class="btn btn-danger">
                            <i class="fas fa-ban"></i> Block IP Addresses
                        </button>
                        <button class="btn btn-info">
                            <i class="fas fa-shield-alt"></i> Enable 2FA
                        </button>
                        <button class="btn btn-primary">
                            <i class="fas fa-download"></i> Security Log
                        </button>
                    </div>
                </div>
                
                <div style="margin-top: 30px;">
                    <h4>Recent Security Events</h4>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>Event</th>
                                <th>IP Address</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>11:30 AM</td>
                                <td>Admin login successful</td>
                                <td>192.168.1.100</td>
                                <td><span class="status-badge status-active">Success</span></td>
                            </tr>
                            <tr>
                                <td>10:45 AM</td>
                                <td>Failed login attempt</td>
                                <td>203.0.113.15</td>
                                <td><span class="status-badge status-inactive">Failed</span></td>
                            </tr>
                            <tr>
                                <td>09:20 AM</td>
                                <td>Password changed</td>
                                <td>192.168.1.100</td>
                                <td><span class="status-badge status-active">Success</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <!-- Product Modal -->
    <div class="modal-overlay" id="productModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="productModalTitle"><i class="fas fa-plus"></i> Add New Product</h3>
                <button class="modal-close" onclick="closeModal('productModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="productForm" class="modal-form">
                <input type="hidden" name="productId" id="productId">
                <div class="form-group">
                    <label class="form-label">Title *</label>
                    <input type="text" name="title" id="productTitle" class="form-control" required maxlength="200">
                </div>
                <div class="form-group">
                    <label class="form-label">Domain *</label>
                    <select name="domain" id="productDomain" class="form-control" required>
                        <option value="">Select Domain</option>
                        <option value="Automation">Automation</option>
                        <option value="Digital Services">Digital Services</option>
                        <option value="Healthcare">Healthcare</option>
                        <option value="Education">Education</option>
                        <option value="Finance">Finance</option>
                        <option value="E-commerce">E-commerce</option>
                        <option value="Transportation">Transportation & Logistics</option>
                        <option value="Entertainment">Entertainment & Media</option>
                        <option value="HR">Human Resources</option>
                        <option value="Prediction">Prediction and Optimization</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Short Description *</label>
                    <textarea name="shortDescription" id="productShortDesc" class="form-control" rows="3" required maxlength="500"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Long Description *</label>
                    <textarea name="longDescription" id="productLongDesc" class="form-control" rows="6" required></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Product Image</label>
                    <input type="file" name="image" id="productImage" class="form-control" accept="image/*">
                    <small class="form-hint">Supported formats: JPG, PNG, GIF. Max size: 10MB. Leave empty to keep current image when editing.</small>
                    <div id="currentImagePreview" style="margin-top: 10px; display: none;">
                        <label class="form-label">Current Image:</label>
                        <img id="currentImage" src="" alt="Current product image" style="max-width: 200px; max-height: 150px; border-radius: 8px; border: 1px solid var(--glass-border);">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('productModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="productSubmitBtn">
                        <i class="fas fa-save"></i> Create Product
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Solution Modal -->
    <div class="modal-overlay" id="solutionModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="solutionModalTitle"><i class="fas fa-plus"></i> Add New Solution</h3>
                <button class="modal-close" onclick="closeModal('solutionModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="solutionForm" class="modal-form">
                <input type="hidden" name="solutionId" id="solutionId">
                <div class="form-group">
                    <label class="form-label">Title *</label>
                    <input type="text" name="title" id="solutionTitle" class="form-control" required maxlength="100">
                </div>
                <div class="form-group">
                    <label class="form-label">Problem Area *</label>
                    <select name="problemArea" id="solutionProblemArea" class="form-control" required>
                        <option value="">Select Problem Area</option>
                        <option value="Automation">Automation</option>
                        <option value="Security">Security</option>
                        <option value="Analytics">Analytics</option>
                        <option value="Integration">Integration</option>
                        <option value="Performance">Performance</option>
                        <option value="Scalability">Scalability</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Summary *</label>
                    <textarea name="summary" id="solutionSummary" class="form-control" rows="6" required maxlength="2000"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Demo Video URL</label>
                    <input type="url" name="demoVideoUrl" id="solutionVideoUrl" class="form-control" maxlength="255">
                </div>
                <div class="form-group">
                    <label class="form-label">Demo Image</label>
                    <input type="file" name="demoImageFile" id="solutionImage" class="form-control" accept="image/*">
                    <small class="form-hint">Supported formats: JPG, PNG, GIF, SVG. Max size: 5MB. Leave empty to keep current image when editing.</small>
                    <div id="currentSolutionImagePreview" style="margin-top: 10px; display: none;">
                        <label class="form-label">Current Image:</label>
                        <img id="currentSolutionImage" src="" alt="Current solution image" style="max-width: 200px; max-height: 150px; border-radius: 8px; border: 1px solid var(--glass-border);">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('solutionModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="solutionSubmitBtn">
                        <i class="fas fa-save"></i> Create Solution
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Publication Modal -->
    <div class="modal-overlay" id="publicationModal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3><i class="fas fa-plus"></i> Add New Publication</h3>
                <button class="modal-close" onclick="closeModal('publicationModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="publicationForm" class="modal-form">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Title *</label>
                        <input type="text" name="title" class="form-control" required maxlength="200">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Domain *</label>
                        <select name="domain" class="form-control" required>
                            <option value="">Select Domain</option>
                            <option value="AI">Artificial Intelligence</option>
                            <option value="ML">Machine Learning</option>
                            <option value="Cloud">Cloud Computing</option>
                            <option value="Security">Cybersecurity</option>
                            <option value="Data">Data Science</option>
                            <option value="IoT">Internet of Things</option>
                            <option value="Blockchain">Blockchain</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Authors *</label>
                    <input type="text" name="authors" class="form-control" required maxlength="500" placeholder="e.g., John Doe, Jane Smith">
                </div>
                <div class="form-group">
                    <label class="form-label">Abstract *</label>
                    <textarea name="abstract" class="form-control" rows="6" required maxlength="2000"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Keywords</label>
                    <input type="text" name="keywords" class="form-control" maxlength="500" placeholder="keyword1, keyword2, keyword3">
                    <small class="form-hint">Separate keywords with commas for better searchability</small>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Thumbnail Image</label>
                        <input type="file" name="thumbnailFile" class="form-control" accept="image/*">
                        <small class="form-hint">JPG, PNG, GIF. Max size: 10MB. Leave empty to keep current image when editing.</small>
                        <div id="currentPublicationImagePreview" style="margin-top: 10px; display: none;">
                            <label class="form-label">Current Image:</label>
                            <img id="currentPublicationThumbnail" src="" alt="Current thumbnail" style="max-width: 200px; max-height: 150px; border-radius: 8px; border: 1px solid var(--glass-border);">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Document File</label>
                        <input type="file" name="documentFile" class="form-control" accept=".pdf,.doc,.docx">
                        <small class="form-hint">PDF, DOC, DOCX. Max size: 10MB</small>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Published Date</label>
                    <input type="datetime-local" name="publishedDate" class="form-control">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('publicationModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Create Publication
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Repository Modal -->
    <div class="modal-overlay" id="repositoryModal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3 id="repositoryModalTitle"><i class="fas fa-plus"></i> Add New Repository Item</h3>
                <button class="modal-close" onclick="closeModal('repositoryModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="repositoryForm" class="modal-form">
                <input type="hidden" name="repositoryId" id="repositoryId">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Title *</label>
                        <input type="text" name="title" id="repositoryTitle" class="form-control" required maxlength="200">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Category</label>
                        <select name="category" id="repositoryCategory" class="form-control">
                            <option value="">Select Category</option>
                            <option value="Web">Web Application</option>
                            <option value="Mobile">Mobile Application</option>
                            <option value="Desktop">Desktop Application</option>
                            <option value="API">API/Service</option>
                            <option value="Library">Library/Framework</option>
                            <option value="Tool">Development Tool</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Description *</label>
                    <textarea name="description" id="repositoryDescription" class="form-control" rows="5" required maxlength="1000"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Tags</label>
                        <input type="text" name="tags" id="repositoryTags" class="form-control" maxlength="200" placeholder="tag1, tag2, tag3">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Technical Stack</label>
                        <input type="text" name="technicalStack" id="repositoryTechnicalStack" class="form-control" maxlength="200" placeholder="React, Node.js, MongoDB">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">GitHub URL</label>
                        <input type="url" name="githubUrl" id="repositoryGithubUrl" class="form-control" maxlength="255">
                    </div>
                    <div class="form-group">
                        <label class="form-label">License</label>
                        <select name="license" id="repositoryLicense" class="form-control">
                            <option value="">Select License</option>
                            <option value="MIT">MIT License</option>
                            <option value="Apache-2.0">Apache License 2.0</option>
                            <option value="GPL-3.0">GNU General Public License v3.0</option>
                            <option value="BSD-3-Clause">BSD 3-Clause License</option>
                            <option value="Proprietary">Proprietary</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Version</label>
                        <input type="text" name="version" id="repositoryVersion" class="form-control" maxlength="50" placeholder="1.0.0">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Pricing</label>
                        <div style="display: flex; gap: 20px; align-items: center; margin-top: 8px;">
                            <label style="display: flex; align-items: center; gap: 8px; font-weight: normal;">
                                <input type="radio" name="pricing" value="free" checked> Free
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; font-weight: normal;">
                                <input type="radio" name="pricing" value="premium"> Premium
                            </label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('repositoryModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="repositorySubmitBtn">
                        <i class="fas fa-save"></i> Create Repository Item
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Contact View Modal -->
    <div class="modal-overlay" id="contactViewModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-envelope-open"></i> Contact Details</h3>
                <button class="modal-close" onclick="closeModal('contactViewModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="contactDetails">
                <!-- Contact details will be loaded here -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('contactViewModal')">Close</button>
                <button type="button" class="btn btn-primary" onclick="markContactAsRead()">
                    <i class="fas fa-check"></i> Mark as Read
                </button>
            </div>
        </div>
    </div>

    <!-- User Modal -->
    <div class="modal-overlay" id="userModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="userModalTitle"><i class="fas fa-plus"></i> Add New User</h3>
                <button class="modal-close" onclick="closeModal('userModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="userForm" class="modal-form">
                <input type="hidden" name="userId" id="userId">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">First Name *</label>
                        <input type="text" name="firstName" id="userFirstName" class="form-control" required maxlength="100">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Last Name *</label>
                        <input type="text" name="lastName" id="userLastName" class="form-control" required maxlength="100">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Email Address *</label>
                    <input type="email" name="email" id="userEmail" class="form-control" required maxlength="255">
                    <small class="form-hint">This will be used for login. Must be unique.</small>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Password *</label>
                        <input type="password" name="password" id="userPassword" class="form-control" minlength="6">
                        <small class="form-hint">Minimum 6 characters. Leave empty when editing to keep current password.</small>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Confirm Password *</label>
                        <input type="password" name="confirmPassword" id="userConfirmPassword" class="form-control" minlength="6">
                        <small class="form-hint">Must match the password above.</small>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Role *</label>
                        <select name="role" id="userRole" class="form-control" required>
                            <option value="User">User</option>
                            <option value="Admin">Admin</option>
                            <option value="Manager">Manager</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Status</label>
                    <div style="display: flex; align-items: center; gap: 10px; margin-top: 8px;">
                        <input type="checkbox" name="isActive" id="userActive" checked>
                        <label for="userActive" style="font-weight: normal; margin: 0;">User is active and can log in</label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('userModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="userSubmitBtn">
                        <i class="fas fa-save"></i> Create User
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Carousel Modal -->
    <div class="modal-overlay" id="carouselModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="carouselModalTitle"><i class="fas fa-plus"></i> Add New Carousel Slide</h3>
                <button class="modal-close" onclick="closeModal('carouselModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="carouselForm" class="modal-form">
                <input type="hidden" name="slideId" id="slideId">
                <div class="form-group">
                    <label class="form-label">Title *</label>
                    <input type="text" name="title" id="slideTitle" class="form-control" required maxlength="100">
                </div>
                <div class="form-group">
                    <label class="form-label">Subtitle/Description *</label>
                    <textarea name="description" id="slideDescription" class="form-control" rows="3" required maxlength="250"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Key Message *</label>
                    <textarea name="KeyMessage" id="slideKeyMessage" class="form-control" rows="2" required maxlength="150"></textarea>
                    <small class="form-hint">Short, impactful message for the slide (required by the backend)</small>
                </div>
                <div class="form-group">
                    <label class="form-label">Call-to-Action Text</label>
                    <input type="text" name="buttonText" id="slideCtaText" class="form-control" maxlength="30" placeholder="e.g., Explore More">
                </div>
                <div class="form-group">
                    <label class="form-label">Call-to-Action Link</label>
                    <input type="url" name="buttonLinkUrl" id="slideCtaLink" class="form-control" placeholder="https://example.com">
                </div>
                <div class="form-group">
                    <label class="form-label">Background Image *</label>
                    <input type="file" name="BackgroundImageFile" id="slideBackgroundImage" class="form-control" accept="image/*">
                    <small class="form-hint">Supported formats: JPG, PNG, GIF. Max size: 10MB. Recommended size: 1920x800px. Leave empty to keep current image when editing.</small>
                    <div id="currentSlideImagePreview" style="margin-top: 10px; display: none;">
                        <label class="form-label">Current Background Image:</label>
                        <img id="currentSlideImage" src="" alt="Current slide background" style="max-width: 200px; max-height: 150px; border-radius: 8px; border: 1px solid var(--glass-border);">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Display Order *</label>
                        <input type="number" name="displayOrder" id="slideOrder" class="form-control" min="1" value="999" required>
                        <small class="form-hint">Lower numbers appear first (required field)</small>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Status</label>
                        <div style="display: flex; align-items: center; gap: 10px; margin-top: 8px;">
                            <input type="checkbox" name="isActive" id="slideActive" checked>
                            <label for="slideActive" style="font-weight: normal; margin: 0;">Slide is active and visible</label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('carouselModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="carouselSubmitBtn">
                        <i class="fas fa-save"></i> Create Slide
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Team Member Modal -->
    <div class="modal-overlay" id="teamMemberModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="teamMemberModalTitle"><i class="fas fa-plus"></i> Add New Team Member</h3>
                <button class="modal-close" onclick="closeModal('teamMemberModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="teamMemberForm" class="modal-form">
                <input type="hidden" name="teamMemberId" id="teamMemberId">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">First Name *</label>
                        <input type="text" name="firstName" id="teamMemberFirstName" class="form-control" required maxlength="100">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Last Name *</label>
                        <input type="text" name="lastName" id="teamMemberLastName" class="form-control" required maxlength="100">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Position *</label>
                    <input type="text" name="position" id="teamMemberPosition" class="form-control" required maxlength="150">
                </div>
                <div class="form-group">
                    <label class="form-label">Department</label>
                    <input type="text" name="department" id="teamMemberDepartment" class="form-control" maxlength="100">
                </div>
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" name="email" id="teamMemberEmail" class="form-control" maxlength="255">
                </div>
                <div class="form-group">
                    <label class="form-label">Bio</label>
                    <textarea name="bio" id="teamMemberBio" class="form-control" rows="4" maxlength="1000"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">LinkedIn URL</label>
                        <input type="url" name="linkedInUrl" id="teamMemberLinkedIn" class="form-control" maxlength="255">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Twitter URL</label>
                        <input type="url" name="twitterUrl" id="teamMemberTwitter" class="form-control" maxlength="255">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Photo</label>
                    <input type="file" name="photoFile" id="teamMemberPhoto" class="form-control" accept="image/*">
                    <small class="form-hint">Supported formats: JPG, PNG, GIF. Max size: 5MB. Leave empty to keep current photo when editing.</small>
                    <div id="currentTeamMemberImagePreview" style="margin-top: 10px; display: none;">
                        <label class="form-label">Current Photo:</label>
                        <img id="currentTeamMemberImage" src="" alt="Current team member photo" style="max-width: 200px; max-height: 150px; border-radius: 8px; border: 1px solid var(--glass-border);">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Display Order</label>
                        <input type="number" name="displayOrder" id="teamMemberOrder" class="form-control" min="0" value="999">
                        <small class="form-hint">Lower numbers appear first</small>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Status</label>
                        <div style="display: flex; align-items: center; gap: 10px; margin-top: 8px;">
                            <input type="checkbox" name="isActive" id="teamMemberActive" checked>
                            <label for="teamMemberActive" style="font-weight: normal; margin: 0;">Team member is active and visible</label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('teamMemberModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="teamMemberSubmitBtn">
                        <i class="fas fa-save"></i> Create Member
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Testimonial Modal -->
    <div class="modal-overlay" id="testimonialModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="testimonialModalTitle"><i class="fas fa-plus"></i> Add New Testimonial</h3>
                <button class="modal-close" onclick="closeModal('testimonialModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="testimonialForm" class="modal-form">
                <input type="hidden" name="testimonialId" id="testimonialId">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Client Name *</label>
                        <input type="text" name="clientName" id="testimonialClientName" class="form-control" required maxlength="200">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Client Position *</label>
                        <input type="text" name="clientPosition" id="testimonialClientPosition" class="form-control" required maxlength="200">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Company Name *</label>
                    <input type="text" name="companyName" id="testimonialCompanyName" class="form-control" required maxlength="200">
                </div>
                <div class="form-group">
                    <label class="form-label">Testimonial Message *</label>
                    <textarea name="message" id="testimonialMessage" class="form-control" rows="4" required maxlength="1000"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Rating *</label>
                        <select name="rating" id="testimonialRating" class="form-control" required>
                            <option value="5">5 Stars - Excellent</option>
                            <option value="4">4 Stars - Good</option>
                            <option value="3">3 Stars - Average</option>
                            <option value="2">2 Stars - Poor</option>
                            <option value="1">1 Star - Very Poor</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Display Order</label>
                        <input type="number" name="displayOrder" id="testimonialOrder" class="form-control" min="0" value="999">
                        <small class="form-hint">Lower numbers appear first</small>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Client Photo</label>
                    <input type="file" name="clientPhotoFile" id="testimonialClientPhoto" class="form-control" accept="image/*">
                    <small class="form-hint">Supported formats: JPG, PNG, GIF. Max size: 5MB.</small>
                    <div id="currentTestimonialImagePreview" style="margin-top: 10px; display: none;">
                        <label class="form-label">Current Images:</label>
                        <div style="display: flex; gap: 15px; align-items: center;">
                            <img id="currentTestimonialClientImage" src="" alt="Current client photo" style="max-width: 100px; max-height: 100px; border-radius: 8px; border: 1px solid var(--glass-border); display: none;">
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Status</label>
                        <div style="display: flex; align-items: center; gap: 10px; margin-top: 8px;">
                            <input type="checkbox" name="isActive" id="testimonialActive" checked>
                            <label for="testimonialActive" style="font-weight: normal; margin: 0;">Testimonial is active and visible</label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('testimonialModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="testimonialSubmitBtn">
                        <i class="fas fa-save"></i> Create Testimonial
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Demo Video Modal -->
    <div class="modal-overlay" id="demoVideoModal">
        <div class="modal-content modal-large" style="max-width: 1000px;">
            <div class="modal-header">
                <h3 id="demoVideoTitle"><i class="fas fa-play-circle"></i> Solution Demo</h3>
                <button class="modal-close" onclick="closeDemoVideoModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" style="padding: 0; background: #000;">
                <div id="videoContainer" style="position: relative; width: 100%; height: 500px; background: #000; border-radius: 0 0 12px 12px; overflow: hidden;">
                    <div id="videoLoader" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; text-align: center;">
                        <i class="fas fa-spinner fa-spin" style="font-size: 2rem; margin-bottom: 10px;"></i>
                        <div>Loading video...</div>
                    </div>
                    <iframe id="demoVideoFrame" style="width: 100%; height: 100%; border: none; display: none;"></iframe>
                    <video id="demoVideoPlayer" style="width: 100%; height: 100%; display: none;" controls>
                        Your browser does not support the video tag.
                    </video>
                    <div id="videoError" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; text-align: center; display: none;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 2rem; margin-bottom: 10px; color: #ef4444;"></i>
                        <div>Unable to load video. Please check the URL.</div>
                    </div>
                </div>
            </div>
            <div class="modal-footer" style="background: var(--glass-bg); border-top: 1px solid var(--glass-border);">
                <div style="display: flex; align-items: center; gap: 12px; flex: 1;">
                    <button type="button" class="btn btn-secondary" onclick="toggleFullscreen()" id="fullscreenBtn">
                        <i class="fas fa-expand"></i> Fullscreen
                    </button>
                    <div id="videoUrl" style="font-size: 0.8rem; color: var(--text-muted); flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;"></div>
                </div>
                <button type="button" class="btn btn-primary" onclick="closeDemoVideoModal()">
                    <i class="fas fa-times"></i> Close
                </button>
            </div>
        </div>
    </div>

    <script>
        // Global configuration
        // Use the PortfolioConfig if available, otherwise detect dynamically
        function getBackendBaseUrl() {
            // Check if PortfolioConfig is loaded
            if (typeof PortfolioConfig !== 'undefined' && PortfolioConfig.api && PortfolioConfig.api.getBaseUrl) {
                return PortfolioConfig.api.getBaseUrl();
            }
            
            // Check for API_BASE_URL from environment
            if (window.API_BASE_URL) {
                return window.API_BASE_URL;
            }
            
            // Fallback to dynamic detection
            if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                return 'http://localhost:7150';
            }
            
            // Production: use same protocol and hostname
            const hostname = window.location.hostname;
            const port = window.location.port;
            
            if (port && port !== '80' && port !== '443') {
                return `${window.location.protocol}//${hostname}:${port}`;
            } else {
                return `${window.location.protocol}//${hostname}`;
            }
        }
        
        const backendBaseUrl = getBackendBaseUrl();
        const API_BASE_URL = backendBaseUrl + '/api';

        // Global variables - Updated to use consistent authentication
        let isLoggedIn = false;
        let currentUser = null;

        // Authentication helper function
        function getAuthToken() {
            // Try to get token from new auth system first
            let token = localStorage.getItem('authToken');
            if (token) {
                return token;
            }
            
            // Fallback to legacy admin token
            token = localStorage.getItem('adminToken');
            if (token) {
                return token;
            }
            
            return null;
        }

        // DOM elements - will be initialized after DOM loads
        let sidebar, mainContent, mobileToggle, themeToggle, pageTitle;
        let navLinks, contentSections;

        // Initialize theme
        const currentTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', currentTheme);

        // API Integration Classes - Define early to prevent initialization errors
        class AdminAPI {
            static async fetchProducts(domain = '', search = '') {
                try {
                    let url = `${API_BASE_URL}/Products`;
                    // Products API doesn't have built-in filtering, so we'll filter client-side
                    const response = await fetch(url);
                    let products = await response.json();
                    
                    // Client-side filtering
                    if (domain) {
                        products = products.filter(p => p.domain === domain);
                    }
                    if (search) {
                        const searchLower = search.toLowerCase();
                        products = products.filter(p => 
                            p.title.toLowerCase().includes(searchLower) ||
                            p.shortDescription.toLowerCase().includes(searchLower)
                        );
                    }
                    
                    return products;
                } catch (error) {
                    console.error('Error fetching products:', error);
                    return [];
                }
            }

            static async fetchSolutions(area = '', search = '') {
                try {
                    let url = `${API_BASE_URL}/Solutions`;
                    if (area) {
                        url = `${API_BASE_URL}/Solutions/problem-areas/${encodeURIComponent(area)}`;
                    }
                    
                    console.log('Fetching solutions from URL:', url);
                    const response = await fetch(url);
                    console.log('Solutions API response status:', response.status);
                    
                    if (!response.ok) {
                        console.error('Solutions API error:', response.status, response.statusText);
                        const errorText = await response.text();
                        console.error('Error details:', errorText);
                        return [];
                    }
                    
                    let solutions = await response.json();
                    console.log('Solutions fetched:', solutions.length, solutions);
                    
                    // Client-side search filtering if needed
                    if (search) {
                        const searchLower = search.toLowerCase();
                        solutions = solutions.filter(s => 
                            s.title.toLowerCase().includes(searchLower) ||
                            s.summary.toLowerCase().includes(searchLower)
                        );
                        console.log('Solutions after search filtering:', solutions.length);
                    }
                    
                    return solutions;
                } catch (error) {
                    console.error('Error fetching solutions:', error);
                    return [];
                }
            }

            static async fetchPublications(domain = '', search = '') {
                try {
                    console.log('Fetching publications with filters - domain:', domain, 'search:', search);
                    let url = `${API_BASE_URL}/Publications`;
                    let publications = [];
                    
                    // Handle domain filtering and search properly
                    if (domain && search) {
                        // Both domain and search - use base endpoint and filter client-side
                        console.log('Using both domain and search filters');
                        const response = await fetch(url);
                        if (!response.ok) throw new Error(`HTTP ${response.status}`);
                        publications = await response.json();
                        
                        // Filter by domain first
                        publications = publications.filter(p => p.domain === domain);
                        
                        // Then filter by search term
                        const searchLower = search.toLowerCase();
                        publications = publications.filter(p => 
                            (p.title && p.title.toLowerCase().includes(searchLower)) ||
                            (p.authors && p.authors.toLowerCase().includes(searchLower)) ||
                            (p.abstract && p.abstract.toLowerCase().includes(searchLower)) ||
                            (p.keywords && p.keywords.toLowerCase().includes(searchLower))
                        );
                    } else if (domain) {
                        // Only domain filter
                        console.log('Using domain filter only:', domain);
                        url = `${API_BASE_URL}/Publications/domain/${encodeURIComponent(domain)}`;
                        const response = await fetch(url);
                        if (!response.ok) {
                            console.warn(`Domain endpoint failed, falling back to client-side filtering`);
                            // Fallback to client-side filtering if domain endpoint fails
                            const fallbackResponse = await fetch(`${API_BASE_URL}/Publications`);
                            if (!fallbackResponse.ok) throw new Error(`HTTP ${fallbackResponse.status}`);
                            const allPublications = await fallbackResponse.json();
                            publications = allPublications.filter(p => p.domain === domain);
                        } else {
                            publications = await response.json();
                        }
                    } else if (search) {
                        // Only search filter
                        console.log('Using search filter only:', search);
                        const searchParams = new URLSearchParams();
                        searchParams.append('query', search);
                        const searchUrl = `${API_BASE_URL}/Publications/search?${searchParams.toString()}`;
                        
                        const response = await fetch(searchUrl);
                        if (!response.ok) {
                            console.warn(`Search endpoint failed, falling back to client-side search`);
                            // Fallback to client-side search if search endpoint fails
                            const fallbackResponse = await fetch(`${API_BASE_URL}/Publications`);
                            if (!fallbackResponse.ok) throw new Error(`HTTP ${fallbackResponse.status}`);
                            const allPublications = await fallbackResponse.json();
                            const searchLower = search.toLowerCase();
                            publications = allPublications.filter(p => 
                                (p.title && p.title.toLowerCase().includes(searchLower)) ||
                                (p.authors && p.authors.toLowerCase().includes(searchLower)) ||
                                (p.abstract && p.abstract.toLowerCase().includes(searchLower)) ||
                                (p.keywords && p.keywords.toLowerCase().includes(searchLower))
                            );
                        } else {
                            publications = await response.json();
                        }
                    } else {
                        // No filters - get all publications
                        console.log('No filters - fetching all publications');
                        const response = await fetch(url);
                        if (!response.ok) throw new Error(`HTTP ${response.status}`);
                        publications = await response.json();
                    }
                    
                    console.log(`Fetched ${publications.length} publications after filtering`);
                    return publications;
                } catch (error) {
                    console.error('Error fetching publications:', error);
                    return [];
                }
            }

            static async fetchRepository(category = '', type = '') {
                try {
                    let url = `${API_BASE_URL}/Repository`;
                    
                    if (category) {
                        url = `${API_BASE_URL}/Repository/category/${encodeURIComponent(category)}`;
                    } else if (type === 'free') {
                        url = `${API_BASE_URL}/Repository/free`;
                    } else if (type === 'premium') {
                        url = `${API_BASE_URL}/Repository/premium`;
                    }
                    
                    const response = await fetch(url);
                    return await response.json();
                } catch (error) {
                    console.error('Error fetching repository items:', error);
                    return [];
                }
            }

            static async fetchContacts(status = '', search = '') {
                try {
                    let url = `${API_BASE_URL}/Contact`;
                    const params = new URLSearchParams();
                    
                    if (status === 'read') {
                        params.append('isRead', 'true');
                    } else if (status === 'unread') {
                        params.append('isRead', 'false');
                    } else if (status === 'replied') {
                        params.append('isReplied', 'true');
                    }
                    
                    if (params.toString()) url += '?' + params.toString();
                    
                    const response = await fetch(url);
                    let contacts = await response.json();
                    
                    // Client-side search filtering
                    if (search) {
                        const searchLower = search.toLowerCase();
                        contacts = contacts.filter(c => 
                            c.name.toLowerCase().includes(searchLower) ||
                            c.email.toLowerCase().includes(searchLower) ||
                            c.subject.toLowerCase().includes(searchLower)
                        );
                    }
                    
                    return contacts;
                } catch (error) {
                    console.error('Error fetching contacts:', error);
                    return [];
                }
            }

            static async deleteItem(endpoint, id) {
                try {
                    const token = getAuthToken();
                    const headers = {};
                    
                    if (token) {
                        headers['Authorization'] = `Bearer ${token}`;
                    }
                    
                    console.log(`Attempting to delete ${endpoint} item ${id} with token:`, token ? 'present' : 'missing');
                    
                    const response = await fetch(`${API_BASE_URL}/${endpoint}/${id}`, {
                        method: 'DELETE',
                        headers: headers
                    });
                    
                    console.log(`Delete ${endpoint} response status:`, response.status);
                    
                    if (!response.ok) {
                        const errorText = await response.text();
                        console.error(`Failed to delete ${endpoint}:`, response.status, errorText);
                        
                        if (response.status === 401) {
                            console.error('Unauthorized - check if user is logged in and has proper permissions');
                        } else if (response.status === 403) {
                            console.error('Forbidden - user does not have permission to delete this resource');
                        }
                    }
                    
                    return response.ok;
                } catch (error) {
                    console.error(`Error deleting ${endpoint} item:`, error);
                    return false;
                }
            }

            static async uploadProduct(formData) {
                try {
                    const token = getAuthToken();
                    const headers = {};
                    
                    if (token) {
                        headers['Authorization'] = `Bearer ${token}`;
                    }
                    
                    const response = await fetch(`${API_BASE_URL}/Products/upload`, {
                        method: 'POST',
                        headers: headers,
                        body: formData
                    });
                    
                    if (!response.ok) {
                        console.error('Upload failed:', response.status, await response.text());
                        return null;
                    }
                    
                    return await response.json();
                } catch (error) {
                    console.error('Error uploading product:', error);
                    return null;
                }
            }
        }


        // Initialize app - Updated to redirect non-admin users
        function initializeApp() {
            checkAuthStatus();
            if (isLoggedIn && currentUser && currentUser.role === 'Admin') {
                // User is already logged in as admin, show admin interface
                document.querySelector('.admin-container').style.display = 'flex';
                updateAdminDisplay();
            } else {
                // User not logged in or not admin, redirect to auth page
                window.location.href = '/Auth?returnUrl=' + encodeURIComponent(window.location.href);
            }
        }

        // Check authentication status using consistent auth system
        function checkAuthStatus() {
            try {
                const token = localStorage.getItem('authToken');
                const userInfo = localStorage.getItem('userInfo');
                
                if (token && userInfo) {
                    const user = JSON.parse(userInfo);
                    const expiresAt = new Date(user.expiresAt);
                    
                    if (expiresAt > new Date()) {
                        // Token is still valid
                        isLoggedIn = true;
                        currentUser = user;
                        return;
                    } else {
                        // Token expired, clear storage
                        localStorage.removeItem('authToken');
                        localStorage.removeItem('userInfo');
                        console.log('Expired token removed');
                    }
                } else if (localStorage.getItem('adminLoggedIn') === 'true') {
                    // Fallback to old admin auth system
                    isLoggedIn = true;
                    currentUser = {
                        role: 'Admin',
                        firstName: localStorage.getItem('adminUsername') || 'Admin',
                        lastName: '',
                        email: localStorage.getItem('adminEmail') || 'admin@codenex.solutions'
                    };
                    return;
                }
                
                // Not logged in
                isLoggedIn = false;
                currentUser = null;
                
            } catch (error) {
                console.error('Error checking auth status:', error);
                isLoggedIn = false;
                currentUser = null;
            }
        }

        // DOM elements after DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize DOM elements after DOM is loaded
            sidebar = document.getElementById('sidebar');
            mainContent = document.getElementById('mainContent');
            mobileToggle = document.getElementById('mobileToggle');
            themeToggle = document.getElementById('themeToggle');
            pageTitle = document.getElementById('pageTitle');
            
            // Get navigation elements
            navLinks = document.querySelectorAll('.nav-link');
            contentSections = document.querySelectorAll('.content-section');
            
            // Initialize theme icon after themeToggle is available
            updateThemeIcon(currentTheme);
            
            // Initialize app
            initializeApp();
            
            // Setup event listeners
            setupEventListeners();
            
            // Load dashboard data when page loads if user is logged in
            if (isLoggedIn) {
                setTimeout(loadDashboardData, 500);
            }
        });

        // Navigation link handling
        function setupEventListeners() {
            
            // Theme toggle functionality
            if (themeToggle) {
                themeToggle.addEventListener('click', function() {
                    const currentTheme = document.documentElement.getAttribute('data-theme');
                    const newTheme = currentTheme === 'light' ? 'dark' : 'light';
                    document.documentElement.setAttribute('data-theme', newTheme);
                    localStorage.setItem('theme', newTheme);
                    updateThemeIcon(newTheme);
                });
            }

            // Mobile menu toggle
            if (mobileToggle) {
                mobileToggle.addEventListener('click', function() {
                    sidebar.classList.toggle('visible');
                });
            }

            // Navigation functionality
            const navLinks = document.querySelectorAll('.nav-link');
            const contentSections = document.querySelectorAll('.content-section');

            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const sectionId = this.getAttribute('data-section');
                    
                    // Update active nav link
                    navLinks.forEach(nav => nav.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show corresponding section
                    contentSections.forEach(section => {
                        section.classList.remove('active');
                    });
                    
                    const targetSection = document.getElementById(sectionId);
                    if (targetSection) {
                        targetSection.classList.add('active');
                        targetSection.classList.add('fade-in');
                    }
                    
                    // Update page title using centralized function
                    setPageTitle(sectionId);
                    
                    // Load dashboard data when navigating to dashboard
                    if (sectionId === 'dashboard') {
                        setTimeout(loadDashboardData, 100);
                    }
                    
                    // Load section-specific data
                    switch(sectionId) {
                        case 'products':
                            setTimeout(loadProducts, 100);
                            break;
                        case 'solutions':
                            setTimeout(loadSolutions, 100);
                            break;
                        case 'publications':
                            setTimeout(loadPublications, 100);
                            break;
                        case 'repository':
                            setTimeout(loadRepository, 100);
                            break;
                        case 'contacts':
                            setTimeout(loadContacts, 100);
                            break;
                        case 'comments':
                            setTimeout(loadComments, 100);
                            break;
                        case 'users':
                            setTimeout(loadUsers, 100);
                            break;
                        case 'homepage':
                            setTimeout(function() {
                                loadCarousel();
                            }, 100);
                            break;
                        case 'aboutpage':
                            setTimeout(function() {
                                loadAboutContent();
                                loadTeamManagement();
                                loadTestimonialsManagement();
                            }, 100);
                            break;
                    }
                    
                    // Hide sidebar on mobile after selection
                    if (window.innerWidth <= 1024) {
                        sidebar.classList.remove('visible');
                    }
                });
            });
        }

        // Logout functionality
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                // Clear login state
                isLoggedIn = false;
                currentUser = null;
                
                // Clear ALL authentication-related localStorage items
                localStorage.removeItem('authToken');
                localStorage.removeItem('userInfo');
                localStorage.removeItem('adminLoggedIn');
                localStorage.removeItem('adminUsername');
                localStorage.removeItem('adminToken');
                localStorage.removeItem('adminRole');
                localStorage.removeItem('adminEmail');
                
                // Clear any other cached content
                localStorage.removeItem('aboutContent');
                
                // Redirect to auth page
                showNotification('Logged out successfully', 'success');
                setTimeout(() => {
                    window.location.href = '/Auth';
                }, 500);
            }
        }

        // Update admin display name and implement role-based UI control
        function updateAdminDisplay() {
            const adminUsername = localStorage.getItem('adminUsername') || 'Admin';
            const adminUserDisplay = document.getElementById('adminUserDisplay');
            if (adminUserDisplay) {
                adminUserDisplay.textContent = adminUsername;
            }

            // Update role-based UI elements
            updateRoleBasedUI();
        }

        // Parse JWT token to get user role and info
        function parseJWT(token) {
            try {
                const payload = token.split('.')[1];
                return JSON.parse(atob(payload));
            } catch (e) {
                console.error('Error parsing JWT token:', e);
                return null;
            }
        }

        // Get current user role from stored information
        function getCurrentUserRole() {
            // Try new auth system first
            const userInfo = localStorage.getItem('userInfo');
            if (userInfo) {
                try {
                    const user = JSON.parse(userInfo);
                    return user.role || 'Guest';
                } catch (e) {
                    console.error('Error parsing user info:', e);
                }
            }

            // Try parsing JWT token
            const token = getAuthToken();
            if (token) {
                const decoded = parseJWT(token);
                if (decoded && decoded.role) {
                    return decoded.role;
                }
                if (decoded && decoded['http://schemas.microsoft.com/ws/2008/06/identity/claims/role']) {
                    return decoded['http://schemas.microsoft.com/ws/2008/06/identity/claims/role'];
                }
            }

            // Fallback to legacy admin role
            const adminRole = localStorage.getItem('adminRole');
            if (adminRole) {
                return adminRole;
            }

            return 'Guest';
        }

        // Update UI based on current user role
        function updateRoleBasedUI() {
            const userRole = getCurrentUserRole();
            console.log('Current user role:', userRole);

            // Update role badge
            const roleBadge = document.getElementById('roleBadge');
            if (roleBadge) {
                switch (userRole) {
                    case 'Admin':
                        roleBadge.textContent = 'Administrator';
                        roleBadge.style.background = 'var(--success)';
                        break;
                    case 'Manager':
                        roleBadge.textContent = 'Manager';
                        roleBadge.style.background = 'var(--info)';
                        break;
                    default:
                        roleBadge.textContent = 'User';
                        roleBadge.style.background = 'var(--neutral)';
                        break;
                }
            }

            // Control sidebar navigation visibility
            updateNavigationVisibility(userRole);

            // Control section access
            updateSectionAccess(userRole);
        }

        // Update navigation menu visibility based on role
        function updateNavigationVisibility(role) {
            const navItems = {
                'dashboard': ['Admin', 'Manager'],
                'products': ['Admin', 'Manager'],
                'solutions': ['Admin', 'Manager'],
                'publications': ['Admin', 'Manager'],
                'repository': ['Admin', 'Manager'],
                'homepage': ['Admin', 'Manager'],
                'aboutpage': ['Admin', 'Manager'],
                'contacts': ['Admin', 'Manager'],
                'comments': ['Admin', 'Manager'],
                'users': ['Admin'],  // Only Admin can manage users
                'analytics': ['Admin', 'Manager'],
                'settings': ['Admin'],  // Only Admin can change settings
                'security': ['Admin']   // Only Admin can access security
            };

            // Hide/show navigation items based on role
            Object.keys(navItems).forEach(section => {
                const navLink = document.querySelector(`[data-section="${section}"]`);
                const navItem = navLink ? navLink.closest('.nav-item') : null;
                
                if (navItem) {
                    if (navItems[section].includes(role)) {
                        navItem.style.display = 'block';
                    } else {
                        navItem.style.display = 'none';
                    }
                }
            });

            // If current active section is not accessible, redirect to dashboard
            const activeSection = document.querySelector('.nav-link.active');
            if (activeSection) {
                const sectionId = activeSection.getAttribute('data-section');
                if (sectionId && !navItems[sectionId].includes(role)) {
                    // Switch to dashboard
                    switchToSection('dashboard');
                }
            }
        }

        // Update section access and content based on role
        function updateSectionAccess(role) {
            const sections = document.querySelectorAll('.content-section');
            
            sections.forEach(section => {
                const sectionId = section.id;
                const allowedRoles = getSectionAllowedRoles(sectionId);
                
                if (!allowedRoles.includes(role)) {
                    // Add overlay to restrict access
                    addAccessDeniedOverlay(section, sectionId);
                } else {
                    // Remove any existing overlay
                    removeAccessDeniedOverlay(section);
                }
            });

            // Disable specific buttons based on role
            updateButtonAccess(role);
        }

        // Get allowed roles for a specific section
        function getSectionAllowedRoles(sectionId) {
            const sectionRoles = {
                'dashboard': ['Admin', 'Manager'],
                'products': ['Admin', 'Manager'],
                'solutions': ['Admin', 'Manager'], 
                'publications': ['Admin', 'Manager'],
                'repository': ['Admin', 'Manager'],
                'homepage': ['Admin', 'Manager'],
                'aboutpage': ['Admin', 'Manager'],
                'contacts': ['Admin', 'Manager'],
                'comments': ['Admin', 'Manager'],
                'users': ['Admin'],  // Only Admin
                'analytics': ['Admin', 'Manager'],
                'settings': ['Admin'],  // Only Admin
                'security': ['Admin']   // Only Admin
            };
            
            return sectionRoles[sectionId] || ['Admin'];
        }

        // Add access denied overlay to section
        function addAccessDeniedOverlay(section, sectionId) {
            // Remove existing overlay first
            removeAccessDeniedOverlay(section);
            
            const overlay = document.createElement('div');
            overlay.className = 'access-denied-overlay';
            overlay.innerHTML = `
                <div class="access-denied-content">
                    <i class="fas fa-lock" style="font-size: 3rem; color: var(--danger); margin-bottom: 20px;"></i>
                    <h3 style="color: var(--danger); margin-bottom: 10px;">Access Denied</h3>
                    <p style="color: var(--text-muted); text-align: center; line-height: 1.6;">
                        You do not have permission to access this section.<br>
                        Contact your administrator for access to <strong>${getSectionDisplayName(sectionId)}</strong>.
                    </p>
                </div>
            `;
            
            overlay.style.cssText = `
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(var(--bg-rgb, 255, 255, 255), 0.95);
                backdrop-filter: blur(5px);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10;
                border-radius: 12px;
            `;
            
            section.style.position = 'relative';
            section.appendChild(overlay);
        }

        // Remove access denied overlay
        function removeAccessDeniedOverlay(section) {
            const existingOverlay = section.querySelector('.access-denied-overlay');
            if (existingOverlay) {
                existingOverlay.remove();
            }
        }

        // Get display name for section
        function getSectionDisplayName(sectionId) {
            const displayNames = {
                'dashboard': 'Dashboard',
                'products': 'Products Management',
                'solutions': 'Solutions Management',
                'publications': 'Publications Management',
                'repository': 'Repository Management',
                'homepage': 'Homepage Content Management',
                'aboutpage': 'About Page Content Management',
                'contacts': 'Contact Forms Management',
                'comments': 'Comments Management',
                'users': 'User Management',
                'analytics': 'Analytics & Reports',
                'settings': 'System Settings',
                'security': 'Security Settings'
            };
            
            return displayNames[sectionId] || 'Section';
        }

        // Update button access based on role
        function updateButtonAccess(role) {
            // Disable user management buttons for non-admins
            if (role !== 'Admin') {
                const userManagementButtons = document.querySelectorAll('#users .btn');
                userManagementButtons.forEach(btn => {
                    if (!btn.classList.contains('btn-secondary')) { // Don't disable "Cancel" buttons
                        btn.disabled = true;
                        btn.title = 'Admin access required';
                        btn.style.opacity = '0.5';
                    }
                });

                // Disable system settings and security buttons
                const settingsButtons = document.querySelectorAll('#settings .btn, #security .btn');
                settingsButtons.forEach(btn => {
                    if (!btn.classList.contains('btn-secondary')) {
                        btn.disabled = true;
                        btn.title = 'Admin access required';
                        btn.style.opacity = '0.5';
                    }
                });
            }
        }

        // Centralized function to set page title
        function setPageTitle(sectionId) {
            const sectionTitles = {
                'dashboard': 'Dashboard Overview',
                'products': 'Products Management',
                'solutions': 'Solutions Management',
                'publications': 'Publications Management',
                'repository': 'Repository Management',
                'homepage': 'Homepage Content Management',
                'aboutpage': 'About Page Content Management',
                'contacts': 'Contact Forms Management',
                'comments': 'Comments Management',
                'users': 'User Management',
                'analytics': 'Analytics & Reports',
                'settings': 'System Settings',
                'security': 'Security Settings'
            };
            
            if (pageTitle) {
                pageTitle.textContent = sectionTitles[sectionId] || 'Admin Panel';
            }
        }

        // Helper function to switch to a specific section
        function switchToSection(sectionId) {
            // Remove active class from all nav links and sections
            navLinks.forEach(nav => nav.classList.remove('active'));
            contentSections.forEach(section => section.classList.remove('active'));
            
            // Activate target nav and section
            const targetNav = document.querySelector(`[data-section="${sectionId}"]`);
            const targetSection = document.getElementById(sectionId);
            
            if (targetNav && targetSection) {
                targetNav.classList.add('active');
                targetSection.classList.add('active');
                targetSection.classList.add('fade-in');
                
                // Update page title using centralized function
                setPageTitle(sectionId);
                
                // Load section-specific data (same logic as navigation handler)
                if (sectionId === 'dashboard') {
                    setTimeout(loadDashboardData, 100);
                }
                
                switch(sectionId) {
                    case 'products':
                        setTimeout(loadProducts, 100);
                        break;
                    case 'solutions':
                        setTimeout(loadSolutions, 100);
                        break;
                    case 'publications':
                        setTimeout(loadPublications, 100);
                        break;
                    case 'repository':
                        setTimeout(loadRepository, 100);
                        break;
                    case 'contacts':
                        setTimeout(loadContacts, 100);
                        break;
                    case 'comments':
                        setTimeout(loadComments, 100);
                        break;
                    case 'users':
                        setTimeout(loadUsers, 100);
                        break;
                    case 'homepage':
                        setTimeout(function() {
                            loadCarousel();
                        }, 100);
                        break;
                    case 'aboutpage':
                        setTimeout(function() {
                            loadAboutContent();
                            loadTeamManagement();
                            loadTestimonialsManagement();
                        }, 100);
                        break;
                }
                
                // Hide sidebar on mobile after selection
                if (window.innerWidth <= 1024) {
                    sidebar.classList.remove('visible');
                }
            }
        }

        function updateThemeIcon(theme) {
            if (themeToggle) {
                const icon = themeToggle.querySelector('i');
                if (icon) {
                    icon.className = `fas fa-${theme === 'dark' ? 'sun' : 'moon'}`;
                }
            }
        }

        // Navigation setup will be handled in setupEventListeners function

        // Notification system
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 16px 24px;
                border-radius: 8px;
                color: white;
                font-weight: 500;
                z-index: 1001;
                animation: slideInRight 0.3s ease;
                max-width: 400px;
            `;
            
            const colors = {
                'success': '#22c55e',
                'error': '#ef4444',
                'warning': '#fbbf24',
                'info': '#06b6d4'
            };
            
            notification.style.backgroundColor = colors[type] || colors.info;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(function() {
                notification.style.animation = 'slideOutRight 0.3s ease';
                setTimeout(function() {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // Add CSS for notification animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideInRight {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
            
            @keyframes slideOutRight {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(100%);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);

        // Dashboard Data Loading Functions
        async function loadDashboardData() {
            try {
                console.log("Loading dashboard data...");
                
                // Load all data in parallel
                const [products, solutions, publications, repository, contacts] = await Promise.all([
                    AdminAPI.fetchProducts(),
                    AdminAPI.fetchSolutions(),
                    AdminAPI.fetchPublications(),
                    AdminAPI.fetchRepository(),
                    AdminAPI.fetchContacts()
                ]);
                
                console.log("Dashboard data loaded:", { products, solutions, publications, repository, contacts });
                
                // Update stat cards with real data
                updateDashboardStats(products, solutions, publications, repository, contacts);
                
                // Load recent contacts table
                loadRecentContacts(contacts);
                
            } catch (error) {
                console.error("Error loading dashboard data:", error);
                showNotification("Failed to load dashboard data", "error");
            }
        }
        
        function updateDashboardStats(products, solutions, publications, repository, contacts) {
            // Total Products
            document.getElementById('totalProducts').textContent = products.length.toLocaleString();
            
            // Total Solutions
            document.getElementById('totalSolutions').textContent = solutions.length.toLocaleString();
            
            // Total Publications
            document.getElementById('totalPublications').textContent = publications.length.toLocaleString();
            
            // Total Repository Items
            document.getElementById('totalRepository').textContent = repository.length.toLocaleString();
            
            // Contact Forms
            const unreadContacts = contacts.filter(contact => !contact.isRead).length;
            document.getElementById('totalContacts').textContent = contacts.length.toLocaleString();
            document.getElementById('unreadContacts').textContent = `${unreadContacts} unread messages`;
            
            // Total Downloads (sum from repository)
            const totalDownloads = repository.reduce((sum, item) => sum + (item.downloadCount || 0), 0);
            document.getElementById('totalDownloads').textContent = totalDownloads.toLocaleString();
            
            // Average Rating (from publications)
            const avgRating = publications.length > 0 ? 
                publications.reduce((sum, pub) => {
                    // Handle both camelCase and PascalCase property names
                    const rating = pub.averageRating || pub.AverageRating || 0;
                    return sum + rating;
                }, 0) / publications.length : 0;
            document.getElementById('averageRating').textContent = avgRating > 0 ? avgRating.toFixed(1) : '0.0';
            
            console.log('Publications for rating calculation:', publications.map(p => ({ 
                id: p.id, 
                title: p.title, 
                averageRating: p.averageRating, 
                AverageRating: p.AverageRating,
                ratingCount: p.ratingCount || p.RatingCount
            })));
            console.log('Calculated average rating:', avgRating);
            
            // Active Solutions
            const activeSolutions = solutions.filter(solution => solution.isActive).length;
            document.getElementById('activeSolutions').textContent = activeSolutions.toLocaleString();
        }
        
        function loadRecentContacts(contacts) {
            const tbody = document.querySelector('#recentContactsTable tbody');
            if (!tbody || !contacts) return;
            
            // Get the 5 most recent contacts
            const recentContacts = contacts
                .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
                .slice(0, 5);
            
            if (recentContacts.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 20px; color: var(--text-muted);">No contact forms received yet</td></tr>';
                return;
            }
            
            tbody.innerHTML = recentContacts.map(contact => `
                <tr>
                    <td>
                        <div class="table-cell-content">
                            <i class="fas fa-user table-cell-icon"></i>
                            <span style="font-weight: 600;">${contact.name}</span>
                        </div>
                    </td>
                    <td>
                        <span class="table-cell-content">
                            <i class="fas fa-envelope table-cell-icon"></i> 
                            ${contact.email}
                        </span>
                    </td>
                    <td>
                        <span style="color: var(--text-light);">${contact.subject.length > 30 ? contact.subject.substring(0, 30) + '...' : contact.subject}</span>
                    </td>
                    <td>
                        <span class="table-cell-content">
                            <i class="fas fa-calendar table-cell-icon"></i> 
                            ${new Date(contact.createdAt).toLocaleDateString()}
                        </span>
                    </td>
                    <td>
                        <span class="status-badge ${contact.isRead ? 'status-active' : 'status-pending'}">
                            <i class="fas fa-${contact.isRead ? 'check-circle' : 'clock'}"></i> 
                            ${contact.isRead ? 'Read' : 'Unread'}
                        </span>
                    </td>
                </tr>
            `).join('');
        }
        
        // Switch to contacts section
        function switchToContacts() {
            // Use the centralized switchToSection function to avoid duplication
            switchToSection('contacts');
        }

        // Handle window resize
        window.addEventListener('resize', function() {
            if (window.innerWidth > 1024) {
                sidebar.classList.remove('visible');
            }
        });

        // Add some interactive features for demo
        document.addEventListener('DOMContentLoaded', function() {
            // Add click handlers to buttons for demo (excluding specific functional buttons)
            const buttons = document.querySelectorAll('.btn');
            buttons.forEach(button => {
                // Skip login form buttons, theme toggle, mobile toggle, form submit buttons and specific functional buttons
                if (!button.closest('.login-form') && 
                    !button.id && 
                    !button.hasAttribute('onclick') &&
                    !button.closest('.section-header') &&
                    !button.closest('.modal-form') && // Skip buttons inside modal forms
                    button.type !== 'submit') { // Skip submit buttons
                    button.addEventListener('click', function(e) {
                        e.preventDefault();
                        const action = this.textContent.trim();
                        showNotification(`${action} - Feature coming soon!`, 'info');
                    });
                }
            });
        });

        // Content Management Functions

        // Content Management Functions
        // Helper function to get full image URL
        function getFullImageUrl(imageUrl) {
            if (!imageUrl || imageUrl.trim() === '') return null;
            // If URL starts with http/https, return as is
            if (imageUrl.startsWith('http://') || imageUrl.startsWith('https://')) {
                return imageUrl;
            }
            // Otherwise, prepend the API base URL
            return `${API_BASE_URL.replace('/api', '')}${imageUrl}`;
        }

        async function loadProducts() {
            const domain = document.getElementById('productDomainFilter')?.value || '';
            const search = document.getElementById('productSearch')?.value || '';
            const products = await AdminAPI.fetchProducts(domain, search);
            
            const tbody = document.querySelector('#productsTable tbody');
            if (!tbody) return;
            
            if (products.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 20px; color: var(--text-muted);">No products found. Create your first product!</td></tr>';
                return;
            }
            
            tbody.innerHTML = products.map(product => {
                const fullImageUrl = getFullImageUrl(product.imageUrl);
                return `
                <tr>
                    <td><span class="table-cell-content">#${product.id}</span></td>
                    <td>
                        <div class="table-cell-content">
                            <div class="product-image-container" style="width: 32px; height: 32px; margin-right: 12px; flex-shrink: 0;">
                                ${fullImageUrl ? 
                                    `<img src="${fullImageUrl}" alt="${product.title}" 
                                         style="width: 100%; height: 100%; border-radius: 6px; object-fit: cover; border: 1px solid var(--glass-border);" 
                                         onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                     <div class="fallback-icon" style="display: none; width: 100%; height: 100%; background: var(--glass-bg); border-radius: 6px; align-items: center; justify-content: center; border: 1px solid var(--glass-border);">
                                         <i class="fas fa-box" style="color: var(--primary); font-size: 14px;"></i>
                                     </div>` : 
                                    `<div class="fallback-icon" style="width: 100%; height: 100%; background: var(--glass-bg); border-radius: 6px; display: flex; align-items: center; justify-content: center; border: 1px solid var(--glass-border);">
                                         <i class="fas fa-box" style="color: var(--primary); font-size: 14px;"></i>
                                     </div>`
                                }
                            </div>
                            <div>
                                <div style="font-weight: 600; margin-bottom: 2px;">${product.title}</div>
                                <div style="font-size: 0.8rem; color: var(--text-muted);">${product.shortDescription ? product.shortDescription.substring(0, 40) + '...' : 'No description'}</div>
                            </div>
                        </div>
                    </td>
                    <td><span class="status-badge status-active" style="background: var(--primary); color: white;">${product.domain || 'Unknown'}</span></td>
                    <td><span style="color: var(--text-light);">${product.shortDescription ? product.shortDescription.substring(0, 60) + '...' : 'No description available'}</span></td>
                    <td><span class="table-cell-content"><i class="fas fa-calendar table-cell-icon"></i> ${new Date(product.createdAt).toLocaleDateString()}</span></td>
                    <td>
                        <div class="table-actions">
                            <button class="btn btn-view" onclick="viewProduct(${product.id})" title="View Product"><i class="fas fa-eye"></i></button>
                            <button class="btn btn-warning" onclick="editProduct(${product.id})" title="Edit Product"><i class="fas fa-edit"></i></button>
                            <button class="btn btn-danger" onclick="deleteProduct(${product.id})" title="Delete Product"><i class="fas fa-trash"></i></button>
                        </div>
                    </td>
                </tr>
            `}).join('');
        }

        async function loadSolutions() {
            console.log('Loading solutions...');
            const area = document.getElementById('solutionAreaFilter')?.value || '';
            const search = document.getElementById('solutionSearch')?.value || '';
            console.log('Filters - area:', area, 'search:', search);
            
            const solutions = await AdminAPI.fetchSolutions(area, search);
            console.log('Solutions loaded:', solutions);
            
            const tbody = document.querySelector('#solutionsTable tbody');
            if (!tbody) {
                console.error('Solutions table body not found!');
                return;
            }
            
            if (solutions.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 20px; color: var(--text-muted);">No solutions found. Create your first solution!</td></tr>';
                return;
            }
            
            tbody.innerHTML = solutions.map(solution => {
                const fullImageUrl = getFullImageUrl(solution.demoImageUrl);
                return `
                <tr>
                    <td>${solution.id}</td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div class="solution-image-container" style="width: 40px; height: 40px; flex-shrink: 0;">
                                ${fullImageUrl ? 
                                    `<img src="${fullImageUrl}" alt="${solution.title}" 
                                         style="width: 100%; height: 100%; border-radius: 6px; object-fit: cover; border: 1px solid var(--glass-border);" 
                                         onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                     <div class="fallback-icon" style="display: none; width: 100%; height: 100%; background: var(--glass-bg); border-radius: 6px; align-items: center; justify-content: center; border: 1px solid var(--glass-border);">
                                         <i class="fas fa-lightbulb" style="color: var(--primary); font-size: 18px;"></i>
                                     </div>` : 
                                    `<div class="fallback-icon" style="width: 100%; height: 100%; background: var(--glass-bg); border-radius: 6px; display: flex; align-items: center; justify-content: center; border: 1px solid var(--glass-border);">
                                         <i class="fas fa-lightbulb" style="color: var(--primary); font-size: 18px;"></i>
                                     </div>`
                                }
                            </div>
                            <div>
                                <div style="font-weight: 600;">${solution.title}</div>
                                <div style="font-size: 0.8rem; color: var(--text-muted);">${solution.summary ? solution.summary.substring(0, 40) + '...' : 'No summary available'}</div>
                            </div>
                        </div>
                    </td>
                    <td><span class="problem-area-badge" style="background: var(--primary); color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.75rem; font-weight: 500;">${solution.problemArea || 'General'}</span></td>
                    <td><span class="status-badge ${solution.isActive ? 'status-active' : 'status-inactive'}">${solution.isActive ? 'Active' : 'Inactive'}</span></td>
                    <td style="text-align: center;">
                        ${solution.demoVideoUrl && solution.demoVideoUrl.trim() !== '' ? 
                            `<button class="btn btn-info" style="padding: 4px 8px; font-size: 0.8rem;" onclick="viewSolutionDemo('${solution.demoVideoUrl}', '${solution.title.replace(/'/g, "\\'")}')"><i class="fas fa-play"></i> Demo</button>` : 
                            '<span style="color: var(--text-muted); font-size: 0.8rem;">No Demo</span>'
                        }
                    </td>
                    <td>
                        <div style="display: flex; gap: 4px;">
                            <button class="btn btn-warning" style="padding: 4px 8px; font-size: 0.8rem;" onclick="editSolution(${solution.id})" title="Edit Solution"><i class="fas fa-edit"></i></button>
                            <button class="btn btn-danger" style="padding: 4px 8px; font-size: 0.8rem;" onclick="deleteSolution(${solution.id})" title="Delete Solution"><i class="fas fa-trash"></i></button>
                        </div>
                    </td>
                </tr>
            `}).join('');
        }

        async function loadPublications() {
            const domain = document.getElementById('publicationDomainFilter')?.value || '';
            const search = document.getElementById('publicationSearch')?.value || '';
            const publications = await AdminAPI.fetchPublications(domain, search);
            
            const tbody = document.querySelector('#publicationsTable tbody');
            if (!tbody) return;
            
            if (publications.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 20px; color: var(--text-muted);">No publications found. Create your first publication!</td></tr>';
                return;
            }
            
            tbody.innerHTML = publications.map(pub => {
                const fullImageUrl = getFullImageUrl(pub.thumbnailUrl);
                return `
                <tr>
                    <td><span class="table-cell-content">#${pub.id}</span></td>
                    <td>
                        <div class="table-cell-content">
                            <div class="publication-image-container" style="width: 32px; height: 32px; margin-right: 12px; flex-shrink: 0;">
                                ${fullImageUrl ? 
                                    `<img src="${fullImageUrl}" alt="${pub.title}" 
                                         style="width: 100%; height: 100%; border-radius: 6px; object-fit: cover; border: 1px solid var(--glass-border);" 
                                         onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                     <div class="fallback-icon" style="display: none; width: 100%; height: 100%; background: var(--glass-bg); border-radius: 6px; align-items: center; justify-content: center; border: 1px solid var(--glass-border);">
                                         <i class="fas fa-file-alt" style="color: var(--primary); font-size: 14px;"></i>
                                     </div>` : 
                                    `<div class="fallback-icon" style="width: 100%; height: 100%; background: var(--glass-bg); border-radius: 6px; display: flex; align-items: center; justify-content: center; border: 1px solid var(--glass-border);">
                                         <i class="fas fa-file-alt" style="color: var(--primary); font-size: 14px;"></i>
                                     </div>`
                                }
                            </div>
                            <div>
                                <div style="font-weight: 600; margin-bottom: 2px;">${pub.title}</div>
                                <div style="font-size: 0.8rem; color: var(--text-muted);">${pub.abstract ? pub.abstract.substring(0, 40) + '...' : 'No abstract available'}</div>
                            </div>
                        </div>
                    </td>
                    <td><span style="color: var(--text-light);">${pub.authors || 'Unknown Author'}</span></td>
                    <td><span class="status-badge status-active" style="background: var(--info); color: white;">${pub.domain || 'General'}</span></td>
                    <td><span class="table-cell-content"><i class="fas fa-star" style="color: var(--warning);"></i> ${(pub.averageRating || 0).toFixed(1)} (${pub.ratingCount || 0})</span></td>
                    <td><span class="table-cell-content"><i class="fas fa-calendar table-cell-icon"></i> ${new Date(pub.publishedDate).toLocaleDateString()}</span></td>
                    <td>
                        <div class="table-actions">
                            <button class="btn btn-view" onclick="viewPublication(${pub.id})" title="View Publication"><i class="fas fa-eye"></i></button>
                            <button class="btn btn-warning" onclick="editPublication(${pub.id})" title="Edit Publication"><i class="fas fa-edit"></i></button>
                            <button class="btn btn-danger" onclick="deletePublication(${pub.id})" title="Delete Publication"><i class="fas fa-trash"></i></button>
                        </div>
                    </td>
                </tr>
            `}).join('');
        }

        async function loadRepository() {
            const category = document.getElementById('repositoryCategoryFilter')?.value || '';
            const type = document.getElementById('repositoryTypeFilter')?.value || '';
            const items = await AdminAPI.fetchRepository(category, type);
            
            const tbody = document.querySelector('#repositoryTable tbody');
            if (!tbody) return;
            
            if (items.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 20px; color: var(--text-muted);">No repository items found. Create your first repository item!</td></tr>';
                return;
            }
            
            tbody.innerHTML = items.map(item => `
                <tr>
                    <td><span class="table-cell-content">#${item.id}</span></td>
                    <td>
                        <div class="table-cell-content">
                            <div class="repo-icon-container" style="width: 32px; height: 32px; margin-right: 12px; flex-shrink: 0;">
                                <div class="fallback-icon" style="width: 100%; height: 100%; background: var(--glass-bg); border-radius: 6px; display: flex; align-items: center; justify-content: center; border: 1px solid var(--glass-border);">
                                    <i class="fas fa-code-branch" style="color: var(--primary); font-size: 14px;"></i>
                                </div>
                            </div>
                            <div>
                                <div style="font-weight: 600; margin-bottom: 2px;">${item.title}</div>
                                <div style="font-size: 0.8rem; color: var(--text-muted);">${item.description ? item.description.substring(0, 40) + '...' : 'No description available'}</div>
                            </div>
                        </div>
                    </td>
                    <td><span class="status-badge status-active" style="background: var(--neutral); color: white;">${item.category || 'General'}</span></td>
                    <td><span class="status-badge ${item.isFree ? 'status-active' : 'status-warning'}">${item.isFree ? 'Free' : 'Premium'}</span></td>
                    <td><span class="table-cell-content"><i class="fas fa-code table-cell-icon"></i> v${item.version || '1.0.0'}</span></td>
                    <td><span class="table-cell-content"><i class="fas fa-download table-cell-icon"></i> ${(item.downloadCount || 0).toLocaleString()}</span></td>
                    <td>
                        <div class="table-actions">
                            <button class="btn btn-view" onclick="viewRepositoryItem(${item.id})" title="View Repository Item"><i class="fas fa-eye"></i></button>
                            <button class="btn btn-warning" onclick="editRepositoryItem(${item.id})" title="Edit Repository Item"><i class="fas fa-edit"></i></button>
                            <button class="btn btn-danger" onclick="deleteRepositoryItem(${item.id})" title="Delete Repository Item"><i class="fas fa-trash"></i></button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        async function loadContacts() {
            const status = document.getElementById('contactStatusFilter')?.value || '';
            const search = document.getElementById('contactSearch')?.value || '';
            const contacts = await AdminAPI.fetchContacts(status, search);
            
            const tbody = document.querySelector('#contactsTable tbody');
            if (!tbody) return;
            
            if (contacts.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 20px; color: var(--text-muted);">No contact forms received yet. Waiting for visitors to reach out!</td></tr>';
                return;
            }
            
            tbody.innerHTML = contacts.map(contact => `
                <tr>
                    <td><span class="table-cell-content">#${contact.id}</span></td>
                    <td>
                        <div class="table-cell-content">
                            <div class="contact-icon-container" style="width: 32px; height: 32px; margin-right: 12px; flex-shrink: 0;">
                                <div class="fallback-icon" style="width: 100%; height: 100%; background: var(--glass-bg); border-radius: 6px; display: flex; align-items: center; justify-content: center; border: 1px solid var(--glass-border);">
                                    <i class="fas fa-user" style="color: var(--primary); font-size: 14px;"></i>
                                </div>
                            </div>
                            <div>
                                <div style="font-weight: 600;">${contact.name || 'Anonymous'}</div>
                            </div>
                        </div>
                    </td>
                    <td><span class="table-cell-content"><i class="fas fa-envelope table-cell-icon"></i> ${contact.email || 'No email provided'}</span></td>
                    <td><span style="color: var(--text-light);">${contact.subject || 'No subject'}</span></td>
                    <td><span class="table-cell-content"><i class="fas fa-calendar table-cell-icon"></i> ${new Date(contact.createdAt).toLocaleDateString()}</span></td>
                    <td><span class="status-badge ${contact.isRead ? 'status-active' : 'status-pending'}"><i class="fas fa-${contact.isRead ? 'check-circle' : 'clock'}"></i> ${contact.isRead ? 'Read' : 'Unread'}</span></td>
                    <td>
                        <div class="table-actions">
                            <button class="btn btn-view" onclick="viewContact(${contact.id})" title="View Contact"><i class="fas fa-eye"></i></button>
                            <button class="btn btn-danger" onclick="deleteContact(${contact.id})" title="Delete Contact"><i class="fas fa-trash"></i></button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // Modal Management Functions
        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('show');
                document.body.style.overflow = 'hidden';
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('show');
                document.body.style.overflow = 'auto';
                // Clear form data
                const form = modal.querySelector('form');
                if (form) form.reset();
            }
        }

        // Close modal when clicking outside
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal-overlay')) {
                const modalId = e.target.id;
                closeModal(modalId);
            }
        });

        // Close modal with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const openModal = document.querySelector('.modal-overlay.show');
                if (openModal) {
                    closeModal(openModal.id);
                }
            }
        });

        // Show Modal Functions
        function showAddProductModal() {
            // Reset form for adding new product
            document.getElementById('productForm').reset();
            document.getElementById('productId').value = '';
            document.getElementById('productModalTitle').innerHTML = '<i class="fas fa-plus"></i> Add New Product';
            document.getElementById('productSubmitBtn').innerHTML = '<i class="fas fa-save"></i> Create Product';
            document.getElementById('productImage').setAttribute('required', 'required');
            document.getElementById('currentImagePreview').style.display = 'none';
            showModal('productModal');
        }

        function showAddSolutionModal() {
            // Reset form for adding new solution
            document.getElementById('solutionForm').reset();
            document.getElementById('solutionId').value = '';
            document.getElementById('solutionModalTitle').innerHTML = '<i class="fas fa-plus"></i> Add New Solution';
            document.getElementById('solutionSubmitBtn').innerHTML = '<i class="fas fa-save"></i> Create Solution';
            document.getElementById('solutionImage').removeAttribute('required');
            document.getElementById('currentSolutionImagePreview').style.display = 'none';
            // Populate problem areas to match categories on solutions page
            populateSolutionProblemAreas('');
            showModal('solutionModal');
        }

        function showAddPublicationModal() {
            // Reset form for adding new publication
            document.getElementById('publicationForm').reset();
            
            // Remove any existing hidden ID field
            const existingIdField = document.getElementById('publicationId');
            if (existingIdField) {
                existingIdField.remove();
            }
            
            // Update modal title and button text
            const modalTitle = document.querySelector('#publicationModal .modal-header h3');
            const submitBtn = document.querySelector('#publicationModal button[type="submit"]');
            if (modalTitle) modalTitle.innerHTML = '<i class="fas fa-plus"></i> Add New Publication';
            if (submitBtn) submitBtn.innerHTML = '<i class="fas fa-save"></i> Create Publication';
            
            // Hide current image preview
            const currentImagePreview = document.getElementById('currentPublicationImagePreview');
            if (currentImagePreview) {
                currentImagePreview.style.display = 'none';
            }
            
            // Make file fields optional for new publications
            const thumbnailField = document.querySelector('#publicationModal input[name="thumbnailFile"]');
            const documentField = document.querySelector('#publicationModal input[name="documentFile"]');
            if (thumbnailField) thumbnailField.removeAttribute('required');
            if (documentField) documentField.removeAttribute('required');
            
            showModal('publicationModal');
        }

        function showAddRepositoryModal() {
            // Reset form for adding new repository
            document.getElementById('repositoryForm').reset();
            document.getElementById('repositoryId').value = '';
            document.getElementById('repositoryModalTitle').innerHTML = '<i class="fas fa-plus"></i> Add New Repository Item';
            document.getElementById('repositorySubmitBtn').innerHTML = '<i class="fas fa-save"></i> Create Repository Item';
            
            // Set default pricing to free
            const freeRadio = document.querySelector('input[name="pricing"][value="free"]');
            if (freeRadio) {
                freeRadio.checked = true;
            }
            
            showModal('repositoryModal');
        }

        // About Page - Team & Testimonials CRUD Functions
        function showAddTeamMemberModal() {
            const form = document.getElementById('teamMemberForm');
            form.reset();
            document.getElementById('teamMemberId').value = '';
            document.getElementById('teamMemberModalTitle').innerHTML = '<i class="fas fa-plus"></i> Add New Team Member';
            document.getElementById('teamMemberSubmitBtn').innerHTML = '<i class="fas fa-save"></i> Create Member';
            document.getElementById('currentTeamMemberImagePreview').style.display = 'none';
            showModal('teamMemberModal');
        }

        async function loadTeamManagement() {
            try {
                const response = await fetch(`${API_BASE_URL}/About/team`);
                const teamMembers = response.ok ? await response.json() : [];
                const tbody = document.querySelector('#teamTable tbody');
                if (!tbody) return;

                if (teamMembers.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 20px; color: var(--text-muted);">No team members found. Add your first team member!</td></tr>';
                    return;
                }

                tbody.innerHTML = teamMembers.map(tm => {
                    const fullImageUrl = getFullImageUrl(tm.photoUrl);
                    const activeBadge = tm.isActive ? '<span class="status-badge status-active">Active</span>' : '<span class="status-badge status-inactive">Inactive</span>';
                    return `
                        <tr>
                            <td>#${tm.id}</td>
                            <td>${tm.firstName} ${tm.lastName}</td>
                            <td>${tm.position || ''}</td>
                            <td>
                                <div style="width: 40px; height: 40px;">
                                    ${fullImageUrl ? `<img src="${fullImageUrl}" alt="${tm.firstName}" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover; border: 1px solid var(--glass-border);" onerror="this.style.display='none'">` : '<div class="fallback-icon" style="width: 40px; height: 40px; border-radius: 50%; background: var(--glass-bg); display: flex; align-items: center; justify-content: center; border: 1px solid var(--glass-border);"><i class="fas fa-user" style="color: var(--primary);"></i></div>'}
                                </div>
                            </td>
                            <td>${tm.displayOrder}</td>
                            <td>${activeBadge}</td>
                            <td>
                                <div class="table-actions">
                                    <button class="btn btn-warning" onclick="editTeamMemberAdmin(${tm.id})" title="Edit"><i class="fas fa-edit"></i></button>
                                    <button class="btn btn-danger" onclick="deleteTeamMemberAdmin(${tm.id})" title="Delete"><i class="fas fa-trash"></i></button>
                                </div>
                            </td>
                        </tr>
                    `;
                }).join('');
            } catch (error) {
                console.error('Error loading team members:', error);
                showNotification('Failed to load team members', 'error');
            }
        }

        async function editTeamMemberAdmin(id) {
            try {
                const token = getAuthToken();
                const headers = token ? { 'Authorization': `Bearer ${token}` } : {};
                const resp = await fetch(`${API_BASE_URL}/About/team/${id}`, { headers });
                if (!resp.ok) throw new Error('Failed to fetch team member');
                const member = await resp.json();

                document.getElementById('teamMemberId').value = member.id;
                document.getElementById('teamMemberFirstName').value = member.firstName || '';
                document.getElementById('teamMemberLastName').value = member.lastName || '';
                document.getElementById('teamMemberPosition').value = member.position || '';
                document.getElementById('teamMemberDepartment').value = member.department || '';
                document.getElementById('teamMemberEmail').value = member.email || '';
                document.getElementById('teamMemberBio').value = member.bio || '';
                document.getElementById('teamMemberLinkedIn').value = member.linkedInUrl || '';
                document.getElementById('teamMemberTwitter').value = member.twitterUrl || '';
                document.getElementById('teamMemberOrder').value = member.displayOrder ?? 0;
                document.getElementById('teamMemberActive').checked = member.isActive;

                const fullImageUrl = getFullImageUrl(member.photoUrl);
                const previewWrap = document.getElementById('currentTeamMemberImagePreview');
                const img = document.getElementById('currentTeamMemberImage');
                if (fullImageUrl) {
                    img.src = fullImageUrl;
                    previewWrap.style.display = 'block';
                } else {
                    previewWrap.style.display = 'none';
                }

                document.getElementById('teamMemberModalTitle').innerHTML = '<i class="fas fa-edit"></i> Edit Team Member';
                document.getElementById('teamMemberSubmitBtn').innerHTML = '<i class="fas fa-save"></i> Update Member';
                showModal('teamMemberModal');
            } catch (error) {
                console.error('Error fetching team member:', error);
                showNotification('Failed to load team member', 'error');
            }
        }

        async function deleteTeamMemberAdmin(id) {
            if (!confirm('Are you sure you want to delete this team member?')) return;
            try {
                const token = getAuthToken();
                const headers = token ? { 'Authorization': `Bearer ${token}` } : {};
                const resp = await fetch(`${API_BASE_URL}/About/team/${id}`, { method: 'DELETE', headers });
                if (resp.ok) {
                    showNotification('Team member deleted successfully', 'success');
                    loadTeamManagement();
                } else {
                    const text = await resp.text();
                    showNotification(`Failed to delete team member: ${text}`, 'error');
                }
            } catch (error) {
                console.error('Error deleting team member:', error);
                showNotification('Failed to delete team member', 'error');
            }
        }

        async function submitTeamMemberForm(formData) {
            try {
                const token = getAuthToken();
                const headers = token ? { 'Authorization': `Bearer ${token}` } : {};
                const id = formData.get('teamMemberId');
                const isEditing = id && id !== '';
                const url = isEditing ? `${API_BASE_URL}/About/team/${id}` : `${API_BASE_URL}/About/team/upload`;
                const method = isEditing ? 'PUT' : 'POST';

                const resp = await fetch(url, { method, headers, body: formData });
                if (resp.ok) {
                    showNotification(`Team member ${isEditing ? 'updated' : 'created'} successfully`, 'success');
                    closeModal('teamMemberModal');
                    loadTeamManagement();
                    return true;
                } else {
                    const text = await resp.text();
                    showNotification(`Error (${resp.status}): ${text || 'Unknown error'}`, 'error');
                    return false;
                }
            } catch (error) {
                console.error('Error submitting team member:', error);
                showNotification('Failed to submit team member', 'error');
                return false;
            }
        }

        function showAddTestimonialModal() {
            const form = document.getElementById('testimonialForm');
            form.reset();
            document.getElementById('testimonialId').value = '';
            document.getElementById('testimonialModalTitle').innerHTML = '<i class="fas fa-plus"></i> Add New Testimonial';
            document.getElementById('testimonialSubmitBtn').innerHTML = '<i class="fas fa-save"></i> Create Testimonial';
            document.getElementById('currentTestimonialImagePreview').style.display = 'none';
            showModal('testimonialModal');
        }

        async function loadTestimonialsManagement() {
            try {
                const response = await fetch(`${API_BASE_URL}/About/testimonials`);
                const testimonials = response.ok ? await response.json() : [];
                const tbody = document.querySelector('#testimonialsTable tbody');
                if (!tbody) return;

                if (testimonials.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 20px; color: var(--text-muted);">No testimonials found. Add your first testimonial!</td></tr>';
                    return;
                }

                tbody.innerHTML = testimonials.map(t => {
                    const fullImageUrl = getFullImageUrl(t.clientPhotoUrl);
                    const activeBadge = t.isActive ? '<span class="status-badge status-active">Active</span>' : '<span class="status-badge status-inactive">Inactive</span>';
                    return `
                        <tr>
                            <td>#${t.id}</td>
                            <td>${t.clientName}</td>
                            <td>${t.companyName || ''}</td>
                            <td>${t.message?.substring(0, 60) || ''}...</td>
                            <td><span class="table-cell-content"><i class="fas fa-star" style="color: var(--warning);"></i> ${t.rating}</span></td>
                            <td>${activeBadge}</td>
                            <td>
                                <div class="table-actions">
                                    <button class="btn btn-warning" onclick="editTestimonialAdmin(${t.id})" title="Edit"><i class="fas fa-edit"></i></button>
                                    <button class="btn btn-danger" onclick="deleteTestimonialAdmin(${t.id})" title="Delete"><i class="fas fa-trash"></i></button>
                                </div>
                            </td>
                        </tr>
                    `;
                }).join('');
            } catch (error) {
                console.error('Error loading testimonials:', error);
                showNotification('Failed to load testimonials', 'error');
            }
        }

        async function editTestimonialAdmin(id) {
            try {
                const token = getAuthToken();
                const headers = token ? { 'Authorization': `Bearer ${token}` } : {};
                const resp = await fetch(`${API_BASE_URL}/About/testimonials/${id}`, { headers });
                if (!resp.ok) throw new Error('Failed to fetch testimonial');
                const t = await resp.json();

                document.getElementById('testimonialId').value = t.id;
                document.getElementById('testimonialClientName').value = t.clientName || '';
                document.getElementById('testimonialClientPosition').value = t.clientPosition || '';
                document.getElementById('testimonialCompanyName').value = t.companyName || '';
                document.getElementById('testimonialMessage').value = t.message || '';
                document.getElementById('testimonialRating').value = t.rating || 5;
                document.getElementById('testimonialOrder').value = t.displayOrder ?? 0;
                document.getElementById('testimonialActive').checked = t.isActive;

                const clientImg = getFullImageUrl(t.clientPhotoUrl);
                const previewWrap = document.getElementById('currentTestimonialImagePreview');
                const clientImgEl = document.getElementById('currentTestimonialClientImage');
                
                if (clientImgEl) {
                    clientImgEl.style.display = 'none';
                    if (clientImg) { 
                        clientImgEl.src = clientImg; 
                        clientImgEl.style.display = 'block'; 
                    }
                }
                
                if (previewWrap) {
                    previewWrap.style.display = clientImg ? 'block' : 'none';
                }

                document.getElementById('testimonialModalTitle').innerHTML = '<i class="fas fa-edit"></i> Edit Testimonial';
                document.getElementById('testimonialSubmitBtn').innerHTML = '<i class="fas fa-save"></i> Update Testimonial';
                showModal('testimonialModal');
            } catch (error) {
                console.error('Error fetching testimonial:', error);
                showNotification('Failed to load testimonial', 'error');
            }
        }

        async function deleteTestimonialAdmin(id) {
            if (!confirm('Are you sure you want to delete this testimonial?')) return;
            try {
                const token = getAuthToken();
                const headers = token ? { 'Authorization': `Bearer ${token}` } : {};
                const resp = await fetch(`${API_BASE_URL}/About/testimonials/${id}`, { method: 'DELETE', headers });
                if (resp.ok) {
                    showNotification('Testimonial deleted successfully', 'success');
                    loadTestimonialsManagement();
                } else {
                    const text = await resp.text();
                    showNotification(`Failed to delete testimonial: ${text}`, 'error');
                }
            } catch (error) {
                console.error('Error deleting testimonial:', error);
                showNotification('Failed to delete testimonial', 'error');
            }
        }

        async function submitTestimonialForm(formData) {
            try {
                const token = getAuthToken();
                const headers = token ? { 'Authorization': `Bearer ${token}` } : {};
                const id = formData.get('testimonialId');
                const isEditing = id && id !== '';
                const url = isEditing ? `${API_BASE_URL}/About/testimonials/${id}` : `${API_BASE_URL}/About/testimonials`;
                const method = isEditing ? 'PUT' : 'POST';

                const resp = await fetch(url, { method, headers, body: formData });
                if (resp.ok) {
                    showNotification(`Testimonial ${isEditing ? 'updated' : 'created'} successfully`, 'success');
                    closeModal('testimonialModal');
                    loadTestimonialsManagement();
                    return true;
                } else {
                    const text = await resp.text();
                    showNotification(`Error (${resp.status}): ${text || 'Unknown error'}`, 'error');
                    return false;
                }
            } catch (error) {
                console.error('Error submitting testimonial:', error);
                showNotification('Failed to submit testimonial', 'error');
                return false;
            }
        }

        // Form Submission Functions
        async function submitProductForm(formData) {
            try {
                const productId = formData.get('productId');
                const isEditing = productId && productId !== '';
                
                console.log(`${isEditing ? 'Updating' : 'Creating'} product with data:`, formData);
                
                // Log form data contents
                for (let [key, value] of formData.entries()) {
                    console.log(`${key}:`, value);
                }
                
                let apiUrl, method;
                if (isEditing) {
                    // For editing, use PUT method to the specific product endpoint (no /upload)
                    apiUrl = `${API_BASE_URL}/Products/${productId}`;
                    method = 'PUT';
                } else {
                    // For creating, use POST method to upload endpoint
                    apiUrl = `${API_BASE_URL}/Products/upload`;
                    method = 'POST';
                }
                
                console.log('API URL:', apiUrl);
                console.log('Method:', method);
                
                // Add authentication token to headers
                const token = getAuthToken();
                const headers = {};
                if (token) {
                    headers['Authorization'] = `Bearer ${token}`;
                }
                
                const response = await fetch(apiUrl, {
                    method: method,
                    headers: headers,
                    body: formData
                });
                
                console.log('Response status:', response.status);
                console.log('Response headers:', response.headers);

                if (response.ok) {
                    let result;
                    if (isEditing) {
                        // PUT returns NoContent (204), so no JSON to parse
                        result = { success: true };
                        console.log('Update successful');
                    } else {
                        // POST returns JSON with created product
                        result = await response.json();
                        console.log('Success result:', result);
                    }
                    showNotification(`Product ${isEditing ? 'updated' : 'created'} successfully!`, 'success');
                    closeModal('productModal');
                    loadProducts();
                    return true;
                } else {
                    const error = await response.text();
                    console.error('API Error Response:', error);
                    showNotification(`Error (${response.status}): ${error || 'Unknown error'}`, 'error');
                    return false;
                }
            } catch (error) {
                console.error('Network/Fetch Error with product:', error);
                showNotification(`Failed to ${formData.get('productId') ? 'update' : 'create'} product: ${error.message}`, 'error');
                return false;
            }
        }

        async function submitSolutionForm(formData) {
            try {
                const solutionId = formData.get('solutionId');
                const isEditing = solutionId && solutionId !== '';
                
                console.log(`${isEditing ? 'Updating' : 'Creating'} solution with data:`, formData);
                
                // Log form data contents
                for (let [key, value] of formData.entries()) {
                    console.log(`${key}:`, value);
                }
                
                let apiUrl, method, headers = {}, requestBody;
                if (isEditing) {
                    // Decide between JSON or multipart based on whether a new image file is provided
                    const demoImage = formData.get('demoImageFile');
                    const hasNewDemoImage = demoImage && demoImage instanceof File && demoImage.size > 0;

                    apiUrl = `${API_BASE_URL}/Solutions/${solutionId}`;
                    method = 'PUT';

                    if (hasNewDemoImage) {
                        // Send multipart/form-data to update image and fields
                        requestBody = formData;
                        console.log('Sending multipart data for solution update with image');
                    } else {
                        // Send JSON body for normal field updates
                        headers['Content-Type'] = 'application/json';
                        const dto = {};
                        const copyIfPresent = (key, outKey = key) => {
                            const value = formData.get(key);
                            if (value != null && String(value).trim() !== '') dto[outKey] = String(value).trim();
                        };
                        copyIfPresent('title', 'title');
                        copyIfPresent('summary', 'summary');
                        copyIfPresent('problemArea', 'problemArea');
                        copyIfPresent('demoVideoUrl', 'demoVideoUrl');
                        // demoImageUrl can also be updated directly via URL if provided in form
                        copyIfPresent('demoImageUrl', 'demoImageUrl');
                        requestBody = JSON.stringify(dto);
                        console.log('Sending JSON data for solution update without image:', dto);
                    }
                } else {
                    // For creating, use POST method to upload endpoint
                    apiUrl = `${API_BASE_URL}/Solutions/upload`;
                    method = 'POST';
                    requestBody = formData;
                }
                
                console.log('API URL:', apiUrl);
                console.log('Method:', method);
                console.log('Headers:', headers);
                console.log('Request body type:', requestBody instanceof FormData ? 'FormData' : typeof requestBody);
                
                // Add authentication token to headers
                const token = getAuthToken();
                if (token) {
                    headers['Authorization'] = `Bearer ${token}`;
                }
                
                const response = await fetch(apiUrl, {
                    method: method,
                    headers: headers,
                    body: requestBody
                });
                
                console.log('Response status:', response.status);
                console.log('Response headers:', response.headers);

                if (response.ok) {
                    let result;
                    if (isEditing) {
                        // PUT returns NoContent (204), so no JSON to parse
                        result = { success: true };
                        console.log('Update successful');
                    } else {
                        // POST returns JSON with created solution
                        result = await response.json();
                        console.log('Success result:', result);
                    }
                    showNotification(`Solution ${isEditing ? 'updated' : 'created'} successfully!`, 'success');
                    closeModal('solutionModal');
                    loadSolutions();
                    return true;
                } else {
                    const error = await response.text();
                    console.error('API Error Response:', error);
                    showNotification(`Error (${response.status}): ${error || 'Unknown error'}`, 'error');
                    return false;
                }
            } catch (error) {
                console.error('Network/Fetch Error with solution:', error);
                showNotification(`Failed to ${formData.get('solutionId') ? 'update' : 'create'} solution: ${error.message}`, 'error');
                return false;
            }
        }

        async function submitPublicationForm(formData) {
            try {
                const publicationId = formData.get('publicationId');
                const isEditing = publicationId && publicationId !== '';
                
                console.log(`${isEditing ? 'Updating' : 'Creating'} publication with data:`, formData);
                
                // Log form data contents
                for (let [key, value] of formData.entries()) {
                    console.log(`${key}:`, value);
                }
                
                let apiUrl, method, headers, requestBody;
                
                // Add authentication token to headers
                const token = getAuthToken();
                headers = {};
                if (token) {
                    headers['Authorization'] = `Bearer ${token}`;
                }
                
                if (isEditing) {
                    // For editing, send JSON body as the API expects [FromBody] JSON (not multipart/form-data)
                    apiUrl = `${API_BASE_URL}/Publications/${publicationId}`;
                    method = 'PUT';
                    headers['Content-Type'] = 'application/json';
                    const dto = {};
                    const copyIfPresent = (key) => {
                        const value = formData.get(key);
                        if (value != null && String(value).trim() !== '') dto[key] = String(value).trim();
                    };
                    copyIfPresent('title');
                    copyIfPresent('authors');
                    copyIfPresent('domain');
                    copyIfPresent('abstract');
                    copyIfPresent('keywords');
                    const publishedDate = formData.get('publishedDate');
                    if (publishedDate) dto.publishedDate = String(publishedDate);
                    // Optional: include isPublished checkbox if present
                    if (formData.has('isPublished')) {
                        const isPublished = formData.get('isPublished');
                        if (isPublished !== null) dto.isPublished = isPublished === 'on' || isPublished === 'true' || isPublished === true;
                    }
                    requestBody = JSON.stringify(dto);
                } else {
                    // For creating, use POST method with FormData (supports file uploads)
                    apiUrl = `${API_BASE_URL}/Publications/upload`;
                    method = 'POST';
                    // Don't set Content-Type for FormData, let browser set it with boundary
                    requestBody = formData;
                }
                
                console.log('API URL:', apiUrl);
                console.log('Method:', method);
                
                const response = await fetch(apiUrl, {
                    method: method,
                    headers: headers,
                    body: requestBody
                });
                
                console.log('Response status:', response.status);
                console.log('Response headers:', response.headers);

                if (response.ok) {
                    let result;
                    if (isEditing) {
                        // PUT returns NoContent (204), so no JSON to parse
                        result = { success: true };
                        console.log('Update successful');
                    } else {
                        // POST returns JSON with created publication
                        result = await response.json();
                        console.log('Success result:', result);
                    }
                    showNotification(`Publication ${isEditing ? 'updated' : 'created'} successfully!`, 'success');
                    closeModal('publicationModal');
                    loadPublications();
                    
                    // Also update dashboard if we're on dashboard
                    const currentSection = document.querySelector('.content-section.active');
                    if (currentSection && currentSection.id === 'dashboard') {
                        await loadDashboardData();
                    }
                    
                    return true;
                } else {
                    const error = await response.text();
                    console.error('API Error Response:', error);
                    showNotification(`Error (${response.status}): ${error || 'Unknown error'}`, 'error');
                    return false;
                }
            } catch (error) {
                console.error('Network/Fetch Error with publication:', error);
                showNotification(`Failed to ${formData.get('publicationId') ? 'update' : 'create'} publication: ${error.message}`, 'error');
                return false;
            }
        }

        async function submitRepositoryForm(formData) {
            try {
                const repositoryId = formData.get('repositoryId');
                const isEditing = repositoryId && repositoryId !== '';
                
                console.log(`${isEditing ? 'Updating' : 'Creating'} repository with data:`, Object.fromEntries(formData));
                
                const token = getAuthToken(); // Use the proper auth token function
                const headers = {
                    'Content-Type': 'application/json'
                };
                
                if (token) {
                    headers['Authorization'] = `Bearer ${token}`;
                }
                
                // Prepare the data object
                const data = {
                    title: formData.get('title'),
                    description: formData.get('description'),
                    tags: formData.get('tags') || '',
                    githubUrl: formData.get('githubUrl') || '',
                    license: formData.get('license') || '',
                    version: formData.get('version') || '',
                    category: formData.get('category') || '',
                    technicalStack: formData.get('technicalStack') || '',
                    isFree: formData.get('pricing') === 'free',
                    isPremium: formData.get('pricing') === 'premium'
                };
                
                let apiUrl, method;
                if (isEditing) {
                    apiUrl = `${API_BASE_URL}/Repository/${repositoryId}`;
                    method = 'PUT';
                } else {
                    apiUrl = `${API_BASE_URL}/Repository`;
                    method = 'POST';
                }
                
                console.log('API URL:', apiUrl);
                console.log('Method:', method);
                console.log('Payload:', data);
                
                const response = await fetch(apiUrl, {
                    method: method,
                    headers: headers,
                    body: JSON.stringify(data)
                });
                
                console.log('Response status:', response.status);

                if (response.ok) {
                    let result;
                    if (isEditing) {
                        // PUT returns NoContent (204), so no JSON to parse
                        result = { success: true };
                        console.log('Update successful');
                    } else {
                        // POST returns JSON with created repository
                        result = await response.json();
                        console.log('Success result:', result);
                    }
                    showNotification(`Repository ${isEditing ? 'updated' : 'created'} successfully!`, 'success');
                    closeModal('repositoryModal');
                    loadRepository();
                    
                    // Also update dashboard if we're on dashboard
                    const currentSection = document.querySelector('.content-section.active');
                    if (currentSection && currentSection.id === 'dashboard') {
                        await loadDashboardData();
                    }
                    
                    return true;
                } else {
                    const error = await response.text();
                    console.error('API Error Response:', error);
                    showNotification(`Error (${response.status}): ${error || 'Unknown error'}`, 'error');
                    return false;
                }
            } catch (error) {
                console.error('Network/Fetch Error with repository:', error);
                showNotification(`Failed to ${formData.get('repositoryId') ? 'update' : 'create'} repository: ${error.message}`, 'error');
                return false;
            }
        }

        async function editProduct(id) {
            try {
                // Fetch product details
                const response = await fetch(`${API_BASE_URL}/Products/${id}`);
                if (!response.ok) {
                    throw new Error(`Failed to fetch product: ${response.status}`);
                }
                
                const product = await response.json();
                
                // Populate the form with existing data
                document.getElementById('productId').value = product.id;
                document.getElementById('productTitle').value = product.title;
                document.getElementById('productDomain').value = product.domain;
                document.getElementById('productShortDesc').value = product.shortDescription;
                document.getElementById('productLongDesc').value = product.longDescription;
                
                // Show current image if exists
                const currentImagePreview = document.getElementById('currentImagePreview');
                const currentImage = document.getElementById('currentImage');
                const fullImageUrl = getFullImageUrl(product.imageUrl);
                if (fullImageUrl) {
                    currentImage.src = fullImageUrl;
                    currentImagePreview.style.display = 'block';
                } else {
                    currentImagePreview.style.display = 'none';
                }
                
                // Update modal title and button text
                document.getElementById('productModalTitle').innerHTML = '<i class="fas fa-edit"></i> Edit Product';
                document.getElementById('productSubmitBtn').innerHTML = '<i class="fas fa-save"></i> Update Product';
                
                // Make image field optional for editing
                document.getElementById('productImage').removeAttribute('required');
                
                // Show the modal
                showModal('productModal');
                
            } catch (error) {
                console.error('Error loading product for editing:', error);
                showNotification('Failed to load product details for editing', 'error');
            }
        }

        async function editSolution(id) {
            try {
                // Fetch solution details
                const response = await fetch(`${API_BASE_URL}/Solutions/${id}`);
                if (!response.ok) {
                    throw new Error(`Failed to fetch solution: ${response.status}`);
                }
                
                const solution = await response.json();
                
                // Populate the form with existing data
                document.getElementById('solutionId').value = solution.id;
                document.getElementById('solutionTitle').value = solution.title;
                // Populate problem areas dynamically and set current value
                populateSolutionProblemAreas(solution.problemArea || '');
                document.getElementById('solutionProblemArea').value = solution.problemArea;
                document.getElementById('solutionSummary').value = solution.summary;
                document.getElementById('solutionVideoUrl').value = solution.demoVideoUrl || '';
                
                // Show current image if exists
                const currentImagePreview = document.getElementById('currentSolutionImagePreview');
                const currentImage = document.getElementById('currentSolutionImage');
                const fullImageUrl = getFullImageUrl(solution.demoImageUrl);
                if (fullImageUrl) {
                    currentImage.src = fullImageUrl;
                    currentImagePreview.style.display = 'block';
                } else {
                    currentImagePreview.style.display = 'none';
                }
                
                // Update modal title and button text
                document.getElementById('solutionModalTitle').innerHTML = '<i class="fas fa-edit"></i> Edit Solution';
                document.getElementById('solutionSubmitBtn').innerHTML = '<i class="fas fa-save"></i> Update Solution';
                
                // Make image field optional for editing
                document.getElementById('solutionImage').removeAttribute('required');
                
                // Show the modal
                showModal('solutionModal');
                
            } catch (error) {
                console.error('Error loading solution for editing:', error);
                showNotification('Failed to load solution details for editing', 'error');
            }
        }

        // Ensure problem areas (admin form) match categories used on solutions page
        async function populateSolutionProblemAreas(selectedValue) {
            try {
                const resp = await fetch(`${API_BASE_URL}/Solutions/problem-areas`);
                const problemAreas = resp.ok ? await resp.json() : [];
                const select = document.getElementById('solutionProblemArea');
                if (!select) return;
                const current = selectedValue || '';
                const options = [''].concat(problemAreas);
                select.innerHTML = '';
                // Default option
                const defaultOpt = document.createElement('option');
                defaultOpt.value = '';
                defaultOpt.textContent = 'Select Problem Area';
                select.appendChild(defaultOpt);
                // Dynamic options
                options.filter(Boolean).forEach(pa => {
                    const opt = document.createElement('option');
                    opt.value = pa;
                    opt.textContent = pa;
                    if (pa === current) opt.selected = true;
                    select.appendChild(opt);
                });
            } catch (e) {
                console.warn('Failed to load problem areas, falling back to static options');
                // Keep existing static options
            }
        }

        async function editPublication(id) {
            try {
                // Fetch publication details
                const response = await fetch(`${API_BASE_URL}/Publications/${id}`);
                if (!response.ok) {
                    throw new Error(`Failed to fetch publication: ${response.status}`);
                }
                
                const publication = await response.json();
                
                // Populate the form with existing data
                document.querySelector('#publicationModal input[name="title"]').value = publication.title;
                document.querySelector('#publicationModal select[name="domain"]').value = publication.domain;
                document.querySelector('#publicationModal input[name="authors"]').value = publication.authors;
                document.querySelector('#publicationModal textarea[name="abstract"]').value = publication.abstract;
                document.querySelector('#publicationModal input[name="keywords"]').value = publication.keywords || '';
                
                // Set published date
                if (publication.publishedDate) {
                    const publishedDate = new Date(publication.publishedDate);
                    const localDateTime = new Date(publishedDate.getTime() - publishedDate.getTimezoneOffset() * 60000).toISOString().slice(0, 16);
                    document.querySelector('#publicationModal input[name="publishedDate"]').value = localDateTime;
                }
                
                // Show current images if they exist
                const currentImagePreview = document.getElementById('currentPublicationImagePreview');
                const currentThumbnail = document.getElementById('currentPublicationThumbnail');
                const fullThumbnailUrl = getFullImageUrl(publication.thumbnailUrl);
                
                if (fullThumbnailUrl && currentImagePreview && currentThumbnail) {
                    currentThumbnail.src = fullThumbnailUrl;
                    currentImagePreview.style.display = 'block';
                } else if (currentImagePreview) {
                    currentImagePreview.style.display = 'none';
                }
                
                // Store the ID for updating
                let publicationIdField = document.getElementById('publicationId');
                if (!publicationIdField) {
                    publicationIdField = document.createElement('input');
                    publicationIdField.type = 'hidden';
                    publicationIdField.name = 'publicationId';
                    publicationIdField.id = 'publicationId';
                    document.getElementById('publicationForm').appendChild(publicationIdField);
                }
                publicationIdField.value = publication.id;
                
                // Update modal title and button text
                const modalTitle = document.querySelector('#publicationModal .modal-header h3');
                const submitBtn = document.querySelector('#publicationModal button[type="submit"]');
                if (modalTitle) modalTitle.innerHTML = '<i class="fas fa-edit"></i> Edit Publication';
                if (submitBtn) submitBtn.innerHTML = '<i class="fas fa-save"></i> Update Publication';
                
                // Make file fields optional for editing
                const thumbnailField = document.querySelector('#publicationModal input[name="thumbnailFile"]');
                const documentField = document.querySelector('#publicationModal input[name="documentFile"]');
                if (thumbnailField) thumbnailField.removeAttribute('required');
                if (documentField) documentField.removeAttribute('required');
                
                // Show the modal
                showModal('publicationModal');
                
            } catch (error) {
                console.error('Error loading publication for editing:', error);
                showNotification('Failed to load publication details for editing', 'error');
            }
        }

        async function editRepositoryItem(id) {
            try {
                // Fetch repository details
                const response = await fetch(`${API_BASE_URL}/Repository/${id}`);
                if (!response.ok) {
                    throw new Error(`Failed to fetch repository: ${response.status}`);
                }
                
                const repository = await response.json();
                
                // Populate the form with existing data
                document.getElementById('repositoryId').value = repository.id;
                document.getElementById('repositoryTitle').value = repository.title || '';
                document.getElementById('repositoryCategory').value = repository.category || '';
                document.getElementById('repositoryDescription').value = repository.description || '';
                document.getElementById('repositoryTags').value = repository.tags || '';
                document.getElementById('repositoryTechnicalStack').value = repository.technicalStack || '';
                document.getElementById('repositoryGithubUrl').value = repository.githubUrl || '';
                document.getElementById('repositoryLicense').value = repository.license || '';
                document.getElementById('repositoryVersion').value = repository.version || '';
                
                // Set pricing radio buttons
                const freeRadio = document.querySelector('input[name="pricing"][value="free"]');
                const premiumRadio = document.querySelector('input[name="pricing"][value="premium"]');
                if (repository.isFree) {
                    freeRadio.checked = true;
                } else if (repository.isPremium) {
                    premiumRadio.checked = true;
                } else {
                    freeRadio.checked = true; // Default to free
                }
                
                // Update modal title and button text
                document.getElementById('repositoryModalTitle').innerHTML = '<i class="fas fa-edit"></i> Edit Repository Item';
                document.getElementById('repositorySubmitBtn').innerHTML = '<i class="fas fa-save"></i> Update Repository Item';
                
                // Show the modal
                showModal('repositoryModal');
                
            } catch (error) {
                console.error('Error loading repository for editing:', error);
                showNotification('Failed to load repository details for editing', 'error');
            }
        }

        async function deleteProduct(id) {
            if (confirm('Are you sure you want to delete this product?')) {
                try {
                    console.log('Deleting product with ID:', id);
                    
                    // Show loading notification
                    showNotification('Deleting product...', 'info');
                    
                    const success = await AdminAPI.deleteItem('Products', id);
                    if (success) {
                        console.log('Product deleted successfully, refreshing UI immediately');
                        showNotification('Product deleted successfully', 'success');
                        
                        // Immediately refresh the products list (no delay)
                        await loadProducts();
                        
                        // Also update dashboard if we're on dashboard or switch to dashboard
                        const currentSection = document.querySelector('.content-section.active');
                        if (currentSection && currentSection.id === 'dashboard') {
                            await loadDashboardData();
                        }
                        
                        console.log('UI refresh completed after product deletion');
                    } else {
                        showNotification('Failed to delete product', 'error');
                    }
                } catch (error) {
                    console.error('Error in deleteProduct:', error);
                    showNotification('Failed to delete product', 'error');
                }
            }
        }

        async function deleteSolution(id) {
            if (confirm('Are you sure you want to delete this solution?')) {
                try {
                    console.log('Deleting solution with ID:', id);
                    
                    // Show loading notification
                    showNotification('Deleting solution...', 'info');
                    
                    const success = await AdminAPI.deleteItem('Solutions', id);
                    if (success) {
                        console.log('Solution deleted successfully, refreshing UI immediately');
                        showNotification('Solution deleted successfully', 'success');
                        
                        // Immediately refresh the solutions list (no delay)
                        await loadSolutions();
                        
                        // Also update dashboard if we're on dashboard
                        const currentSection = document.querySelector('.content-section.active');
                        if (currentSection && currentSection.id === 'dashboard') {
                            await loadDashboardData();
                        }
                        
                        console.log('UI refresh completed after solution deletion');
                    } else {
                        showNotification('Failed to delete solution', 'error');
                    }
                } catch (error) {
                    console.error('Error in deleteSolution:', error);
                    showNotification('Failed to delete solution', 'error');
                }
            }
        }

        async function deletePublication(id) {
            if (confirm('Are you sure you want to delete this publication?')) {
                try {
                    console.log('Deleting publication with ID:', id);
                    
                    // Show loading notification
                    showNotification('Deleting publication...', 'info');
                    
                    const success = await AdminAPI.deleteItem('Publications', id);
                    if (success) {
                        console.log('Publication deleted successfully, refreshing UI immediately');
                        showNotification('Publication deleted successfully', 'success');
                        
                        // Immediately refresh the publications list (no delay)
                        await loadPublications();
                        
                        // Also update dashboard if we're on dashboard
                        const currentSection = document.querySelector('.content-section.active');
                        if (currentSection && currentSection.id === 'dashboard') {
                            await loadDashboardData();
                        }
                        
                        console.log('UI refresh completed after publication deletion');
                    } else {
                        showNotification('Failed to delete publication', 'error');
                    }
                } catch (error) {
                    console.error('Error in deletePublication:', error);
                    showNotification('Failed to delete publication', 'error');
                }
            }
        }

        async function deleteRepositoryItem(id) {
            if (confirm('Are you sure you want to delete this repository item?')) {
                try {
                    console.log('Deleting repository item with ID:', id);
                    
                    // Show loading notification
                    showNotification('Deleting repository item...', 'info');
                    
                    const success = await AdminAPI.deleteItem('Repository', id);
                    if (success) {
                        console.log('Repository item deleted successfully, refreshing UI immediately');
                        showNotification('Repository item deleted successfully', 'success');
                        
                        // Immediately refresh the repository list (no delay)
                        await loadRepository();
                        
                        // Also update dashboard if we're on dashboard
                        const currentSection = document.querySelector('.content-section.active');
                        if (currentSection && currentSection.id === 'dashboard') {
                            await loadDashboardData();
                        }
                        
                        console.log('UI refresh completed after repository item deletion');
                    } else {
                        showNotification('Failed to delete repository item', 'error');
                    }
                } catch (error) {
                    console.error('Error in deleteRepositoryItem:', error);
                    showNotification('Failed to delete repository item', 'error');
                }
            }
        }

        async function deleteContact(id) {
            if (confirm('Are you sure you want to delete this contact?')) {
                try {
                    console.log('Deleting contact with ID:', id);
                    
                    // Show loading notification
                    showNotification('Deleting contact...', 'info');
                    
                    const success = await AdminAPI.deleteItem('Contact', id);
                    if (success) {
                        console.log('Contact deleted successfully, refreshing UI immediately');
                        showNotification('Contact deleted successfully', 'success');
                        
                        // Immediately refresh the contacts list (no delay)
                        await loadContacts();
                        
                        // Also update dashboard if we're on dashboard
                        const currentSection = document.querySelector('.content-section.active');
                        if (currentSection && currentSection.id === 'dashboard') {
                            await loadDashboardData();
                        }
                        
                        console.log('UI refresh completed after contact deletion');
                    } else {
                        showNotification('Failed to delete contact', 'error');
                    }
                } catch (error) {
                    console.error('Error in deleteContact:', error);
                    showNotification('Failed to delete contact', 'error');
                }
            }
        }

        async function viewContact(id) {
            try {
                // Fetch contact details
                const response = await fetch(`${API_BASE_URL}/Contact/${id}`);
                if (!response.ok) {
                    throw new Error(`Failed to fetch contact: ${response.status}`);
                }
                
                const contact = await response.json();
                
                // Populate contact details in modal
                const contactDetails = document.getElementById('contactDetails');
                contactDetails.innerHTML = `
                    <div style="padding: 20px; background: var(--glass-bg); border-radius: 12px; margin-bottom: 20px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                            <div>
                                <strong style="color: var(--primary); display: block; margin-bottom: 5px;">Name:</strong>
                                <span style="font-size: 1.1rem;">${contact.name}</span>
                            </div>
                            <div>
                                <strong style="color: var(--primary); display: block; margin-bottom: 5px;">Email:</strong>
                                <span style="font-size: 1.1rem;">${contact.email}</span>
                            </div>
                        </div>
                        <div style="margin-bottom: 20px;">
                            <strong style="color: var(--primary); display: block; margin-bottom: 5px;">Subject:</strong>
                            <span style="font-size: 1.1rem; font-weight: 500;">${contact.subject}</span>
                        </div>
                        <div style="margin-bottom: 20px;">
                            <strong style="color: var(--primary); display: block; margin-bottom: 10px;">Message:</strong>
                            <div style="background: var(--bg-light); padding: 15px; border-radius: 8px; border-left: 4px solid var(--primary); white-space: pre-wrap; line-height: 1.6;">
${contact.message}
                            </div>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; font-size: 0.9rem; color: var(--text-muted);">
                            <div>
                                <strong>Received:</strong> ${new Date(contact.createdAt).toLocaleString()}
                            </div>
                            <div>
                                <strong>Status:</strong> 
                                <span class="status-badge ${contact.isRead ? 'status-active' : 'status-pending'}">
                                    ${contact.isRead ? 'Read' : 'Unread'}
                                </span>
                            </div>
                        </div>
                    </div>
                `;
                
                // Store current contact ID for marking as read
                window.currentContactId = id;
                
                // Show the modal
                showModal('contactViewModal');
                
                // Mark as read automatically if it's unread
                if (!contact.isRead) {
                    setTimeout(() => markContactAsRead(), 1000);
                }
                
            } catch (error) {
                console.error('Error loading contact details:', error);
                showNotification('Failed to load contact details', 'error');
            }
        }

        async function markContactAsRead() {
            try {
                const contactId = window.currentContactId;
                if (!contactId) return;
                
                const response = await fetch(`${API_BASE_URL}/Contact/${contactId}/read`, {
                    method: 'PUT'
                });
                
                if (response.ok) {
                    showNotification('Contact marked as read', 'success');
                    loadContacts(); // Refresh the contact list
                } else {
                    showNotification('Failed to mark contact as read', 'error');
                }
            } catch (error) {
                console.error('Error marking contact as read:', error);
                showNotification('Failed to mark contact as read', 'error');
            }
        }

        async function markAllAsRead() {
            if (confirm('Are you sure you want to mark all contacts as read?')) {
                try {
                    const response = await fetch(`${API_BASE_URL}/Contact/mark-all-read`, {
                        method: 'PUT'
                    });
                    
                    if (response.ok) {
                        showNotification('All contacts marked as read', 'success');
                        loadContacts(); // Refresh the contact list
                    } else {
                        showNotification('Failed to mark all contacts as read', 'error');
                    }
                } catch (error) {
                    console.error('Error marking all contacts as read:', error);
                    showNotification('Failed to mark all contacts as read', 'error');
                }
            }
        }

        async function deleteReadContacts() {
            if (confirm('Are you sure you want to delete all read contacts? This action cannot be undone.')) {
                try {
                    const response = await fetch(`${API_BASE_URL}/Contact/delete-read`, {
                        method: 'DELETE'
                    });
                    
                    if (response.ok) {
                        const result = await response.json();
                        showNotification(`Successfully deleted ${result.deletedCount || 'all'} read contacts`, 'success');
                        loadContacts(); // Refresh the contact list
                    } else {
                        showNotification('Failed to delete read contacts', 'error');
                    }
                } catch (error) {
                    console.error('Error deleting read contacts:', error);
                    showNotification('Failed to delete read contacts', 'error');
                }
            }
        }


        // Load dynamic category/domain options for admin forms and filters
        async function loadDynamicCategoriesForForms() {
            try {
                console.log('Loading dynamic categories for admin forms and filters...');
                
                // Load products domains (both form and filter)
                await loadProductDomains();
                await loadProductDomainFilter();
                
                // Load solutions problem areas (both form and filter)
                await loadSolutionProblemAreas();
                await loadSolutionAreaFilter();
                
                // Load publications domains (both form and filter)
                await loadPublicationDomains();
                await loadPublicationDomainFilter();
                
                // Load repository categories (both form and filter)
                await loadRepositoryCategories();
                await loadRepositoryCategoryFilter();
                
                console.log('Dynamic categories loaded successfully');
            } catch (error) {
                console.warn('Error loading dynamic categories:', error, '- using hardcoded values');
            }
        }
        
        // Load product domains from API and populate form dropdown
        async function loadProductDomains() {
            try {
                const response = await fetch(`${API_BASE_URL}/Products/domains`);
                if (response.ok) {
                    const domainData = await response.json();
                    // Extract just the domain names from the API response
                    const domains = domainData.map(item => item.domain);
                    populateProductDomainSelect(domains);
                }
            } catch (error) {
                console.warn('Could not load product domains from API');
            }
        }
        
        // Load product domains for filter dropdown
        async function loadProductDomainFilter() {
            try {
                const response = await fetch(`${API_BASE_URL}/Products/domains`);
                if (response.ok) {
                    const domainData = await response.json();
                    // Extract just the domain names from the API response
                    const domains = domainData.map(item => item.domain);
                    populateProductDomainFilter(domains);
                }
            } catch (error) {
                console.warn('Could not load product domains for filter from API');
            }
        }
        
        // Load solution problem areas for filter dropdown
        async function loadSolutionAreaFilter() {
            try {
                const response = await fetch(`${API_BASE_URL}/Solutions/problem-areas`);
                if (response.ok) {
                    const problemAreas = await response.json();
                    populateSolutionAreaFilter(problemAreas);
                }
            } catch (error) {
                console.warn('Could not load solution problem areas for filter from API');
            }
        }
        
        // Load publication domains for filter dropdown
        async function loadPublicationDomainFilter() {
            try {
                const response = await fetch(`${API_BASE_URL}/Publications/domains`);
                if (response.ok) {
                    const domains = await response.json();
                    populatePublicationDomainFilterDropdown(domains);
                }
            } catch (error) {
                console.warn('Could not load publication domains for filter from API');
            }
        }
        
        // Load repository categories for filter dropdown
        async function loadRepositoryCategoryFilter() {
            try {
                const response = await fetch(`${API_BASE_URL}/Repository/categories`);
                if (response.ok) {
                    const categories = await response.json();
                    populateRepositoryCategoryFilter(categories);
                }
            } catch (error) {
                console.warn('Could not load repository categories for filter from API');
            }
        }
        
        // Load solution problem areas from API and populate form dropdown
        async function loadSolutionProblemAreas() {
            try {
                const response = await fetch(`${API_BASE_URL}/Solutions/problem-areas`);
                if (response.ok) {
                    const problemAreas = await response.json();
                    populateSolutionProblemAreaSelect(problemAreas);
                }
            } catch (error) {
                console.warn('Could not load solution problem areas from API');
            }
        }
        
        // Load publication domains from API and populate form dropdown
        async function loadPublicationDomains() {
            try {
                const response = await fetch(`${API_BASE_URL}/Publications/domains`);
                if (response.ok) {
                    const domains = await response.json();
                    populatePublicationDomainSelect(domains);
                }
            } catch (error) {
                console.warn('Could not load publication domains from API');
            }
        }
        
        // Load repository categories from API and populate form dropdown
        async function loadRepositoryCategories() {
            try {
                const response = await fetch(`${API_BASE_URL}/Repository/categories`);
                if (response.ok) {
                    const categories = await response.json();
                    populateRepositoryCategorySelect(categories);
                }
            } catch (error) {
                console.warn('Could not load repository categories from API');
            }
        }
        
        // Populate product domain select with API data
        function populateProductDomainSelect(domains) {
            const productDomainSelect = document.getElementById('productDomain');
            if (productDomainSelect && domains.length > 0) {
                // Clear existing options except the first "Select Domain" option
                while (productDomainSelect.children.length > 1) {
                    productDomainSelect.removeChild(productDomainSelect.lastChild);
                }
                
                // Add domains from API
                domains.forEach(domain => {
                    const option = document.createElement('option');
                    option.value = domain;
                    option.textContent = domain;
                    productDomainSelect.appendChild(option);
                });
                console.log(`Loaded ${domains.length} product domains for admin forms`);
            }
        }
        
        // Populate product domain filter with API data
        function populateProductDomainFilter(domains) {
            const productDomainFilter = document.getElementById('productDomainFilter');
            if (productDomainFilter && domains.length > 0) {
                // Clear existing options except the first "All Domains" option
                while (productDomainFilter.children.length > 1) {
                    productDomainFilter.removeChild(productDomainFilter.lastChild);
                }
                
                // Add domains from API
                domains.forEach(domain => {
                    const option = document.createElement('option');
                    option.value = domain;
                    option.textContent = domain;
                    productDomainFilter.appendChild(option);
                });
                console.log(`Loaded ${domains.length} product domains for filter`);
            }
        }
        
        // Populate solution problem area select with API data
        function populateSolutionProblemAreaSelect(problemAreas) {
            const solutionProblemAreaSelect = document.getElementById('solutionProblemArea');
            if (solutionProblemAreaSelect && problemAreas.length > 0) {
                // Clear existing options except the first "Select Problem Area" option
                while (solutionProblemAreaSelect.children.length > 1) {
                    solutionProblemAreaSelect.removeChild(solutionProblemAreaSelect.lastChild);
                }
                
                // Add problem areas from API
                problemAreas.forEach(area => {
                    const option = document.createElement('option');
                    option.value = area;
                    option.textContent = area;
                    solutionProblemAreaSelect.appendChild(option);
                });
                console.log(`Loaded ${problemAreas.length} solution problem areas for admin forms`);
            }
        }
        
        // Populate publication domain select with API data
        function populatePublicationDomainSelect(domains) {
            const publicationDomainSelect = document.querySelector('#publicationForm select[name="domain"]');
            if (publicationDomainSelect && domains.length > 0) {
                // Clear existing options except the first "Select Domain" option
                while (publicationDomainSelect.children.length > 1) {
                    publicationDomainSelect.removeChild(publicationDomainSelect.lastChild);
                }
                
                // Add domains from API
                domains.forEach(domain => {
                    const option = document.createElement('option');
                    option.value = domain;
                    option.textContent = domain;
                    publicationDomainSelect.appendChild(option);
                });
                console.log(`Loaded ${domains.length} publication domains for admin forms`);
            }
        }
        
        // Populate repository category select with API data
        function populateRepositoryCategorySelect(categories) {
            const repositoryCategorySelect = document.getElementById('repositoryCategory');
            if (repositoryCategorySelect && categories.length > 0) {
                // Clear existing options except the first "Select Category" option
                while (repositoryCategorySelect.children.length > 1) {
                    repositoryCategorySelect.removeChild(repositoryCategorySelect.lastChild);
                }
                
                // Add categories from API
                categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    repositoryCategorySelect.appendChild(option);
                });
                console.log(`Loaded ${categories.length} repository categories for admin forms`);
            }
        }
        
        // Populate solution area filter with API data
        function populateSolutionAreaFilter(problemAreas) {
            const solutionAreaFilter = document.getElementById('solutionAreaFilter');
            if (solutionAreaFilter && problemAreas.length > 0) {
                // Clear existing options except the first "All Problem Areas" option
                while (solutionAreaFilter.children.length > 1) {
                    solutionAreaFilter.removeChild(solutionAreaFilter.lastChild);
                }
                
                // Add problem areas from API
                problemAreas.forEach(area => {
                    const option = document.createElement('option');
                    option.value = area;
                    option.textContent = area;
                    solutionAreaFilter.appendChild(option);
                });
                console.log(`Loaded ${problemAreas.length} solution areas for filter`);
            }
        }
        
        // Populate publication domain filter with API data
        function populatePublicationDomainFilterDropdown(domains) {
            const publicationDomainFilter = document.getElementById('publicationDomainFilter');
            if (publicationDomainFilter && domains.length > 0) {
                // Clear existing options except the first "All Domains" option
                while (publicationDomainFilter.children.length > 1) {
                    publicationDomainFilter.removeChild(publicationDomainFilter.lastChild);
                }
                
                // Add domains from API
                domains.forEach(domain => {
                    const option = document.createElement('option');
                    option.value = domain;
                    option.textContent = domain;
                    publicationDomainFilter.appendChild(option);
                });
                console.log(`Loaded ${domains.length} publication domains for filter`);
            }
        }
        
        // Populate repository category filter with API data
        function populateRepositoryCategoryFilter(categories) {
            const repositoryCategoryFilter = document.getElementById('repositoryCategoryFilter');
            if (repositoryCategoryFilter && categories.length > 0) {
                // Clear existing options except the first "All Categories" option
                while (repositoryCategoryFilter.children.length > 1) {
                    repositoryCategoryFilter.removeChild(repositoryCategoryFilter.lastChild);
                }
                
                // Add categories from API
                categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    repositoryCategoryFilter.appendChild(option);
                });
                console.log(`Loaded ${categories.length} repository categories for filter`);
            }
        }
        
        // Add event listeners for filters and search
        document.addEventListener('DOMContentLoaded', function() {
            // Load dynamic categories for admin forms
            loadDynamicCategoriesForForms();
            
            // Products filters
            const productDomainFilter = document.getElementById('productDomainFilter');
            const productSearch = document.getElementById('productSearch');
            if (productDomainFilter) productDomainFilter.addEventListener('change', loadProducts);
            if (productSearch) productSearch.addEventListener('input', debounce(loadProducts, 300));

            // Solutions filters
            const solutionAreaFilter = document.getElementById('solutionAreaFilter');
            const solutionSearch = document.getElementById('solutionSearch');
            if (solutionAreaFilter) solutionAreaFilter.addEventListener('change', loadSolutions);
            if (solutionSearch) solutionSearch.addEventListener('input', debounce(loadSolutions, 300));

            // Publications filters
            const publicationDomainFilter = document.getElementById('publicationDomainFilter');
            const publicationSearch = document.getElementById('publicationSearch');
            if (publicationDomainFilter) publicationDomainFilter.addEventListener('change', loadPublications);
            if (publicationSearch) publicationSearch.addEventListener('input', debounce(loadPublications, 300));

            // Repository filters
            const repositoryCategoryFilter = document.getElementById('repositoryCategoryFilter');
            const repositoryTypeFilter = document.getElementById('repositoryTypeFilter');
            if (repositoryCategoryFilter) repositoryCategoryFilter.addEventListener('change', loadRepository);
            if (repositoryTypeFilter) repositoryTypeFilter.addEventListener('change', loadRepository);

            // Contacts filters
            const contactStatusFilter = document.getElementById('contactStatusFilter');
            const contactSearch = document.getElementById('contactSearch');
            if (contactStatusFilter) contactStatusFilter.addEventListener('change', loadContacts);
            if (contactSearch) contactSearch.addEventListener('input', debounce(loadContacts, 300));
        });

        // Utility function for debouncing search input
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Role validation helper
        function validateRolePermission(requiredRoles) {
            const currentRole = getCurrentUserRole();
            if (!requiredRoles.includes(currentRole)) {
                showNotification(`Access denied. ${requiredRoles.includes('Admin') ? 'Admin' : 'Manager'} role required for this action.`, 'error');
                return false;
            }
            return true;
        }

        // Form Event Handlers
        document.addEventListener('DOMContentLoaded', function() {
            // Product form handler
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    // Check role permissions
                    if (!validateRolePermission(['Admin', 'Manager'])) {
                        return;
                    }
                    
                    const formData = new FormData(this);
                    const submitBtn = this.querySelector('button[type="submit"]');
                    const isEditing = formData.get('productId') && formData.get('productId') !== '';
                    
                    // Show loading state
                    submitBtn.disabled = true;
                    submitBtn.innerHTML = `<i class="fas fa-spinner fa-spin"></i> ${isEditing ? 'Updating...' : 'Creating...'}`;
                    
                    const success = await submitProductForm(formData);
                    
                    // Reset button state
                    submitBtn.disabled = false;
                    if (isEditing) {
                        submitBtn.innerHTML = '<i class="fas fa-save"></i> Update Product';
                    } else {
                        submitBtn.innerHTML = '<i class="fas fa-save"></i> Create Product';
                    }
                });
            }

            // Carousel form handler
            const carouselForm = document.getElementById('carouselForm');
            if (carouselForm) {
                carouselForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const formData = new FormData(this);
                    const submitBtn = this.querySelector('button[type="submit"]');
                    const isEditing = formData.get('slideId') && formData.get('slideId') !== '';
                    
                    // Show loading state
                    submitBtn.disabled = true;
                    submitBtn.innerHTML = `<i class="fas fa-spinner fa-spin"></i> ${isEditing ? 'Updating...' : 'Creating...'}`;
                    
                    const success = await submitCarouselForm(formData);
                    
                    // Reset button state
                    submitBtn.disabled = false;
                    if (isEditing) {
                        submitBtn.innerHTML = '<i class="fas fa-save"></i> Update Slide';
                    } else {
                        submitBtn.innerHTML = '<i class="fas fa-save"></i> Create Slide';
                    }
                });
            }

            // Solution form handler
            const solutionForm = document.getElementById('solutionForm');
            if (solutionForm) {
                solutionForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const formData = new FormData(this);
                    const submitBtn = this.querySelector('button[type="submit"]');
                    const isEditing = formData.get('solutionId') && formData.get('solutionId') !== '';
                    
                    // Show loading state
                    submitBtn.disabled = true;
                    submitBtn.innerHTML = `<i class="fas fa-spinner fa-spin"></i> ${isEditing ? 'Updating...' : 'Creating...'}`;
                    
                    const success = await submitSolutionForm(formData);
                    
                    // Reset button state
                    submitBtn.disabled = false;
                    if (isEditing) {
                        submitBtn.innerHTML = '<i class="fas fa-save"></i> Update Solution';
                    } else {
                        submitBtn.innerHTML = '<i class="fas fa-save"></i> Create Solution';
                    }
                });
            }

            // Publication form handler
            const publicationForm = document.getElementById('publicationForm');
            if (publicationForm) {
                publicationForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const formData = new FormData(this);
                    const submitBtn = this.querySelector('button[type="submit"]');
                    
                    // Show loading state
                    submitBtn.disabled = true;
                    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating...';
                    
                    const success = await submitPublicationForm(formData);
                    
                    // Reset button state
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = '<i class="fas fa-save"></i> Create Publication';
                });
            }

            // Team Member form handler (About section)
            const teamMemberForm = document.getElementById('teamMemberForm');
            if (teamMemberForm) {
                teamMemberForm.addEventListener('submit', async function(e) {
                    e.preventDefault();

                    const formData = new FormData(this);
                    const submitBtn = this.querySelector('button[type="submit"]');
                    const isEditing = formData.get('teamMemberId') && formData.get('teamMemberId') !== '';

                    submitBtn.disabled = true;
                    submitBtn.innerHTML = `<i class="fas fa-spinner fa-spin"></i> ${isEditing ? 'Updating...' : 'Creating...'}`;

                    const success = await submitTeamMemberForm(formData);

                    submitBtn.disabled = false;
                    submitBtn.innerHTML = isEditing ? '<i class="fas fa-save"></i> Update Member' : '<i class="fas fa-save"></i> Create Member';
                });
            }

            // Testimonial form handler (About section)
            const testimonialForm = document.getElementById('testimonialForm');
            if (testimonialForm) {
                testimonialForm.addEventListener('submit', async function(e) {
                    e.preventDefault();

                    const formData = new FormData(this);
                    const submitBtn = this.querySelector('button[type="submit"]');
                    const isEditing = formData.get('testimonialId') && formData.get('testimonialId') !== '';

                    submitBtn.disabled = true;
                    submitBtn.innerHTML = `<i class="fas fa-spinner fa-spin"></i> ${isEditing ? 'Updating...' : 'Creating...'}`;

                    const success = await submitTestimonialForm(formData);

                    submitBtn.disabled = false;
                    submitBtn.innerHTML = isEditing ? '<i class="fas fa-save"></i> Update Testimonial' : '<i class="fas fa-save"></i> Create Testimonial';
                });
            }

            // Repository form handler
            const repositoryForm = document.getElementById('repositoryForm');
            if (repositoryForm) {
                repositoryForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const formData = new FormData(this);
                    const submitBtn = this.querySelector('button[type="submit"]');
                    const isEditing = formData.get('repositoryId') && formData.get('repositoryId') !== '';
                    
                    // Show loading state
                    submitBtn.disabled = true;
                    submitBtn.innerHTML = `<i class="fas fa-spinner fa-spin"></i> ${isEditing ? 'Updating...' : 'Creating...'}`;
                    
                    const success = await submitRepositoryForm(formData);
                    
                    // Reset button state
                    submitBtn.disabled = false;
                    if (isEditing) {
                        submitBtn.innerHTML = '<i class="fas fa-save"></i> Update Repository Item';
                    } else {
                        submitBtn.innerHTML = '<i class="fas fa-save"></i> Create Repository Item';
                    }
                });
            }

            // User form handler
            const userForm = document.getElementById('userForm');
            if (userForm) {
                userForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const formData = new FormData(this);
                    const submitBtn = this.querySelector('button[type="submit"]');
                    const isEditing = formData.get('userId') && formData.get('userId') !== '';
                    
                    // Show loading state
                    submitBtn.disabled = true;
                    submitBtn.innerHTML = `<i class="fas fa-spinner fa-spin"></i> ${isEditing ? 'Updating...' : 'Creating...'}`;
                    
                    const success = await submitUserForm(formData);
                    
                    // Reset button state
                    submitBtn.disabled = false;
                    if (isEditing) {
                        submitBtn.innerHTML = '<i class="fas fa-save"></i> Update User';
                    } else {
                        submitBtn.innerHTML = '<i class="fas fa-save"></i> Create User';
                    }
                });
            }

        });

        // View Functions for all sections
        async function viewProduct(id) {
            try {
                const response = await fetch(`${API_BASE_URL}/Products/${id}`);
                if (!response.ok) {
                    throw new Error(`Failed to fetch product: ${response.status}`);
                }
                
                const product = await response.json();
                
                // Create image display with proper fallback
                const fullImageUrl = getFullImageUrl(product.imageUrl);
                const imageDisplay = fullImageUrl ? 
                    `<div style="margin-bottom: 20px; text-align: center;">
                        <img src="${fullImageUrl}" alt="${product.title}" 
                             style="width: 100%; max-width: 400px; height: 250px; object-fit: cover; border-radius: 12px; border: 1px solid var(--glass-border);" 
                             onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        <div style="display: none; width: 100%; max-width: 400px; height: 250px; background: var(--glass-bg); border-radius: 12px; align-items: center; justify-content: center; border: 1px solid var(--glass-border); margin: 0 auto;">
                            <div style="text-align: center; color: var(--text-muted);">
                                <i class="fas fa-box" style="font-size: 48px; margin-bottom: 10px; color: var(--primary);"></i>
                                <div>No Image Available</div>
                            </div>
                        </div>
                    </div>` : 
                    `<div style="margin-bottom: 20px; text-align: center;">
                        <div style="width: 100%; max-width: 400px; height: 250px; background: var(--glass-bg); border-radius: 12px; display: flex; align-items: center; justify-content: center; border: 1px solid var(--glass-border); margin: 0 auto;">
                            <div style="text-align: center; color: var(--text-muted);">
                                <i class="fas fa-box" style="font-size: 48px; margin-bottom: 10px; color: var(--primary);"></i>
                                <div>No Image Available</div>
                            </div>
                        </div>
                    </div>`;
                
                showViewModal('Product Details', `
                    <div style="padding: 20px;">
                        ${imageDisplay}
                        <h3 style="color: var(--primary); margin-bottom: 10px;">${product.title}</h3>
                        <p style="background: var(--primary); color: white; display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 0.8rem; margin-bottom: 15px;">${product.domain || 'Unknown Domain'}</p>
                        <h4 style="color: var(--text); margin: 20px 0 10px 0;">Short Description:</h4>
                        <p style="color: var(--text-light); line-height: 1.6;">${product.shortDescription || 'No short description available'}</p>
                        <h4 style="color: var(--text); margin: 20px 0 10px 0;">Full Description:</h4>
                        <p style="color: var(--text-light); line-height: 1.6; white-space: pre-wrap;">${product.longDescription || 'No detailed description available'}</p>
                        <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--glass-border);">
                            <p><strong>ID:</strong> ${product.id}</p>
                            <p><strong>Created:</strong> ${new Date(product.createdAt).toLocaleString()}</p>
                            <p><strong>Updated:</strong> ${new Date(product.updatedAt).toLocaleString()}</p>
                        </div>
                    </div>
                `);
                
            } catch (error) {
                console.error('Error loading product for viewing:', error);
                showNotification('Failed to load product details', 'error');
            }
        }

        async function viewPublication(id) {
            try {
                const response = await fetch(`${API_BASE_URL}/Publications/${id}`);
                if (!response.ok) {
                    throw new Error(`Failed to fetch publication: ${response.status}`);
                }
                
                const publication = await response.json();
                
                // Create image display with proper fallback
                const fullImageUrl = getFullImageUrl(publication.thumbnailUrl);
                const imageDisplay = fullImageUrl ? 
                    `<div style="margin-bottom: 20px; text-align: center;">
                        <img src="${fullImageUrl}" alt="${publication.title}" 
                             style="width: 100%; max-width: 400px; height: 250px; object-fit: cover; border-radius: 12px; border: 1px solid var(--glass-border);" 
                             onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        <div style="display: none; width: 100%; max-width: 400px; height: 250px; background: var(--glass-bg); border-radius: 12px; align-items: center; justify-content: center; border: 1px solid var(--glass-border); margin: 0 auto;">
                            <div style="text-align: center; color: var(--text-muted);">
                                <i class="fas fa-file-alt" style="font-size: 48px; margin-bottom: 10px; color: var(--primary);"></i>
                                <div>No Thumbnail Available</div>
                            </div>
                        </div>
                    </div>` : 
                    `<div style="margin-bottom: 20px; text-align: center;">
                        <div style="width: 100%; max-width: 400px; height: 250px; background: var(--glass-bg); border-radius: 12px; display: flex; align-items: center; justify-content: center; border: 1px solid var(--glass-border); margin: 0 auto;">
                            <div style="text-align: center; color: var(--text-muted);">
                                <i class="fas fa-file-alt" style="font-size: 48px; margin-bottom: 10px; color: var(--primary);"></i>
                                <div>No Thumbnail Available</div>
                            </div>
                        </div>
                    </div>`;
                
                showViewModal('Publication Details', `
                    <div style="padding: 20px;">
                        ${imageDisplay}
                        <h3 style="color: var(--primary); margin-bottom: 10px;">${publication.title}</h3>
                        <p style="background: var(--info); color: white; display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 0.8rem; margin-bottom: 15px;">${publication.domain || 'General'}</p>
                        <h4 style="color: var(--text); margin: 20px 0 10px 0;">Authors:</h4>
                        <p style="color: var(--text-light);">${publication.authors || 'Unknown Author'}</p>
                        <h4 style="color: var(--text); margin: 20px 0 10px 0;">Abstract:</h4>
                        <p style="color: var(--text-light); line-height: 1.6; white-space: pre-wrap;">${publication.abstract || 'No abstract available'}</p>
                        ${publication.keywords ? `<h4 style="color: var(--text); margin: 20px 0 10px 0;">Keywords:</h4><p style="color: var(--text-light);">${publication.keywords}</p>` : ''}
                        <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--glass-border);">
                            <p><strong>ID:</strong> ${publication.id}</p>
                            <p><strong>Rating:</strong> ${(publication.averageRating || 0).toFixed(1)}/5.0 (${publication.ratingCount || 0} ratings)</p>
                            <p><strong>Published:</strong> ${new Date(publication.publishedDate).toLocaleString()}</p>
                        </div>
                    </div>
                `);
                
            } catch (error) {
                console.error('Error loading publication for viewing:', error);
                showNotification('Failed to load publication details', 'error');
            }
        }

        async function viewRepositoryItem(id) {
            try {
                const response = await fetch(`${API_BASE_URL}/Repository/${id}`);
                if (!response.ok) {
                    throw new Error(`Failed to fetch repository item: ${response.status}`);
                }
                
                const item = await response.json();
                showViewModal('Repository Item Details', `
                    <div style="padding: 20px;">
                        <h3 style="color: var(--primary); margin-bottom: 10px;">${item.title}</h3>
                        <div style="margin-bottom: 15px;">
                            <span style="background: var(--neutral); color: white; padding: 4px 12px; border-radius: 20px; font-size: 0.8rem; margin-right: 10px;">${item.category}</span>
                            <span class="status-badge ${item.isFree ? 'status-active' : 'status-warning'}">${item.isFree ? 'Free' : 'Premium'}</span>
                        </div>
                        <h4 style="color: var(--text); margin: 20px 0 10px 0;">Description:</h4>
                        <p style="color: var(--text-light); line-height: 1.6; white-space: pre-wrap;">${item.description}</p>
                        ${item.tags ? `<h4 style="color: var(--text); margin: 20px 0 10px 0;">Tags:</h4><p style="color: var(--text-light);">${item.tags}</p>` : ''}
                        ${item.technicalStack ? `<h4 style="color: var(--text); margin: 20px 0 10px 0;">Technical Stack:</h4><p style="color: var(--text-light);">${item.technicalStack}</p>` : ''}
                        ${item.githubUrl ? `<h4 style="color: var(--text); margin: 20px 0 10px 0;">GitHub URL:</h4><a href="${item.githubUrl}" target="_blank" style="color: var(--primary);">${item.githubUrl}</a>` : ''}
                        <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--glass-border);">
                            <p><strong>ID:</strong> ${item.id}</p>
                            <p><strong>Version:</strong> ${item.version}</p>
                            <p><strong>License:</strong> ${item.license}</p>
                            <p><strong>Downloads:</strong> ${item.downloadCount.toLocaleString()}</p>
                            <p><strong>Created:</strong> ${new Date(item.createdAt).toLocaleString()}</p>
                        </div>
                    </div>
                `);
                
            } catch (error) {
                console.error('Error loading repository item for viewing:', error);
                showNotification('Failed to load repository item details', 'error');
            }
        }

        function showViewModal(title, content) {
            // Create or update view modal
            let viewModal = document.getElementById('viewModal');
            if (!viewModal) {
                viewModal = document.createElement('div');
                viewModal.id = 'viewModal';
                viewModal.className = 'modal-overlay';
                viewModal.innerHTML = `
                    <div class="modal-content modal-large">
                        <div class="modal-header">
                            <h3 id="viewModalTitle"><i class="fas fa-eye"></i> View Details</h3>
                            <button class="modal-close" onclick="closeModal('viewModal')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body" id="viewModalBody">
                            <!-- Content will be loaded here -->
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" onclick="closeModal('viewModal')">Close</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(viewModal);
            }
            
            document.getElementById('viewModalTitle').innerHTML = `<i class="fas fa-eye"></i> ${title}`;
            document.getElementById('viewModalBody').innerHTML = content;
            showModal('viewModal');
        }

        // Video Demo Functions
        function viewSolutionDemo(videoUrl, solutionTitle) {
            console.log('Opening demo video:', videoUrl, 'for solution:', solutionTitle);
            
            if (!videoUrl || videoUrl.trim() === '') {
                showNotification('No demo video available for this solution', 'warning');
                return;
            }

            // Set modal title
            document.getElementById('demoVideoTitle').innerHTML = `<i class="fas fa-play-circle"></i> ${solutionTitle} - Demo`;
            document.getElementById('videoUrl').textContent = videoUrl;
            
            // Show loading state
            showVideoLoader();
            
            // Show modal
            showModal('demoVideoModal');
            
            // Load video after a short delay to ensure modal is visible
            setTimeout(() => {
                loadVideo(videoUrl);
            }, 300);
        }

        function showVideoLoader() {
            document.getElementById('videoLoader').style.display = 'block';
            document.getElementById('demoVideoFrame').style.display = 'none';
            document.getElementById('demoVideoPlayer').style.display = 'none';
            document.getElementById('videoError').style.display = 'none';
        }

        function hideVideoLoader() {
            document.getElementById('videoLoader').style.display = 'none';
        }

        function showVideoError() {
            document.getElementById('videoLoader').style.display = 'none';
            document.getElementById('demoVideoFrame').style.display = 'none';
            document.getElementById('demoVideoPlayer').style.display = 'none';
            document.getElementById('videoError').style.display = 'block';
        }

        function loadVideo(videoUrl) {
            const iframe = document.getElementById('demoVideoFrame');
            const videoPlayer = document.getElementById('demoVideoPlayer');
            
            try {
                // Clean the URL
                const cleanUrl = videoUrl.trim();
                
                // Check if it's a YouTube URL
                if (isYouTubeUrl(cleanUrl)) {
                    const embedUrl = convertToYouTubeEmbed(cleanUrl);
                    iframe.src = embedUrl;
                    iframe.onload = () => {
                        hideVideoLoader();
                        iframe.style.display = 'block';
                    };
                    iframe.onerror = () => showVideoError();
                }
                // Check if it's a Vimeo URL
                else if (isVimeoUrl(cleanUrl)) {
                    const embedUrl = convertToVimeoEmbed(cleanUrl);
                    iframe.src = embedUrl;
                    iframe.onload = () => {
                        hideVideoLoader();
                        iframe.style.display = 'block';
                    };
                    iframe.onerror = () => showVideoError();
                }
                // Check if it's a direct video file
                else if (isDirectVideoUrl(cleanUrl)) {
                    videoPlayer.src = cleanUrl;
                    videoPlayer.onloadeddata = () => {
                        hideVideoLoader();
                        videoPlayer.style.display = 'block';
                    };
                    videoPlayer.onerror = () => showVideoError();
                }
                // Try as iframe for other platforms
                else {
                    iframe.src = cleanUrl;
                    iframe.onload = () => {
                        hideVideoLoader();
                        iframe.style.display = 'block';
                    };
                    iframe.onerror = () => showVideoError();
                }
                
                // Set timeout to show error if video doesn't load within 10 seconds
                setTimeout(() => {
                    if (document.getElementById('videoLoader').style.display !== 'none') {
                        showVideoError();
                    }
                }, 10000);
                
            } catch (error) {
                console.error('Error loading video:', error);
                showVideoError();
            }
        }

        function isYouTubeUrl(url) {
            const youtubeRegex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/ ]{11})/;
            return youtubeRegex.test(url);
        }

        function convertToYouTubeEmbed(url) {
            const videoIdRegex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/ ]{11})/;
            const match = url.match(videoIdRegex);
            if (match && match[1]) {
                return `https://www.youtube.com/embed/${match[1]}?autoplay=1&rel=0&modestbranding=1`;
            }
            return url;
        }

        function isVimeoUrl(url) {
            const vimeoRegex = /(?:vimeo\.com\/)([0-9]+)/;
            return vimeoRegex.test(url);
        }

        function convertToVimeoEmbed(url) {
            const videoIdRegex = /(?:vimeo\.com\/)([0-9]+)/;
            const match = url.match(videoIdRegex);
            if (match && match[1]) {
                return `https://player.vimeo.com/video/${match[1]}?autoplay=1`;
            }
            return url;
        }

        function isDirectVideoUrl(url) {
            const videoExtensions = /\.(mp4|webm|ogg|avi|mov|wmv|flv|mkv)$/i;
            return videoExtensions.test(url);
        }

        function closeDemoVideoModal() {
            const iframe = document.getElementById('demoVideoFrame');
            const videoPlayer = document.getElementById('demoVideoPlayer');
            
            // Stop video playback
            iframe.src = '';
            videoPlayer.src = '';
            videoPlayer.pause();
            
            // Reset modal state
            showVideoLoader();
            
            // Close modal
            closeModal('demoVideoModal');
        }

        function toggleFullscreen() {
            const videoContainer = document.getElementById('videoContainer');
            const fullscreenBtn = document.getElementById('fullscreenBtn');
            
            if (!document.fullscreenElement) {
                videoContainer.requestFullscreen().then(() => {
                    fullscreenBtn.innerHTML = '<i class="fas fa-compress"></i> Exit Fullscreen';
                }).catch(err => {
                    console.log('Error attempting to enable fullscreen:', err);
                    showNotification('Fullscreen not supported by your browser', 'warning');
                });
            } else {
                document.exitFullscreen().then(() => {
                    fullscreenBtn.innerHTML = '<i class="fas fa-expand"></i> Fullscreen';
                }).catch(err => {
                    console.log('Error attempting to exit fullscreen:', err);
                });
            }
        }

        // Listen for fullscreen changes
        document.addEventListener('fullscreenchange', function() {
            const fullscreenBtn = document.getElementById('fullscreenBtn');
            if (fullscreenBtn) {
                if (document.fullscreenElement) {
                    fullscreenBtn.innerHTML = '<i class="fas fa-compress"></i> Exit Fullscreen';
                } else {
                    fullscreenBtn.innerHTML = '<i class="fas fa-expand"></i> Fullscreen';
                }
            }
        });


        // Homepage preview function (simplified)
        async function previewHomepage() {
            showNotification('Homepage preview - This would open the homepage in a new tab', 'info');
            // Future implementation: Open homepage in new tab with preview mode
            // window.open('index?preview=true', '_blank');
        }
        
        async function saveAboutContent() {
            try {
                const aboutData = {
                    companyName: document.getElementById('companyName').value,
                    foundedYear: document.getElementById('foundedYear').value,
                    companyLocation: document.getElementById('companyLocation').value,
                    missionStatement: document.getElementById('missionStatement').value,
                    visionStatement: document.getElementById('visionStatement').value,
                    companyDescription: document.getElementById('companyDescription').value,
                    valuesTitle: document.getElementById('valuesTitle').value,
                    value1Title: document.getElementById('value1Title').value,
                    value1Description: document.getElementById('value1Description').value,
                    value2Title: document.getElementById('value2Title').value,
                    value2Description: document.getElementById('value2Description').value,
                    value3Title: document.getElementById('value3Title').value,
                    value3Description: document.getElementById('value3Description').value
                };
                
                console.log('Saving about content:', aboutData);
                
                const token = localStorage.getItem('adminToken');
                const headers = {
                    'Content-Type': 'application/json'
                };
                
                if (token) {
                    headers['Authorization'] = `Bearer ${token}`;
                }
                
                const response = await fetch(`${API_BASE_URL}/About/content`, {
                    method: 'POST',
                    headers: headers,
                    body: JSON.stringify(aboutData)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    console.log('About content saved to backend:', result);
                    showNotification('About page content saved successfully!', 'success');
                } else {
                    const error = await response.text();
                    console.error('Backend save error:', error);
                    showNotification(`Failed to save about content: ${error}`, 'error');
                }
                
            } catch (error) {
                console.error('Error saving about content:', error);
                showNotification('Failed to save about content', 'error');
            }
        }
        
        async function loadAboutContent() {
            try {
                const savedData = localStorage.getItem('aboutContent');
                if (savedData) {
                    const aboutData = JSON.parse(savedData);
                    
                    // Populate form fields
                    if (document.getElementById('companyName')) {
                        document.getElementById('companyName').value = aboutData.companyName || 'Codenex Solutions';
                        document.getElementById('foundedYear').value = aboutData.foundedYear || '2020';
                        document.getElementById('companyLocation').value = aboutData.companyLocation || 'Global';
                        document.getElementById('missionStatement').value = aboutData.missionStatement || 'To empower businesses through innovative technology solutions that drive growth, efficiency, and digital transformation.';
                        document.getElementById('visionStatement').value = aboutData.visionStatement || 'To be the leading technology partner that transforms businesses and creates lasting value through cutting-edge solutions and exceptional service.';
                        document.getElementById('companyDescription').value = aboutData.companyDescription || 'Codenex Solutions is a premier technology company specializing in cloud migration, cybersecurity, and data analytics. With a team of experienced professionals and a commitment to excellence, we help organizations navigate the digital landscape and achieve their strategic objectives.';
                        document.getElementById('valuesTitle').value = aboutData.valuesTitle || 'Our Core Values';
                        document.getElementById('value1Title').value = aboutData.value1Title || 'Innovation';
                        document.getElementById('value1Description').value = aboutData.value1Description || 'We continuously push boundaries and embrace new technologies to deliver innovative solutions.';
                        document.getElementById('value2Title').value = aboutData.value2Title || 'Excellence';
                        document.getElementById('value2Description').value = aboutData.value2Description || 'We maintain the highest standards in everything we do, ensuring quality and reliability.';
                        document.getElementById('value3Title').value = aboutData.value3Title || 'Collaboration';
                        document.getElementById('value3Description').value = aboutData.value3Description || 'We believe in the power of teamwork and partnership to achieve extraordinary results.';
                    }
                    
                    console.log('About content loaded:', aboutData);
                }
            } catch (error) {
                console.error('Error loading about content:', error);
            }
        }
        
        async function previewAbout() {
            showNotification('About page preview - This would open the about page in a new tab', 'info');
            // Future implementation: Open about page in new tab with preview mode
            // window.open('about?preview=true', '_blank');
        }
        
        // Carousel Management Functions
        async function loadCarousel() {
            try {
                console.log('Loading carousel slides...');
                const response = await fetch(`${API_BASE_URL}/home/carousel`);
                if (!response.ok) {
                    console.error('Carousel API error:', response.status, response.statusText);
                    return;
                }
                
                let slides = await response.json();
                console.log('Carousel slides loaded:', slides);
                
                const tbody = document.querySelector('#carouselTable tbody');
                if (!tbody) {
                    console.error('Carousel table body not found!');
                    return;
                }
                
                if (slides.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 20px; color: var(--text-muted);">No carousel slides found. Create your first slide!</td></tr>';
                    return;
                }
                
                // Sort slides by display order
                slides.sort((a, b) => (a.displayOrder || 999) - (b.displayOrder || 999));
                
                tbody.innerHTML = slides.map(slide => {
                    const fullImageUrl = getFullImageUrl(slide.backgroundImageUrl);
                    // Use keyMessage, subtitle, or description - whichever is available
                    const description = slide.keyMessage || slide.subtitle || slide.description || 'No description';
                    return `
                    <tr>
                        <td><span class="table-cell-content">#${slide.id}</span></td>
                        <td>
                            <div class="table-cell-content">
                                <div style="font-weight: 600; margin-bottom: 2px;">${slide.title}</div>
                            </div>
                        </td>
                        <td><span style="color: var(--text-light);">${description.length > 60 ? description.substring(0, 60) + '...' : description}</span></td>
                        <td>
                            ${fullImageUrl ? 
                                `<img src="${fullImageUrl}" alt="${slide.title}" style="width: 50px; height: 30px; object-fit: cover; border-radius: 4px; border: 1px solid var(--glass-border);" onerror="this.style.display='none'; this.nextElementSibling.style.display='inline-block';">
                                 <span style="display: none; font-size: 0.8rem; color: var(--text-muted);">No Image</span>` : 
                                '<span style="font-size: 0.8rem; color: var(--text-muted);">No Image</span>'
                            }
                        </td>
                        <td><span class="table-cell-content"><i class="fas fa-sort table-cell-icon"></i> ${slide.displayOrder || 999}</span></td>
                        <td><span class="status-badge ${slide.isActive ? 'status-active' : 'status-inactive'}">${slide.isActive ? 'Active' : 'Inactive'}</span></td>
                        <td>
                            <div class="table-actions">
                                <button class="btn btn-view" onclick="viewCarouselSlide(${slide.id})" title="View Slide"><i class="fas fa-eye"></i></button>
                                <button class="btn btn-warning" onclick="editCarouselSlide(${slide.id})" title="Edit Slide"><i class="fas fa-edit"></i></button>
                                <button class="btn btn-danger" onclick="deleteCarouselSlide(${slide.id})" title="Delete Slide"><i class="fas fa-trash"></i></button>
                            </div>
                        </td>
                    </tr>
                `}).join('');
                
            } catch (error) {
                console.error('Error loading carousel slides:', error);
                const tbody = document.querySelector('#carouselTable tbody');
                if (tbody) {
                    tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 20px; color: var(--text-muted);">Error loading carousel slides</td></tr>';
                }
            }
        }
        
        function showAddCarouselModal() {
            // Reset form for adding new carousel slide
            document.getElementById('carouselForm').reset();
            document.getElementById('slideId').value = '';
            document.getElementById('carouselModalTitle').innerHTML = '<i class="fas fa-plus"></i> Add New Carousel Slide';
            document.getElementById('carouselSubmitBtn').innerHTML = '<i class="fas fa-save"></i> Create Slide';
            document.getElementById('slideBackgroundImage').setAttribute('required', 'required');
            document.getElementById('currentSlideImagePreview').style.display = 'none';
            showModal('carouselModal');
        }
        
        async function editCarouselSlide(id) {
            try {
                // Fetch slide details
                const response = await fetch(`${API_BASE_URL}/home/carousel/${id}`);
                if (!response.ok) {
                    throw new Error(`Failed to fetch slide: ${response.status}`);
                }
                
                const slide = await response.json();
                
                // Populate the form with existing data
                document.getElementById('slideId').value = slide.id;
                document.getElementById('slideTitle').value = slide.title;
                document.getElementById('slideDescription').value = slide.description || slide.subtitle || '';
                document.getElementById('slideKeyMessage').value = slide.keyMessage || slide.description || slide.subtitle || '';
                document.getElementById('slideCtaText').value = slide.buttonText || '';
                document.getElementById('slideCtaLink').value = slide.buttonLinkUrl || '';
                document.getElementById('slideOrder').value = slide.displayOrder || 999;
                document.getElementById('slideActive').checked = slide.isActive;
                
                // Show current image if exists
                const currentImagePreview = document.getElementById('currentSlideImagePreview');
                const currentImage = document.getElementById('currentSlideImage');
                const fullImageUrl = getFullImageUrl(slide.backgroundImageUrl);
                if (fullImageUrl) {
                    currentImage.src = fullImageUrl;
                    currentImagePreview.style.display = 'block';
                } else {
                    currentImagePreview.style.display = 'none';
                }
                
                // Update modal title and button text
                document.getElementById('carouselModalTitle').innerHTML = '<i class="fas fa-edit"></i> Edit Carousel Slide';
                document.getElementById('carouselSubmitBtn').innerHTML = '<i class="fas fa-save"></i> Update Slide';
                
                // Make image field optional for editing
                document.getElementById('slideBackgroundImage').removeAttribute('required');
                
                // Show the modal
                showModal('carouselModal');
                
            } catch (error) {
                console.error('Error loading slide for editing:', error);
                showNotification('Failed to load slide details for editing', 'error');
            }
        }
        
        async function viewCarouselSlide(id) {
            try {
                const response = await fetch(`${API_BASE_URL}/home/carousel/${id}`);
                if (!response.ok) {
                    throw new Error(`Failed to fetch slide: ${response.status}`);
                }
                
                const slide = await response.json();
                
                // Create image display with proper fallback
                const fullImageUrl = getFullImageUrl(slide.backgroundImageUrl);
                const imageDisplay = fullImageUrl ? 
                    `<div style="margin-bottom: 20px; text-align: center;">
                        <img src="${fullImageUrl}" alt="${slide.title}" 
                             style="width: 100%; max-width: 600px; height: 300px; object-fit: cover; border-radius: 12px; border: 1px solid var(--glass-border);" 
                             onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        <div style="display: none; width: 100%; max-width: 600px; height: 300px; background: var(--glass-bg); border-radius: 12px; align-items: center; justify-content: center; border: 1px solid var(--glass-border); margin: 0 auto;">
                            <div style="text-align: center; color: var(--text-muted);">
                                <i class="fas fa-image" style="font-size: 48px; margin-bottom: 10px; color: var(--primary);"></i>
                                <div>No Background Image</div>
                            </div>
                        </div>
                    </div>` : 
                    `<div style="margin-bottom: 20px; text-align: center;">
                        <div style="width: 100%; max-width: 600px; height: 300px; background: var(--glass-bg); border-radius: 12px; display: flex; align-items: center; justify-content: center; border: 1px solid var(--glass-border); margin: 0 auto;">
                            <div style="text-align: center; color: var(--text-muted);">
                                <i class="fas fa-image" style="font-size: 48px; margin-bottom: 10px; color: var(--primary);"></i>
                                <div>No Background Image</div>
                            </div>
                        </div>
                    </div>`;
                
                showViewModal('Carousel Slide Details', `
                    <div style="padding: 20px;">
                        ${imageDisplay}
                        <h3 style="color: var(--primary); margin-bottom: 10px;">${slide.title}</h3>
                        <p style="color: var(--text-light); line-height: 1.6; margin-bottom: 20px;">${slide.description || 'No description available'}</p>
                        
                        ${slide.buttonText ? `
                            <h4 style="color: var(--text); margin: 20px 0 10px 0;">Call-to-Action:</h4>
                            <div style="background: var(--glass-bg); padding: 15px; border-radius: 8px; border-left: 4px solid var(--primary);">
                                <strong>Text:</strong> ${slide.buttonText}<br>
                                ${slide.buttonLinkUrl ? `<strong>Link:</strong> <a href="${slide.buttonLinkUrl}" target="_blank" style="color: var(--primary);">${slide.buttonLinkUrl}</a>` : '<em>No link specified</em>'}
                            </div>
                        ` : ''}
                        
                        <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--glass-border);">
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-bottom: 15px;">
                                <div>
                                    <strong>Slide ID:</strong> ${slide.id}
                                </div>
                                <div>
                                    <strong>Display Order:</strong> ${slide.displayOrder || 'Not set'}
                                </div>
                                <div>
                                    <strong>Status:</strong> 
                                    <span class="status-badge ${slide.isActive ? 'status-active' : 'status-inactive'}">
                                        ${slide.isActive ? 'Active' : 'Inactive'}
                                    </span>
                                </div>
                            </div>
                            <p><strong>Created:</strong> ${new Date(slide.createdAt).toLocaleString()}</p>
                            <p><strong>Updated:</strong> ${new Date(slide.updatedAt).toLocaleString()}</p>
                        </div>
                    </div>
                `);
                
            } catch (error) {
                console.error('Error loading slide for viewing:', error);
                showNotification('Failed to load slide details', 'error');
            }
        }
        
        async function deleteCarouselSlide(id) {
            if (confirm('Are you sure you want to delete this carousel slide?')) {
                try {
                    const token = getAuthToken();
                    if (!token) {
                        showNotification('Please log in again to perform this action', 'error');
                        return;
                    }
                    
                    const response = await fetch(`${API_BASE_URL}/home/carousel/${id}`, {
                        method: 'DELETE',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    if (response.ok) {
                        showNotification('Carousel slide deleted successfully', 'success');
                        loadCarousel();
                    } else if (response.status === 401) {
                        showNotification('Authentication failed. Please log in again.', 'error');
                        logout();
                    } else {
                        const error = await response.text();
                        showNotification(`Failed to delete slide: ${error}`, 'error');
                    }
                } catch (error) {
                    console.error('Error deleting slide:', error);
                    showNotification('Failed to delete slide', 'error');
                }
            }
        }
        
        async function submitCarouselForm(formData) {
            try {
                const slideId = formData.get('slideId');
                const isEditing = slideId && slideId !== '';
                
                console.log(`${isEditing ? 'Updating' : 'Creating'} carousel slide with data:`, formData);
                
                // Log form data contents
                for (let [key, value] of formData.entries()) {
                    console.log(`${key}:`, value);
                }
                
                // Add required fields that are missing from the form
                // KeyMessage is required by the backend API
                if (!formData.has('KeyMessage')) {
                    formData.set('KeyMessage', formData.get('KeyMessage') || formData.get('description') || 'Carousel slide');
                }
                
                // DisplayOrder must be a valid number
                if (!formData.get('displayOrder') || formData.get('displayOrder') === '') {
                    formData.set('displayOrder', '999'); // Default to a high number if not specified
                }
                
                // Make sure isActive is properly formatted
                const isActive = formData.get('isActive') === 'on';
                formData.set('isActive', isActive.toString());
                
                let apiUrl, method;
                if (isEditing) {
                    // For editing, use PUT method to the specific slide endpoint
                    apiUrl = `${API_BASE_URL}/home/carousel/${slideId}`;
                    method = 'PUT';
                } else {
                    // For creating, use POST method to carousel endpoint
                    apiUrl = `${API_BASE_URL}/home/carousel`;
                    method = 'POST';
                }
                
                console.log('API URL:', apiUrl);
                console.log('Method:', method);
                
                // Log all form data after adding required fields
                console.log('Final form data:');
                for (let [key, value] of formData.entries()) {
                    console.log(`${key}:`, value);
                }
                
                // Prepare headers with authentication token
                const headers = {};
                const token = localStorage.getItem('adminToken');
                if (token) {
                    headers['Authorization'] = `Bearer ${token}`;
                    console.log('Adding auth token to request');
                } else {
                    console.warn('No admin token found');
                }
                
                const response = await fetch(apiUrl, {
                    method: method,
                    headers: headers,
                    body: formData
                });
                
                console.log('Response status:', response.status);
                console.log('Response headers:', response.headers);

                if (response.ok) {
                    let result;
                    if (isEditing) {
                        // PUT returns NoContent (204), so no JSON to parse
                        result = { success: true };
                        console.log('Update successful');
                    } else {
                        // POST returns JSON with created slide
                        result = await response.json();
                        console.log('Success result:', result);
                    }
                    showNotification(`Carousel slide ${isEditing ? 'updated' : 'created'} successfully!`, 'success');
                    closeModal('carouselModal');
                    loadCarousel();
                    return true;
                } else {
                    const error = await response.text();
                    console.error('API Error Response:', error);
                    showNotification(`Error (${response.status}): ${error || 'Unknown error'}`, 'error');
                    return false;
                }
            } catch (error) {
                console.error('Network/Fetch Error with carousel slide:', error);
                showNotification(`Failed to ${formData.get('slideId') ? 'update' : 'create'} carousel slide: ${error.message}`, 'error');
                return false;
            }
        }
        
        // Carousel utility functions
        function reorderSlides() {
            showNotification('Reorder functionality - Manual drag and drop implementation needed', 'info');
        }
        
        function bulkToggleStatus() {
            showNotification('Bulk toggle functionality - Implementation needed', 'info');
        }
        
        function previewHomepage() {
            showNotification('Homepage preview - This would open the homepage in a new tab', 'info');
            // Future implementation: Open homepage in new tab with preview mode
            // window.open('index?preview=true', '_blank');
        }
        
        // Team Management Functions
        async function loadTeamMembers() {
            try {
                console.log('Loading team members...');
                const response = await fetch(`${API_BASE_URL}/TeamMembers`);
                if (!response.ok) {
                    console.error('Team members API error:', response.status, response.statusText);
                    return;
                }
                
                let teamMembers = await response.json();
                console.log('Team members loaded:', teamMembers);
                
                const tbody = document.querySelector('#teamTable tbody');
                if (!tbody) {
                    console.error('Team table body not found!');
                    return;
                }
                
                if (teamMembers.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 20px; color: var(--text-muted);">No team members found. Add your first team member!</td></tr>';
                    return;
                }
                
                // Sort team members by display order
                teamMembers.sort((a, b) => (a.displayOrder || 999) - (b.displayOrder || 999));
                
                tbody.innerHTML = teamMembers.map(member => {
                    const fullImageUrl = getFullImageUrl(member.photoUrl);
                    const fullName = `${member.firstName} ${member.lastName}`;
                    return `
                    <tr>
                        <td><span class="table-cell-content">#${member.id}</span></td>
                        <td>
                            <div class="table-cell-content">
                                <div class="member-image-container" style="width: 32px; height: 32px; margin-right: 12px; flex-shrink: 0;">
                                    ${fullImageUrl ? 
                                        `<img src="${fullImageUrl}" alt="${fullName}" 
                                             style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover; border: 2px solid var(--primary);" 
                                             onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"> 
                                         <div class="fallback-icon" style="display: none; width: 100%; height: 100%; background: var(--primary); border-radius: 50%; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 14px;">
                                             ${member.firstName.charAt(0)}${member.lastName.charAt(0)}
                                         </div>` : 
                                        `<div class="fallback-icon" style="width: 100%; height: 100%; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 14px;">
                                             ${member.firstName.charAt(0)}${member.lastName.charAt(0)}
                                         </div>`
                                    }
                                </div>
                                <div>
                                    <div style="font-weight: 600; margin-bottom: 2px;">${fullName}</div>
                                    <div style="font-size: 0.8rem; color: var(--text-muted);">${member.email || 'No email'}</div>
                                </div>
                            </div>
                        </td>
                        <td><span style="color: var(--primary); font-weight: 500;">${member.position}</span></td>
                        <td>${fullImageUrl ? '<span class="status-badge status-active">Yes</span>' : '<span class="status-badge status-inactive">No</span>'}</td>
                        <td><span class="table-cell-content"><i class="fas fa-sort table-cell-icon"></i> ${member.displayOrder || 0}</span></td>
                        <td><span class="status-badge ${member.isActive ? 'status-active' : 'status-inactive'}">${member.isActive ? 'Active' : 'Inactive'}</span></td>
                        <td>
                            <div class="table-actions">
                                <button class="btn btn-view" onclick="viewTeamMember(${member.id})" title="View Member"><i class="fas fa-eye"></i></button>
                                <button class="btn btn-warning" onclick="editTeamMember(${member.id})" title="Edit Member"><i class="fas fa-edit"></i></button>
                                <button class="btn btn-danger" onclick="deleteTeamMember(${member.id})" title="Delete Member"><i class="fas fa-trash"></i></button>
                            </div>
                        </td>
                    </tr>
                `}).join('');
                
            } catch (error) {
                console.error('Error loading team members:', error);
                const tbody = document.querySelector('#teamTable tbody');
                if (tbody) {
                    tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 20px; color: var(--text-muted);">Error loading team members</td></tr>';
                }
            }
        }
        
        function showAddTeamMemberModal() {
            // Reset form for adding new team member
            document.getElementById('teamMemberForm').reset();
            document.getElementById('teamMemberId').value = '';
            document.getElementById('teamMemberModalTitle').innerHTML = '<i class="fas fa-plus"></i> Add New Team Member';
            document.getElementById('teamMemberSubmitBtn').innerHTML = '<i class="fas fa-save"></i> Create Member';
            document.getElementById('teamMemberPhoto').removeAttribute('required');
            document.getElementById('currentTeamMemberImagePreview').style.display = 'none';
            showModal('teamMemberModal');
        }
        
        async function viewTeamMember(id) {
            try {
                const response = await fetch(`${API_BASE_URL}/About/team/${id}`);
                if (!response.ok) {
                    throw new Error(`Failed to fetch team member: ${response.status}`);
                }
                
                const member = await response.json();
                const fullName = `${member.firstName} ${member.lastName}`;
                const fullImageUrl = getFullImageUrl(member.photoUrl);
                
                const imageDisplay = fullImageUrl ? 
                    `<div style="margin-bottom: 20px; text-align: center;">
                        <img src="${fullImageUrl}" alt="${fullName}" 
                             style="width: 150px; height: 150px; border-radius: 50%; object-fit: cover; border: 4px solid var(--primary); box-shadow: 0 4px 8px rgba(0,0,0,0.1);" 
                             onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        <div style="display: none; width: 150px; height: 150px; background: var(--primary); border-radius: 50%; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 3rem; margin: 0 auto;">
                            ${member.firstName.charAt(0)}${member.lastName.charAt(0)}
                        </div>
                    </div>` : 
                    `<div style="margin-bottom: 20px; text-align: center;">
                        <div style="width: 150px; height: 150px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 3rem; margin: 0 auto;">
                            ${member.firstName.charAt(0)}${member.lastName.charAt(0)}
                        </div>
                    </div>`;
                
                showViewModal('Team Member Details', `
                    <div style="padding: 20px;">
                        ${imageDisplay}
                        <h3 style="color: var(--primary); margin-bottom: 5px; text-align: center;">${fullName}</h3>
                        <p style="text-align: center; color: var(--text-light); margin-bottom: 20px; font-size: 1.1rem; font-weight: 500;">${member.position}</p>
                        
                        <div style="background: var(--glass-bg); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                                <div>
                                    <strong style="color: var(--primary); display: block; margin-bottom: 5px;">Department:</strong>
                                    <span>${member.department || 'Not specified'}</span>
                                </div>
                                <div>
                                    <strong style="color: var(--primary); display: block; margin-bottom: 5px;">Email:</strong>
                                    <span>${member.email || 'Not provided'}</span>
                                </div>
                            </div>
                            
                            ${member.bio ? `
                                <div style="margin-bottom: 20px;">
                                    <strong style="color: var(--primary); display: block; margin-bottom: 10px;">Bio:</strong>
                                    <div style="background: var(--bg-light); padding: 15px; border-radius: 8px; border-left: 4px solid var(--primary); line-height: 1.6;">
                                        ${member.bio}
                                    </div>
                                </div>
                            ` : ''}
                            
                            <div style="display: flex; gap: 15px; justify-content: center; margin-top: 20px;">
                                ${member.linkedInUrl ? `<a href="${member.linkedInUrl}" target="_blank" class="btn btn-info" style="padding: 8px 16px;"><i class="fab fa-linkedin"></i> LinkedIn</a>` : ''}
                                ${member.twitterUrl ? `<a href="${member.twitterUrl}" target="_blank" class="btn btn-primary" style="padding: 8px 16px;"><i class="fab fa-twitter"></i> Twitter</a>` : ''}
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; font-size: 0.9rem; color: var(--text-muted);">
                            <div>
                                <strong>ID:</strong> ${member.id}
                            </div>
                            <div>
                                <strong>Order:</strong> ${member.displayOrder || 0}
                            </div>
                            <div>
                                <strong>Status:</strong> 
                                <span class="status-badge ${member.isActive ? 'status-active' : 'status-inactive'}">
                                    ${member.isActive ? 'Active' : 'Inactive'}
                                </span>
                            </div>
                        </div>
                    </div>
                `);
                
            } catch (error) {
                console.error('Error loading team member for viewing:', error);
                showNotification('Failed to load team member details', 'error');
            }
        }
        
        async function editTeamMember(id) {
            try {
                const response = await fetch(`${API_BASE_URL}/TeamMembers/${id}`);
                if (!response.ok) {
                    throw new Error(`Failed to fetch team member: ${response.status}`);
                }
                
                const member = await response.json();
                
                // Populate the form with existing data
                document.getElementById('teamMemberId').value = member.id;
                document.getElementById('teamMemberFirstName').value = member.firstName;
                document.getElementById('teamMemberLastName').value = member.lastName;
                document.getElementById('teamMemberPosition').value = member.position;
                document.getElementById('teamMemberDepartment').value = member.department || '';
                document.getElementById('teamMemberBio').value = member.bio || '';
                document.getElementById('teamMemberEmail').value = member.email || '';
                document.getElementById('teamMemberLinkedIn').value = member.linkedInUrl || '';
                document.getElementById('teamMemberTwitter').value = member.twitterUrl || '';
                document.getElementById('teamMemberOrder').value = member.displayOrder || 0;
                document.getElementById('teamMemberActive').checked = member.isActive;
                
                // Show current image if exists
                const currentImagePreview = document.getElementById('currentTeamMemberImagePreview');
                const currentImage = document.getElementById('currentTeamMemberImage');
                const fullImageUrl = getFullImageUrl(member.photoUrl);
                if (fullImageUrl) {
                    currentImage.src = fullImageUrl;
                    currentImagePreview.style.display = 'block';
                } else {
                    currentImagePreview.style.display = 'none';
                }
                
                // Update modal title and button text
                document.getElementById('teamMemberModalTitle').innerHTML = '<i class="fas fa-edit"></i> Edit Team Member';
                document.getElementById('teamMemberSubmitBtn').innerHTML = '<i class="fas fa-save"></i> Update Member';
                
                // Make photo field optional for editing
                document.getElementById('teamMemberPhoto').removeAttribute('required');
                
                // Show the modal
                showModal('teamMemberModal');
                
            } catch (error) {
                console.error('Error loading team member for editing:', error);
                showNotification('Failed to load team member details for editing', 'error');
            }
        }
        
        async function deleteTeamMember(id) {
            if (confirm('Are you sure you want to delete this team member?')) {
                try {
                    const token = getAuthToken();
                const response = await fetch(`${API_BASE_URL}/About/team/${id}`, {
                        method: 'DELETE',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    if (response.ok) {
                        showNotification('Team member deleted successfully', 'success');
                        loadTeamMembers();
                    } else {
                        const error = await response.text();
                        showNotification(`Failed to delete team member: ${error}`, 'error');
                    }
                } catch (error) {
                    console.error('Error deleting team member:', error);
                    showNotification('Failed to delete team member', 'error');
                }
            }
        }
        
        async function submitTeamMemberForm(formData) {
            try {
                const memberId = formData.get('teamMemberId');
                const isEditing = memberId && memberId !== '';
                
                console.log(`${isEditing ? 'Updating' : 'Creating'} team member with data:`, formData);
                
                let apiUrl, method;
                if (isEditing) {
                    apiUrl = `${API_BASE_URL}/About/team/${memberId}`;
                    method = 'PUT';
                } else {
                    apiUrl = `${API_BASE_URL}/About/team/upload`;
                    method = 'POST';
                }
                
                const token = getAuthToken();
                const headers = {};
                if (token) {
                    headers['Authorization'] = `Bearer ${token}`;
                }
                
                const response = await fetch(apiUrl, {
                    method: method,
                    headers: headers,
                    body: formData
                });
                
                if (response.ok) {
                    showNotification(`Team member ${isEditing ? 'updated' : 'created'} successfully!`, 'success');
                    closeModal('teamMemberModal');
                    loadTeamMembers();
                    return true;
                } else {
                    const error = await response.text();
                    console.error('API Error Response:', error);
                    showNotification(`Error (${response.status}): ${error || 'Unknown error'}`, 'error');
                    return false;
                }
            } catch (error) {
                console.error('Network/Fetch Error with team member:', error);
                showNotification(`Failed to ${formData.get('teamMemberId') ? 'update' : 'create'} team member: ${error.message}`, 'error');
                return false;
            }
        }
        
        // Testimonial Management Functions
        async function loadTestimonials() {
            try {
                console.log('Loading testimonials...');
                const response = await fetch(`${API_BASE_URL}/About/testimonials`);
                if (!response.ok) {
                    console.error('Testimonials API error:', response.status, response.statusText);
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                let testimonials = await response.json();
                console.log('Testimonials loaded:', testimonials);
                
                const tbody = document.querySelector('#testimonialsTable tbody');
                if (!tbody) {
                    console.error('Testimonials table body not found!');
                    return;
                }
                
                if (testimonials.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 20px; color: var(--text-muted);">No testimonials found. Add your first testimonial!</td></tr>';
                    return;
                }
                
                // Sort testimonials by display order
                testimonials.sort((a, b) => (a.displayOrder || 999) - (b.displayOrder || 999));
                
                tbody.innerHTML = testimonials.map(testimonial => {
                    const fullImageUrl = getFullImageUrl(testimonial.clientPhotoUrl);
                    const stars = ''.repeat(testimonial.rating) + ''.repeat(5 - testimonial.rating);
                    return `
                    <tr>
                        <td><span class="table-cell-content">#${testimonial.id}</span></td>
                        <td>
                            <div class="table-cell-content">
                                <div class="client-image-container" style="width: 32px; height: 32px; margin-right: 12px; flex-shrink: 0;">
                                    ${fullImageUrl ? 
                                        `<img src="${fullImageUrl}" alt="${testimonial.clientName}" 
                                             style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover; border: 2px solid var(--primary);" 
                                             onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"> 
                                         <div class="fallback-icon" style="display: none; width: 100%; height: 100%; background: var(--primary); border-radius: 50%; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 14px;">
                                             ${testimonial.clientName.charAt(0)}
                                         </div>` : 
                                        `<div class="fallback-icon" style="width: 100%; height: 100%; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 14px;">
                                             ${testimonial.clientName.charAt(0)}
                                         </div>`
                                    }
                                </div>
                                <div>
                                    <div style="font-weight: 600; margin-bottom: 2px;">${testimonial.clientName}</div>
                                    <div style="font-size: 0.8rem; color: var(--text-muted);">${testimonial.clientPosition}</div>
                                </div>
                            </div>
                        </td>
                        <td><span style="color: var(--info); font-weight: 500;">${testimonial.companyName}</span></td>
                        <td><span style="color: var(--text-light);">${testimonial.message.length > 50 ? testimonial.message.substring(0, 50) + '...' : testimonial.message}</span></td>
                        <td><span style="color: var(--warning); font-size: 1.1rem;" title="${testimonial.rating}/5 stars">${stars}</span></td>
                        <td><span class="status-badge ${testimonial.isActive ? 'status-active' : 'status-inactive'}">${testimonial.isActive ? 'Active' : 'Inactive'}</span></td>
                        <td>
                            <div class="table-actions">
                                <button class="btn btn-view" onclick="viewTestimonial(${testimonial.id})" title="View Testimonial"><i class="fas fa-eye"></i></button>
                                <button class="btn btn-warning" onclick="editTestimonial(${testimonial.id})" title="Edit Testimonial"><i class="fas fa-edit"></i></button>
                                <button class="btn btn-danger" onclick="deleteTestimonial(${testimonial.id})" title="Delete Testimonial"><i class="fas fa-trash"></i></button>
                            </div>
                        </td>
                    </tr>
                `}).join('');
                
            } catch (error) {
                console.error('Error loading testimonials:', error);
                const tbody = document.querySelector('#testimonialsTable tbody');
                if (tbody) {
                    tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 20px; color: var(--text-muted);">Error loading testimonials</td></tr>';
                }
            }
        }
        
        function showAddTestimonialModal() {
            // Reset form for adding new testimonial
            document.getElementById('testimonialForm').reset();
            document.getElementById('testimonialId').value = '';
            document.getElementById('testimonialModalTitle').innerHTML = '<i class="fas fa-plus"></i> Add New Testimonial';
            document.getElementById('testimonialSubmitBtn').innerHTML = '<i class="fas fa-save"></i> Create Testimonial';
            document.getElementById('testimonialRating').value = '5';
            document.getElementById('testimonialActive').checked = true;
            document.getElementById('currentTestimonialImagePreview').style.display = 'none';
            showModal('testimonialModal');
        }
        
        async function viewTestimonial(id) {
            try {
                const response = await fetch(`${API_BASE_URL}/About/testimonials/${id}`);
                if (!response.ok) {
                    throw new Error(`Failed to fetch testimonial: ${response.status}`);
                }
                
                const testimonial = await response.json();
                const fullImageUrl = getFullImageUrl(testimonial.clientPhotoUrl);
                const companyLogoUrl = getFullImageUrl(testimonial.companyLogoUrl);
                const stars = ''.repeat(testimonial.rating) + ''.repeat(5 - testimonial.rating);
                
                const imageDisplay = fullImageUrl ? 
                    `<div style="margin-bottom: 20px; text-align: center;">
                        <img src="${fullImageUrl}" alt="${testimonial.clientName}" 
                             style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover; border: 3px solid var(--primary); box-shadow: 0 4px 8px rgba(0,0,0,0.1);" 
                             onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        <div style="display: none; width: 100px; height: 100px; background: var(--primary); border-radius: 50%; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 2rem; margin: 0 auto;">
                            ${testimonial.clientName.charAt(0)}
                        </div>
                    </div>` : 
                    `<div style="margin-bottom: 20px; text-align: center;">
                        <div style="width: 100px; height: 100px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 2rem; margin: 0 auto;">
                            ${testimonial.clientName.charAt(0)}
                        </div>
                    </div>`;
                
                showViewModal('Testimonial Details', `
                    <div style="padding: 20px;">
                        ${imageDisplay}
                        <h3 style="color: var(--primary); margin-bottom: 5px; text-align: center;">${testimonial.clientName}</h3>
                        <p style="text-align: center; color: var(--text-light); margin-bottom: 10px; font-weight: 500;">${testimonial.clientPosition}</p>
                        <div style="text-align: center; margin-bottom: 20px;">
                            ${companyLogoUrl ? 
                                `<img src="${companyLogoUrl}" alt="${testimonial.companyName}" style="height: 30px; margin-right: 10px; vertical-align: middle;">` : 
                                '<i class="fas fa-building" style="color: var(--primary); margin-right: 8px;"></i>'
                            }
                            <span style="font-size: 1.1rem; color: var(--info); font-weight: 500;">${testimonial.companyName}</span>
                        </div>
                        
                        <div style="background: var(--glass-bg); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                            <div style="text-align: center; margin-bottom: 15px;">
                                <span style="color: var(--warning); font-size: 1.5rem;" title="${testimonial.rating}/5 stars">${stars}</span>
                                <span style="margin-left: 10px; color: var(--text-light);">(${testimonial.rating}/5)</span>
                            </div>
                            
                            <div style="background: var(--bg-light); padding: 20px; border-radius: 8px; border-left: 4px solid var(--primary); line-height: 1.6; font-style: italic; position: relative;">
                                <i class="fas fa-quote-left" style="position: absolute; top: 10px; left: 10px; color: var(--primary); opacity: 0.3; font-size: 2rem;"></i>
                                <div style="margin-left: 40px;">${testimonial.message}</div>
                                <i class="fas fa-quote-right" style="position: absolute; bottom: 10px; right: 15px; color: var(--primary); opacity: 0.3; font-size: 2rem;"></i>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; font-size: 0.9rem; color: var(--text-muted);">
                            <div>
                                <strong>ID:</strong> ${testimonial.id}
                            </div>
                            <div>
                                <strong>Order:</strong> ${testimonial.displayOrder || 0}
                            </div>
                            <div>
                                <strong>Status:</strong> 
                                <span class="status-badge ${testimonial.isActive ? 'status-active' : 'status-inactive'}">
                                    ${testimonial.isActive ? 'Active' : 'Inactive'}
                                </span>
                                ${testimonial.isApproved ? '' : ' <span class="status-badge status-warning">Pending Approval</span>'}
                            </div>
                        </div>
                    </div>
                `);
                
            } catch (error) {
                console.error('Error loading testimonial for viewing:', error);
                showNotification('Failed to load testimonial details', 'error');
            }
        }
        
        async function editTestimonial(id) {
            try {
                const response = await fetch(`${API_BASE_URL}/About/testimonials/${id}`);
                if (!response.ok) {
                    throw new Error(`Failed to fetch testimonial: ${response.status}`);
                }

                const testimonial = await response.json();
                
                // Populate the form with existing data
                document.getElementById('testimonialId').value = testimonial.id;
                document.getElementById('testimonialClientName').value = testimonial.clientName;
                document.getElementById('testimonialClientPosition').value = testimonial.clientPosition;
                document.getElementById('testimonialCompanyName').value = testimonial.companyName;
                document.getElementById('testimonialMessage').value = testimonial.message;
                document.getElementById('testimonialRating').value = testimonial.rating;
                document.getElementById('testimonialOrder').value = testimonial.displayOrder || 0;
                document.getElementById('testimonialActive').checked = testimonial.isActive;
                document.getElementById('testimonialApproved').checked = testimonial.isApproved;
                
                // Show current images if they exist
                const currentImagePreview = document.getElementById('currentTestimonialImagePreview');
                const currentClientImage = document.getElementById('currentTestimonialClientImage');
                const currentCompanyLogo = document.getElementById('currentTestimonialCompanyLogo');
                
                const fullClientImageUrl = getFullImageUrl(testimonial.clientPhotoUrl);
                const fullCompanyLogoUrl = getFullImageUrl(testimonial.companyLogoUrl);
                
                let hasImages = false;
                if (fullClientImageUrl) {
                    currentClientImage.src = fullClientImageUrl;
                    currentClientImage.style.display = 'inline-block';
                    hasImages = true;
                }
                if (fullCompanyLogoUrl) {
                    currentCompanyLogo.src = fullCompanyLogoUrl;
                    currentCompanyLogo.style.display = 'inline-block';
                    hasImages = true;
                }
                
                currentImagePreview.style.display = hasImages ? 'block' : 'none';
                
                // Update modal title and button text
                document.getElementById('testimonialModalTitle').innerHTML = '<i class="fas fa-edit"></i> Edit Testimonial';
                document.getElementById('testimonialSubmitBtn').innerHTML = '<i class="fas fa-save"></i> Update Testimonial';
                
                // Show the modal
                showModal('testimonialModal');
                
            } catch (error) {
                console.error('Error loading testimonial for editing:', error);
                showNotification('Failed to load testimonial details for editing', 'error');
            }
        }
        
        async function deleteTestimonial(id) {
            if (confirm('Are you sure you want to delete this testimonial?')) {
                try {
                    const token = getAuthToken();
                    const response = await fetch(`${API_BASE_URL}/About/testimonials/${id}`, {
                        method: 'DELETE',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    if (response.ok) {
                        showNotification('Testimonial deleted successfully', 'success');
                        loadTestimonials();
                    } else {
                        const error = await response.text();
                        showNotification(`Failed to delete testimonial: ${error}`, 'error');
                    }
                } catch (error) {
                    console.error('Error deleting testimonial:', error);
                    showNotification('Failed to delete testimonial', 'error');
                }
            }
        }
        
        async function submitTestimonialForm(formData) {
            try {
                const testimonialId = formData.get('testimonialId');
                const isEditing = testimonialId && testimonialId !== '';
                
                console.log(`${isEditing ? 'Updating' : 'Creating'} testimonial with data:`, formData);
                
                // Fix boolean values for checkboxes
                const isActive = formData.get('isActive') === 'on';
                const isApproved = formData.get('isApproved') === 'on';
                
                // Update FormData with proper boolean values
                formData.set('isActive', isActive.toString());
                formData.set('isApproved', isApproved.toString());
                
                // Log form data after conversion
                console.log('Form data after boolean conversion:');
                for (let [key, value] of formData.entries()) {
                    console.log(`${key}:`, value);
                }
                
                let apiUrl, method;
                if (isEditing) {
                    apiUrl = `${API_BASE_URL}/About/testimonials/${testimonialId}`;
                    method = 'PUT';
                } else {
                    apiUrl = `${API_BASE_URL}/About/testimonials`;
                    method = 'POST';
                }
                
                const token = getAuthToken();
                const headers = {};
                if (token) {
                    headers['Authorization'] = `Bearer ${token}`;
                }
                
                const response = await fetch(apiUrl, {
                    method: method,
                    headers: headers,
                    body: formData
                });
                
                if (response.ok) {
                    showNotification(`Testimonial ${isEditing ? 'updated' : 'created'} successfully!`, 'success');
                    closeModal('testimonialModal');
                    loadTestimonials();
                    return true;
                } else {
                    const error = await response.text();
                    console.error('API Error Response:', error);
                    showNotification(`Error (${response.status}): ${error || 'Unknown error'}`, 'error');
                    return false;
                }
            } catch (error) {
                console.error('Network/Fetch Error with testimonial:', error);
                showNotification(`Failed to ${formData.get('testimonialId') ? 'update' : 'create'} testimonial: ${error.message}`, 'error');
                return false;
            }
        }
        
        // Load content when navigating to sections - This functionality is handled in setupEventListeners
        
        // User Management Functions
        async function loadUsers() {
            try {
                console.log('Loading users...');
                const role = document.getElementById('userRoleFilter')?.value || '';
                const search = document.getElementById('userSearch')?.value || '';
                
                let url = `${API_BASE_URL}/Auth/users`;
                const params = new URLSearchParams();
                
                if (role) {
                    params.append('role', role);
                }
                if (search) {
                    params.append('search', search);
                }
                
                if (params.toString()) {
                    url += '?' + params.toString();
                }
                
                console.log('Fetching users from:', url);
                
                const token = getAuthToken();
                const headers = {};
                if (token) {
                    headers['Authorization'] = `Bearer ${token}`;
                }
                
                const response = await fetch(url, { headers });
                if (!response.ok) {
                    if (response.status === 401) {
                        showNotification('Unauthorized. Please log in again.', 'error');
                        logout();
                        return;
                    }
                    throw new Error(`Failed to fetch users: ${response.status}`);
                }
                
                const users = await response.json();
                console.log('Users loaded:', users);
                
                const tbody = document.querySelector('#usersTable tbody');
                if (!tbody) {
                    console.error('Users table body not found!');
                    return;
                }
                
                if (users.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 20px; color: var(--text-muted);">No users found. Create the first user account!</td></tr>';
                    return;
                }
                
                tbody.innerHTML = users.map(user => {
                    const initials = (user.firstName && user.lastName) ? 
                        (user.firstName.charAt(0) + user.lastName.charAt(0)).toUpperCase() : 
                        user.email.charAt(0).toUpperCase();
                    const fullName = user.firstName && user.lastName ? 
                        `${user.firstName} ${user.lastName}` : 
                        'Unknown Name';
                    const lastLogin = user.lastLoginAt ? new Date(user.lastLoginAt).toLocaleDateString() : 'Never';
                    
                    return `
                    <tr>
                        <td><span class="table-cell-content">#${user.id}</span></td>
                        <td>
                            <div class="table-cell-content">
                                <div class="user-avatar-container" style="width: 32px; height: 32px; margin-right: 12px; flex-shrink: 0;">
                                    <div class="user-avatar" style="width: 100%; height: 100%; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 14px;">
                                        ${initials}
                                    </div>
                                </div>
                                <div>
                                    <div style="font-weight: 600; margin-bottom: 2px;">${fullName}</div>
                                    <div style="font-size: 0.8rem; color: var(--text-muted);">${user.username || user.email}</div>
                                </div>
                            </div>
                        </td>
                        <td><span class="table-cell-content"><i class="fas fa-envelope table-cell-icon"></i> ${user.email}</span></td>
                        <td><span class="status-badge status-active" style="background: var(--info); color: white;">${user.role || 'User'}</span></td>
                        <td><span class="status-badge ${user.isActive ? 'status-active' : 'status-inactive'}">${user.isActive ? 'Active' : 'Inactive'}</span></td>
                        <td><span class="table-cell-content"><i class="fas fa-clock table-cell-icon"></i> ${lastLogin}</span></td>
                        <td>
                            <div class="table-actions">
                                <button class="btn btn-view" onclick="viewUser('${user.id}')" title="View User"><i class="fas fa-eye"></i></button>
                                <button class="btn btn-warning" onclick="editUser('${user.id}')" title="Edit User"><i class="fas fa-edit"></i></button>
                                <button class="btn btn-danger" onclick="deleteUser('${user.id}')" title="Delete User"><i class="fas fa-trash"></i></button>
                                <button class="btn btn-${user.isActive ? 'success' : 'secondary'}" onclick="toggleUserBlock('${user.id}', ${user.isActive})" title="${user.isActive ? 'Block' : 'Unblock'} User">
                                    <i class="fas fa-user-${user.isActive ? 'slash' : 'check'}"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `}).join('');
                
            } catch (error) {
                console.error('Error loading users:', error);
                showNotification('Failed to load users', 'error');
            }
        }
        
        function showAddUserModal() {
            // Reset form for adding new user
            const userForm = document.getElementById('userForm');
            if (userForm) userForm.reset();
            
            const userId = document.getElementById('userId');
            if (userId) userId.value = '';
            document.getElementById('userModalTitle').innerHTML = '<i class="fas fa-plus"></i> Add New User';
            document.getElementById('userSubmitBtn').innerHTML = '<i class="fas fa-save"></i> Create User';
            document.getElementById('userPassword').setAttribute('required', 'required');
            showModal('userModal');
        }
        
        async function editUser(id) {
            try {
                const token = getAuthToken();
                const headers = {};
                if (token) {
                    headers['Authorization'] = `Bearer ${token}`;
                }
                
                const response = await fetch(`${API_BASE_URL}/Auth/users/${id}`, { headers });
                if (!response.ok) {
                    throw new Error(`Failed to fetch user: ${response.status}`);
                }
                
                const user = await response.json();
                
                // Populate the form with existing data
                document.getElementById('userId').value = user.id;
                document.getElementById('userFirstName').value = user.firstName || '';
                document.getElementById('userLastName').value = user.lastName || '';
                document.getElementById('userEmail').value = user.email;
                document.getElementById('userRole').value = user.role || 'User';
                document.getElementById('userActive').checked = user.isActive;
                
                // Update modal title and button text
                document.getElementById('userModalTitle').innerHTML = '<i class="fas fa-edit"></i> Edit User';
                document.getElementById('userSubmitBtn').innerHTML = '<i class="fas fa-save"></i> Update User';
                
                // Make password field optional for editing
                document.getElementById('userPassword').removeAttribute('required');
                
                // Show the modal
                showModal('userModal');
                
            } catch (error) {
                console.error('Error loading user for editing:', error);
                showNotification('Failed to load user details for editing', 'error');
            }
        }
        
        async function viewUser(id) {
            try {
                const token = getAuthToken();
                const headers = {};
                if (token) {
                    headers['Authorization'] = `Bearer ${token}`;
                }
                
                const response = await fetch(`${API_BASE_URL}/Auth/users/${id}`, { headers });
                if (!response.ok) {
                    throw new Error(`Failed to fetch user: ${response.status}`);
                }
                
                const user = await response.json();
                
                const fullName = user.firstName && user.lastName ? 
                    `${user.firstName} ${user.lastName}` : 
                    'Unknown Name';
                const initials = (user.firstName && user.lastName) ? 
                    (user.firstName.charAt(0) + user.lastName.charAt(0)).toUpperCase() : 
                    user.email.charAt(0).toUpperCase();
                
                showViewModal('User Details', `
                    <div style="padding: 20px;">
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div class="user-avatar" style="width: 80px; height: 80px; background: linear-gradient(135deg, var(--primary), var(--accent)); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 2rem; margin: 0 auto 15px;">
                                ${initials}
                            </div>
                            <h3 style="color: var(--primary); margin-bottom: 5px;">${fullName}</h3>
                            <p style="color: var(--text-light); margin: 0;">${user.email}</p>
                        </div>
                        
                        <div style="background: var(--glass-bg); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                                <div>
                                    <strong style="color: var(--primary); display: block; margin-bottom: 5px;">Role:</strong>
                                    <span class="status-badge status-active" style="background: var(--info); color: white;">${user.role || 'User'}</span>
                                </div>
                                <div>
                                    <strong style="color: var(--primary); display: block; margin-bottom: 5px;">Status:</strong>
                                    <span class="status-badge ${user.isActive ? 'status-active' : 'status-inactive'}">${user.isActive ? 'Active' : 'Inactive'}</span>
                                </div>
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <strong style="color: var(--primary); display: block; margin-bottom: 5px;">Username:</strong>
                                <span style="font-size: 1.1rem;">${user.username || user.email}</span>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; font-size: 0.9rem; color: var(--text-muted);">
                                <div>
                                    <strong>Created:</strong> ${new Date(user.createdAt).toLocaleString()}
                                </div>
                                <div>
                                    <strong>Last Login:</strong> ${user.lastLoginAt ? new Date(user.lastLoginAt).toLocaleString() : 'Never'}
                                </div>
                            </div>
                        </div>
                    </div>
                `);
                
            } catch (error) {
                console.error('Error loading user for viewing:', error);
                showNotification('Failed to load user details', 'error');
            }
        }
        
        async function deleteUser(id) {
            if (confirm('Are you sure you want to delete this user? This action cannot be undone.')) {
                try {
                    const token = getAuthToken();
                    const headers = {};
                    if (token) {
                        headers['Authorization'] = `Bearer ${token}`;
                    }
                    
                    const response = await fetch(`${API_BASE_URL}/Auth/users/${id}`, {
                        method: 'DELETE',
                        headers: headers
                    });
                    
                    if (response.ok) {
                        showNotification('User deleted successfully', 'success');
                        loadUsers();
                    } else {
                        const error = await response.text();
                        showNotification(`Failed to delete user: ${error}`, 'error');
                    }
                } catch (error) {
                    console.error('Error deleting user:', error);
                    showNotification('Failed to delete user', 'error');
                }
            }
        }
        
        async function toggleUserBlock(userId, isCurrentlyActive) {
            const action = isCurrentlyActive ? 'block' : 'unblock';
            const confirmMessage = isCurrentlyActive ? 
                'Are you sure you want to block this user? They will not be able to log in.' :
                'Are you sure you want to unblock this user? They will be able to log in again.';
                
            if (confirm(confirmMessage)) {
                try {
                    const token = getAuthToken();
                    if (!token) {
                        showNotification('Please log in again to perform this action', 'error');
                        return;
                    }
                    
                    console.log(`Attempting to ${action} user ${userId}`);
                    
                    // Use the admin block endpoint that takes a BlockUserDto
                    const blockData = {
                        isBlocked: isCurrentlyActive // If user is currently active, we want to block them (isBlocked = true)
                    };
                    
                    const response = await fetch(`${API_BASE_URL}/admin/users/${userId}/block`, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(blockData)
                    });
                    
                    console.log('Block/unblock response status:', response.status);
                    
                    if (response.ok) {
                        const resultMessage = isCurrentlyActive ? 'User blocked successfully' : 'User unblocked successfully';
                        showNotification(resultMessage, 'success');
                        loadUsers(); // Refresh the user list
                    } else if (response.status === 401) {
                        showNotification('Authentication failed. Please log in again.', 'error');
                        logout();
                    } else if (response.status === 403) {
                        showNotification('You do not have permission to perform this action.', 'error');
                    } else {
                        const error = await response.text();
                        console.error('Block/unblock API error:', error);
                        showNotification(`Failed to ${action} user: ${error}`, 'error');
                    }
                } catch (error) {
                    console.error(`Error ${action}ing user:`, error);
                    showNotification(`Failed to ${action} user`, 'error');
                }
            }
        }
        
        async function submitUserForm(formData) {
            try {
                const userId = formData.get('userId');
                const isEditing = userId && userId !== '';
                
                console.log(`${isEditing ? 'Updating' : 'Creating'} user with data:`, Object.fromEntries(formData));
                
                const userData = {
                    firstName: formData.get('firstName'),
                    lastName: formData.get('lastName'),
                    email: formData.get('email'),
                    role: formData.get('role'),
                    isActive: formData.get('isActive') === 'on'
                };
                
                // Add password and confirmPassword only if provided and not empty
                const password = formData.get('password');
                const confirmPassword = formData.get('confirmPassword');
                if (password && password.trim() !== '') {
                    userData.password = password;
                    // Include confirmPassword when password is provided
                    if (confirmPassword && confirmPassword.trim() !== '') {
                        userData.confirmPassword = confirmPassword;
                    }
                }
                // Note: If password is empty, we don't include password or confirmPassword fields at all
                
                const token = getAuthToken();
                const headers = {
                    'Content-Type': 'application/json'
                };
                if (token) {
                    headers['Authorization'] = `Bearer ${token}`;
                }
                
                let apiUrl, method;
                if (isEditing) {
                    apiUrl = `${API_BASE_URL}/Auth/users/${userId}`;
                    method = 'PUT';
                } else {
                    apiUrl = `${API_BASE_URL}/Auth/register`;
                    method = 'POST';
                }
                
                console.log('API URL:', apiUrl);
                console.log('Method:', method);
                console.log('Payload:', userData);
                
                const response = await fetch(apiUrl, {
                    method: method,
                    headers: headers,
                    body: JSON.stringify(userData)
                });
                
                console.log('Response status:', response.status);

                if (response.ok) {
                    let result;
                    if (isEditing) {
                        result = { success: true };
                        console.log('Update successful');
                    } else {
                        result = await response.json();
                        console.log('Success result:', result);
                    }
                    showNotification(`User ${isEditing ? 'updated' : 'created'} successfully!`, 'success');
                    closeModal('userModal');
                    loadUsers();
                    return true;
                } else {
                    const error = await response.text();
                    console.error('API Error Response:', error);
                    showNotification(`Error (${response.status}): ${error || 'Unknown error'}`, 'error');
                    return false;
                }
            } catch (error) {
                console.error('Network/Fetch Error with user:', error);
                showNotification(`Failed to ${formData.get('userId') ? 'update' : 'create'} user: ${error.message}`, 'error');
                return false;
            }
        }

            // Load content on page initialization if user is logged in
        document.addEventListener('DOMContentLoaded', function() {
            if (isLoggedIn) {
                setTimeout(() => {
                    loadAboutContent();
                }, 1000);
            }

            // Add user filters
            const userRoleFilter = document.getElementById('userRoleFilter');
            const userSearch = document.getElementById('userSearch');
            if (userRoleFilter) userRoleFilter.addEventListener('change', loadUsers);
            if (userSearch) userSearch.addEventListener('input', debounce(loadUsers, 300));
            
            // Add carousel filters
            const carouselStatusFilter = document.getElementById('carouselStatusFilter');
            const carouselSearch = document.getElementById('carouselSearch');
            if (carouselStatusFilter) carouselStatusFilter.addEventListener('change', loadCarousel);
            if (carouselSearch) carouselSearch.addEventListener('input', debounce(loadCarousel, 300));
        });

        // Add user management to section loading - This functionality is already handled in setupEventListeners

        // Comments Management Functions
        async function loadComments() {
            try {
                console.log('Loading comments...');
                const statusFilter = document.getElementById('commentStatusFilter')?.value || '';
                const publicationFilter = document.getElementById('commentPublicationFilter')?.value || '';
                
                let url = `${API_BASE_URL}/admin/comments`;
                const params = new URLSearchParams();
                
                if (statusFilter === 'pending') {
                    params.append('isApproved', 'false');
                } else if (statusFilter === 'approved') {
                    params.append('isApproved', 'true');
                }
                
                if (publicationFilter) {
                    params.append('publicationId', publicationFilter);
                }
                
                if (params.toString()) {
                    url += '?' + params.toString();
                }
                
                console.log('Fetching comments from:', url);
                
                const token = getAuthToken();
                const headers = {};
                if (token) {
                    headers['Authorization'] = `Bearer ${token}`;
                }
                
                const response = await fetch(url, { headers });
                if (!response.ok) {
                    if (response.status === 401) {
                        showNotification('Unauthorized. Please log in again.', 'error');
                        logout();
                        return;
                    }
                    throw new Error(`Failed to fetch comments: ${response.status}`);
                }
                
                const comments = await response.json();
                console.log('Comments loaded:', comments);
                
                // Also load publications for the dropdown filter
                await loadPublicationFilterOptions();
                
                const tbody = document.querySelector('#commentsTable tbody');
                if (!tbody) {
                    console.error('Comments table body not found!');
                    return;
                }
                
                if (comments.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 20px; color: var(--text-muted);">No comments found.</td></tr>';
                    return;
                }
                
                tbody.innerHTML = comments.map(comment => {
                    const userName = comment.user ? `${comment.user.firstName || ''} ${comment.user.lastName || ''}`.trim() || comment.user.email : 'Anonymous';
                    const publicationTitle = comment.publication ? comment.publication.title : 'Unknown Publication';
                    const isApproved = comment.isApproved;
                    const statusBadge = isApproved ? 
                        '<span class="status-badge status-active">Approved</span>' : 
                        '<span class="status-badge status-pending">Pending</span>';
                    
                    return `
                    <tr>
                        <td><input type="checkbox" class="comment-checkbox" value="${comment.id}"></td>
                        <td><span class="table-cell-content">#${comment.id}</span></td>
                        <td>
                            <div class="table-cell-content">
                                <div class="user-avatar-container" style="width: 32px; height: 32px; margin-right: 12px; flex-shrink: 0;">
                                    <div class="user-avatar" style="width: 100%; height: 100%; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 14px;">
                                        ${userName.charAt(0).toUpperCase()}
                                    </div>
                                </div>
                                <div>
                                    <div style="font-weight: 600; margin-bottom: 2px;">${userName}</div>
                                    <div style="font-size: 0.8rem; color: var(--text-muted);">${comment.user?.email || 'No email'}</div>
                                </div>
                            </div>
                        </td>
                        <td><span style="color: var(--info); font-weight: 500;">${publicationTitle}</span></td>
                        <td><span style="color: var(--text-light);">${comment.comment.length > 50 ? comment.comment.substring(0, 50) + '...' : comment.comment}</span></td>
                        <td><span class="table-cell-content"><i class="fas fa-calendar table-cell-icon"></i> ${new Date(comment.createdAt).toLocaleDateString()}</span></td>
                        <td>${statusBadge}</td>
                        <td>
                            <div class="table-actions">
                                <button class="btn btn-view" onclick="viewComment(${comment.id})" title="View Comment"><i class="fas fa-eye"></i></button>
                                ${!isApproved ? `<button class="btn btn-success" onclick="approveComment(${comment.id})" title="Approve Comment"><i class="fas fa-check"></i></button>` : ''}
                                ${isApproved ? `<button class="btn btn-warning" onclick="rejectComment(${comment.id})" title="Reject Comment"><i class="fas fa-times"></i></button>` : ''}
                                <button class="btn btn-danger" onclick="deleteComment(${comment.id})" title="Delete Comment"><i class="fas fa-trash"></i></button>
                            </div>
                        </td>
                    </tr>
                `;
                }).join('');
                
            } catch (error) {
                console.error('Error loading comments:', error);
                showNotification('Failed to load comments', 'error');
                const tbody = document.querySelector('#commentsTable tbody');
                if (tbody) {
                    tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 20px; color: var(--text-muted);">Error loading comments</td></tr>';
                }
            }
        }
        
        async function loadPublicationFilterOptions() {
            try {
                const response = await fetch(`${API_BASE_URL}/Publications`);
                if (response.ok) {
                    const publications = await response.json();
                    const select = document.getElementById('commentPublicationFilter');
                    if (select) {
                        // Clear existing options except "All Publications"
                        select.innerHTML = '<option value="">All Publications</option>';
                        
                        // Add publication options
                        publications.forEach(pub => {
                            const option = document.createElement('option');
                            option.value = pub.id;
                            option.textContent = pub.title;
                            select.appendChild(option);
                        });
                    }
                }
            } catch (error) {
                console.error('Error loading publications for filter:', error);
            }
        }
        
        async function viewComment(id) {
            try {
                const token = getAuthToken();
                const headers = {};
                if (token) {
                    headers['Authorization'] = `Bearer ${token}`;
                }
                
                const response = await fetch(`${API_BASE_URL}/admin/comments/${id}`, { headers });
                if (!response.ok) {
                    throw new Error(`Failed to fetch comment: ${response.status}`);
                }
                
                const comment = await response.json();
                const userName = comment.user ? `${comment.user.firstName || ''} ${comment.user.lastName || ''}`.trim() || comment.user.email : 'Anonymous';
                const publicationTitle = comment.publication ? comment.publication.title : 'Unknown Publication';
                
                showViewModal('Comment Details', `
                    <div style="padding: 20px;">
                        <div style="background: var(--glass-bg); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                                <div>
                                    <strong style="color: var(--primary); display: block; margin-bottom: 5px;">Author:</strong>
                                    <span style="font-size: 1.1rem;">${userName}</span>
                                    ${comment.user?.email ? `<div style="font-size: 0.9rem; color: var(--text-muted); margin-top: 2px;">${comment.user.email}</div>` : ''}
                                </div>
                                <div>
                                    <strong style="color: var(--primary); display: block; margin-bottom: 5px;">Publication:</strong>
                                    <span style="font-size: 1.1rem; color: var(--info);">${publicationTitle}</span>
                                </div>
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <strong style="color: var(--primary); display: block; margin-bottom: 10px;">Comment:</strong>
                                <div style="background: var(--bg-light); padding: 15px; border-radius: 8px; border-left: 4px solid var(--primary); line-height: 1.6;">
                                    ${comment.content}
                                </div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; font-size: 0.9rem; color: var(--text-muted);">
                                <div>
                                    <strong>ID:</strong> ${comment.id}
                                </div>
                                <div>
                                    <strong>Posted:</strong> ${new Date(comment.createdAt).toLocaleString()}
                                </div>
                                <div>
                                    <strong>Status:</strong> 
                                    <span class="status-badge ${comment.isApproved ? 'status-active' : 'status-pending'}">
                                        ${comment.isApproved ? 'Approved' : 'Pending'}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                `);
                
            } catch (error) {
                console.error('Error loading comment for viewing:', error);
                showNotification('Failed to load comment details', 'error');
            }
        }
        
        async function approveComment(id) {
            try {
                const token = getAuthToken();
                const headers = {};
                if (token) {
                    headers['Authorization'] = `Bearer ${token}`;
                }
                
                const response = await fetch(`${API_BASE_URL}/admin/comments/${id}/approve`, {
                    method: 'PUT',
                    headers: headers
                });
                
                if (response.ok) {
                    showNotification('Comment approved successfully', 'success');
                    loadComments();
                } else {
                    const error = await response.text();
                    showNotification(`Failed to approve comment: ${error}`, 'error');
                }
            } catch (error) {
                console.error('Error approving comment:', error);
                showNotification('Failed to approve comment', 'error');
            }
        }
        
        async function rejectComment(id) {
            if (confirm('Are you sure you want to reject this comment?')) {
                try {
                    const token = getAuthToken();
                    const headers = {};
                    if (token) {
                        headers['Authorization'] = `Bearer ${token}`;
                    }
                    
                    const response = await fetch(`${API_BASE_URL}/admin/comments/${id}/reject`, {
                        method: 'PUT',
                        headers: headers
                    });
                    
                    if (response.ok) {
                        showNotification('Comment rejected successfully', 'success');
                        loadComments();
                    } else {
                        const error = await response.text();
                        showNotification(`Failed to reject comment: ${error}`, 'error');
                    }
                } catch (error) {
                    console.error('Error rejecting comment:', error);
                    showNotification('Failed to reject comment', 'error');
                }
            }
        }
        
        async function deleteComment(id) {
            if (confirm('Are you sure you want to delete this comment?')) {
                try {
                    const token = getAuthToken();
                    const headers = {};
                    if (token) {
                        headers['Authorization'] = `Bearer ${token}`;
                    }
                    
                    const response = await fetch(`${API_BASE_URL}/admin/comments/${id}`, {
                        method: 'DELETE',
                        headers: headers
                    });
                    
                    if (response.ok) {
                        showNotification('Comment deleted successfully', 'success');
                        loadComments();
                    } else {
                        const error = await response.text();
                        showNotification(`Failed to delete comment: ${error}`, 'error');
                    }
                } catch (error) {
                    console.error('Error deleting comment:', error);
                    showNotification('Failed to delete comment', 'error');
                }
            }
        }
        
        function toggleSelectAllComments() {
            const selectAll = document.getElementById('selectAllComments');
            const checkboxes = document.querySelectorAll('.comment-checkbox');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAll.checked;
            });
        }
        
        function getSelectedCommentIds() {
            const checkboxes = document.querySelectorAll('.comment-checkbox:checked');
            return Array.from(checkboxes).map(cb => parseInt(cb.value));
        }
        
        async function approveSelectedComments() {
            const selectedIds = getSelectedCommentIds();
            
            if (selectedIds.length === 0) {
                showNotification('Please select comments to approve', 'warning');
                return;
            }
            
            if (confirm(`Are you sure you want to approve ${selectedIds.length} selected comment(s)?`)) {
                try {
                    const token = getAuthToken();
                    const headers = {
                        'Content-Type': 'application/json'
                    };
                    if (token) {
                        headers['Authorization'] = `Bearer ${token}`;
                    }
                    
                    const response = await fetch(`${API_BASE_URL}/admin/comments/bulk-approve`, {
                        method: 'PUT',
                        headers: headers,
                        body: JSON.stringify(selectedIds)
                    });
                    
                    if (response.ok) {
                        const result = await response.json();
                        showNotification(`Successfully approved ${result.approvedCount || selectedIds.length} comments`, 'success');
                        loadComments();
                    } else {
                        const error = await response.text();
                        showNotification(`Failed to approve comments: ${error}`, 'error');
                    }
                } catch (error) {
                    console.error('Error approving comments:', error);
                    showNotification('Failed to approve comments', 'error');
                }
            }
        }
        
        async function deleteSelectedComments() {
            const selectedIds = getSelectedCommentIds();
            
            if (selectedIds.length === 0) {
                showNotification('Please select comments to delete', 'warning');
                return;
            }
            
            if (confirm(`Are you sure you want to delete ${selectedIds.length} selected comment(s)? This action cannot be undone.`)) {
                try {
                    const token = getAuthToken();
                    const headers = {
                        'Content-Type': 'application/json'
                    };
                    if (token) {
                        headers['Authorization'] = `Bearer ${token}`;
                    }
                    
                    const response = await fetch(`${API_BASE_URL}/admin/comments/bulk-delete`, {
                        method: 'DELETE',
                        headers: headers,
                        body: JSON.stringify(selectedIds)
                    });
                    
                    if (response.ok) {
                        const result = await response.json();
                        showNotification(`Successfully deleted ${result.deletedCount || selectedIds.length} comments`, 'success');
                        loadComments();
                    } else {
                        const error = await response.text();
                        showNotification(`Failed to delete comments: ${error}`, 'error');
                    }
                } catch (error) {
                    console.error('Error deleting comments:', error);
                    showNotification('Failed to delete comments', 'error');
                }
            }
        }

        // Login state is now handled by initializeApp() function
    </script>

</body>
</html>







